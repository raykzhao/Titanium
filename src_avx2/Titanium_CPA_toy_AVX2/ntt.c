/* ****************************** *
 * Titanium_CPA_toy               *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>
#include <x86intrin.h>

/* 512=2*256 */
#define N1_512 2
#define N2_512 256

/* 1024=4*256 */
#define N1_1024 4
#define N2_1024 256

/* 1280=5*256 */
#define N1_1280 5
#define N2_1280 256

/* multiplication inverses of 512, 1024, 1280 (in Montgomery form) */
#define INV_512 2048
#define INV_1024 1024
#define INV_1280 193332

/* omega_n: n-th root of unity mod Q */
static const __m256i w_4[3][3]={{{11875,11875,11875,11875},{240640,240640,240640,240640},{228766,228766,228766,228766}},
{{240640,240640,240640,240640},{1,1,1,1},{240640,240640,240640,240640}},
{{228766,228766,228766,228766},{240640,240640,240640,240640},{11875,11875,11875,11875}}};

static const __m256i w_5[4][4]={{{33290,33290,33290,33290},{72295,72295,72295,72295},{49909,49909,49909,49909},{85146,85146,85146,85146}},
{{72295,72295,72295,72295},{85146,85146,85146,85146},{33290,33290,33290,33290},{49909,49909,49909,49909}},
{{49909,49909,49909,49909},{33290,33290,33290,33290},{85146,85146,85146,85146},{72295,72295,72295,72295}},
{{85146,85146,85146,85146},{49909,49909,49909,49909},{72295,72295,72295,72295},{33290,33290,33290,33290}}};

static const __m256i w_4_inv[3][3]={{{228766,228766,228766,228766},{240640,240640,240640,240640},{11875,11875,11875,11875}},
{{240640,240640,240640,240640},{1,1,1,1},{240640,240640,240640,240640}},
{{11875,11875,11875,11875},{240640,240640,240640,240640},{228766,228766,228766,228766}}};

/* omega_256,512,1024,1280, respectively (in Montgomery form) */
static const uint64_t omega_256[128]={86012,176531,43913,92659,199045,24558,208370,28737,145702,99799,48441,182248,112332,36587,11803,130268,204390,111339,89483,9083,73050,190154,159384,143788,163224,210411,27613,71806,106656,208079,209997,211063,192083,36999,157069,179137,67945,122577,194595,109659,195696,113533,208890,230773,205045,23376,41598,128008,103766,177365,134711,66590,234742,5253,47334,201958,125294,22964,136973,79139,240211,166127,29599,206655,112096,81874,238469,114973,83473,209999,122988,22937,2460,196841,104885,110487,69437,113620,107563,92152,26124,68971,180610,53457,198586,144247,43535,134605,162386,55122,151333,105187,46417,36337,192333,97110,190227,193300,226625,226076,218243,205107,180743,92174,19863,133493,41322,9667,103737,130927,180918,206444,139330,119343,152398,9924,216547,53356,194515,23044,223588,51247,61856,72520,187852,223848,152265,211848};
static const uint64_t omega_512[512]={86012,46042,176531,66491,43913,142596,92659,196186,199045,192848,24558,158372,208370,191153,28737,82904,145702,120352,99799,116825,48441,103322,182248,238094,112332,145127,36587,33736,11803,68434,130268,125609,204390,228650,111339,207629,89483,53669,9083,6994,73050,22205,190154,232657,159384,18899,143788,232827,163224,233036,210411,53236,27613,184913,71806,64882,106656,130159,208079,71337,209997,185438,211063,167051,192083,7278,36999,28887,157069,37384,179137,167822,67945,105067,122577,36815,194595,78175,109659,98904,195696,117200,113533,73168,208890,47190,230773,46051,205045,31115,23376,103362,41598,161081,128008,131181,103766,64879,177365,141951,134711,84415,66590,116926,234742,107393,5253,118656,47334,205715,201958,117094,125294,168964,22964,108211,136973,192131,79139,88968,240211,188462,166127,72124,29599,59909,206655,25016,112096,12398,81874,37504,238469,177424,114973,63229,83473,130244,209999,58085,122988,215963,22937,22669,2460,13101,196841,1510,104885,160932,110487,75141,69437,152924,113620,188376,107563,9093,92152,113957,26124,66347,68971,227330,180610,102007,53457,32605,198586,182480,144247,2554,43535,148213,134605,96176,162386,171641,55122,13593,151333,233391,105187,181909,46417,982,36337,70555,192333,211100,97110,126862,190227,36131,193300,119700,226625,192996,226076,138129,218243,187681,205107,174069,180743,175788,92174,156920,19863,123097,133493,155990,41322,169002,9667,119273,103737,106690,130927,154650,180918,222207,206444,105182,139330,146284,119343,218561,152398,158360,9924,238321,216547,135216,53356,86945,194515,118834,23044,67552,223588,223483,51247,223326,61856,38304,72520,81010,187852,24950,223848,31181,152265,84579,211848,114006,154629,194599,64110,174150,196728,98045,147982,44455,41596,47793,216083,82269,32271,49488,211904,157737,94939,120289,140842,123816,192200,137319,58393,2547,128309,95514,204054,206905,228838,172207,110373,115032,36251,11991,129302,33012,151158,186972,231558,233647,167591,218436,50487,7984,81257,221742,96853,7814,77417,7605,30230,187405,213028,55728,168835,175759,133985,110482,32562,169304,30644,55203,29578,73590,48558,233363,203642,211754,83572,203257,61504,72819,172696,135574,118064,203826,46046,162466,130982,141737,44945,123441,127108,167473,31751,193451,9868,194590,35596,209526,217265,137279,199043,79560,112633,109460,136875,175762,63276,98690,105930,156226,174051,123715,5899,133248,235388,121985,193307,34926,38683,123547,115347,71677,217677,132430,103668,48510,161502,151673,430,52179,74514,168517,211042,180732,33986,215625,128545,228243,158767,203137,2172,63217,125668,177412,157168,110397,30642,182556,117653,24678,217704,217972,238181,227540,43800,239131,135756,79709,130154,165500,171204,87717,127021,52265,133078,231548,148489,126684,214517,174294,171670,13311,60031,138634,187184,208036,42055,58161,96394,238087,197106,92428,106036,144465,78255,69000,185519,227048,89308,7250,135454,58732,194224,239659,204304,170086,48308,29541,143531,113779,50414,204510,47341,120941,14016,47645,14565,102512,22398,52960,35534,66572,59898,64853,148467,83721,220778,117544,107148,84651,199319,71639,230974,121368,136904,133951,109714,85991,59723,18434,34197,135459,101311,94357,121298,22080,88243,82281,230717,2320,24094,105425,187285,153696,46126,121807,217597,173089,17053,17158,189394,17315,178785,202337,168121,159631,52789,215691,16793,209460,88376,156062,28793,126635};
static const uint64_t omega_1024[1024]={86012,16371,46042,129151,176531,142844,66491,183193,43913,103731,142596,7467,92659,154511,196186,7914,199045,207074,192848,176034,24558,69420,158372,152540,208370,20014,191153,13265,28737,101458,82904,239231,145702,24772,120352,7497,99799,169344,116825,130635,48441,218831,103322,45254,182248,59644,238094,115737,112332,23865,145127,128563,36587,44630,33736,88015,11803,162063,68434,164345,130268,201736,125609,55458,204390,35338,228650,33834,111339,28172,207629,84297,89483,120546,53669,19249,9083,236626,6994,220726,73050,59748,22205,231329,190154,16144,232657,24936,159384,152755,18899,166424,143788,50522,232827,65396,163224,104111,233036,115138,210411,24490,53236,156836,27613,74587,184913,212632,71806,4317,64882,40892,106656,116823,130159,175794,208079,191397,71337,133336,209997,166599,185438,96941,211063,179666,167051,52373,192083,234605,7278,47677,36999,142686,28887,137158,157069,83067,37384,234316,179137,41149,167822,235871,67945,47963,105067,219923,122577,55765,36815,98894,194595,110538,78175,76293,109659,109614,98904,196975,195696,131935,117200,219885,113533,69062,73168,87832,208890,143774,47190,161734,230773,57826,46051,131293,205045,191228,31115,186140,23376,28745,103362,54774,41598,34043,161081,75359,128008,145138,131181,178389,103766,150926,64879,40178,177365,100695,141951,94598,134711,55965,84415,117567,66590,206755,116926,154673,234742,39884,107393,51588,5253,47009,118656,85131,47334,196006,205715,110047,201958,178445,117094,194657,125294,221129,168964,26385,22964,171330,108211,5631,136973,113039,192131,5388,79139,65084,88968,238617,240211,138301,188462,94730,166127,73102,72124,80001,29599,65973,59909,60523,206655,93126,25016,178424,112096,208338,12398,63032,81874,234732,37504,22235,238469,204987,177424,114737,114973,171141,63229,128760,83473,134012,130244,196024,209999,167075,58085,107693,122988,153583,215963,142661,22937,164904,22669,101120,2460,104198,13101,230346,196841,163804,1510,118739,104885,176607,160932,39897,110487,66037,75141,76124,69437,162418,152924,59121,113620,89768,188376,74262,107563,92048,9093,239006,92152,33845,113957,169974,26124,201487,66347,148921,68971,51510,227330,200956,180610,151082,102007,213566,53457,209434,32605,59478,198586,97832,182480,114860,144247,159764,2554,126570,43535,13767,148213,141108,134605,30737,96176,28993,162386,145308,171641,182229,55122,124422,13593,106801,151333,161745,233391,199628,105187,7842,181909,219603,46417,218401,982,233716,36337,225771,70555,187861,192333,53464,211100,188472,97110,10644,126862,113031,190227,33518,36131,176743,193300,42969,119700,92962,226625,33166,192996,211258,226076,143145,138129,147526,218243,204019,187681,149493,205107,205984,174069,38170,180743,182736,175788,206651,92174,39081,156920,47605,19863,155215,123097,179525,133493,6722,155990,66906,41322,208996,169002,35429,9667,134977,119273,231977,103737,144024,106690,124915,130927,117937,154650,229268,180918,224386,222207,184887,206444,42908,105182,6652,139330,192723,146284,163288,119343,7996,218561,39062,152398,174574,158360,149684,9924,196143,238321,169763,216547,41012,135216,176155,53356,185396,86945,238425,194515,91498,118834,127495,23044,190370,67552,195070,223588,32283,223483,7293,51247,164736,223326,210568,61856,42627,38304,212635,72520,174249,81010,29100,187852,190191,24950,162716,223848,94163,31181,201848,152265,142920,84579,156599,211848,125855,114006,181636,154629,224270,194599,111490,64110,97797,174150,57448,196728,136910,98045,233174,147982,86130,44455,232727,41596,33567,47793,64607,216083,171221,82269,88101,32271,220627,49488,227376,211904,139183,157737,1410,94939,215869,120289,233144,140842,71297,123816,110006,192200,21810,137319,195387,58393,180997,2547,124904,128309,216776,95514,112078,204054,196011,206905,152626,228838,78578,172207,76296,110373,38905,115032,185183,36251,205303,11991,206807,129302,212469,33012,156344,151158,120095,186972,221392,231558,4015,233647,19915,167591,180893,218436,9312,50487,224497,7984,215705,81257,87886,221742,74217,96853,190119,7814,175245,77417,136530,7605,125503,30230,216151,187405,83805,213028,166054,55728,28009,168835,236324,175759,199749,133985,123818,110482,64847,32562,49244,169304,107305,30644,74042,55203,143700,29578,60975,73590,188268,48558,6036,233363,192964,203642,97955,211754,103483,83572,157574,203257,6325,61504,199492,72819,4770,172696,192678,135574,20718,118064,184876,203826,141747,46046,130103,162466,164348,130982,131027,141737,43666,44945,108706,123441,20756,127108,171579,167473,152809,31751,96867,193451,78907,9868,182815,194590,109348,35596,49413,209526,54501,217265,211896,137279,185867,199043,206598,79560,165282,112633,95503,109460,62252,136875,89715,175762,200463,63276,139946,98690,146043,105930,184676,156226,123074,174051,33886,123715,85968,5899,200757,133248,189053,235388,193632,121985,155510,193307,44635,34926,130594,38683,62196,123547,45984,115347,19512,71677,214256,217677,69311,132430,235010,103668,127602,48510,235253,161502,175557,151673,2024,430,102340,52179,145911,74514,167539,168517,160640,211042,174668,180732,180118,33986,147515,215625,62217,128545,32303,228243,177609,158767,5909,203137,218406,2172,35654,63217,125904,125668,69500,177412,111881,157168,106629,110397,44617,30642,73566,182556,132948,117653,87058,24678,97980,217704,75737,217972,139521,238181,136443,227540,10295,43800,76837,239131,121902,135756,64034,79709,200744,130154,174604,165500,164517,171204,78223,87717,181520,127021,150873,52265,166379,133078,148593,231548,1635,148489,206796,126684,70667,214517,39154,174294,91720,171670,189131,13311,39685,60031,89559,138634,27075,187184,31207,208036,181163,42055,142809,58161,125781,96394,80877,238087,114071,197106,226874,92428,99533,106036,209904,144465,211648,78255,95333,69000,58412,185519,116219,227048,133840,89308,78896,7250,41013,135454,232799,58732,21038,194224,22240,239659,6925,204304,14870,170086,52780,48308,187177,29541,52169,143531,229997,113779,127610,50414,207123,204510,63898,47341,197672,120941,147679,14016,207475,47645,29383,14565,97496,102512,93115,22398,36622,52960,91148,35534,34657,66572,202471,59898,57905,64853,33990,148467,201560,83721,193036,220778,85426,117544,61116,107148,233919,84651,173735,199319,31645,71639,205212,230974,105664,121368,8664,136904,96617,133951,115726,109714,122704,85991,11373,59723,16255,18434,55754,34197,197733,135459,233989,101311,47918,94357,77353,121298,232645,22080,201579,88243,66067,82281,90957,230717,44498,2320,70878,24094,199629,105425,64486,187285,55245,153696,2216,46126,149143,121807,113146,217597,50271,173089,45571,17053,208358,17158,233348,189394,75905,17315,30073,178785,198014,202337,28006,168121,66392,159631,211541,52789,50450,215691,77925,16793,146478,209460,38793,88376,97721,156062,84042,28793,114786,126635,59005};
static const uint64_t omega_1280[1280]={86012,226079,75901,218810,182154,176531,206451,133523,142188,160960,43913,192029,164043,115411,45296,92659,8614,119528,46328,191290,199045,151832,66934,225739,186112,24558,149126,5584,18818,84619,208370,197306,29702,69929,36993,28737,202253,122651,104860,180653,145702,8525,64153,128540,205293,99799,100593,107923,17993,171562,48441,216252,120958,184396,3261,182248,170125,141251,91695,176710,112332,116886,108617,57738,222674,36587,184406,120340,216272,114475,11803,132602,163993,11298,115817,130268,174572,155634,109913,215178,204390,43577,204687,79657,60123,111339,210158,147136,49040,226631,89483,219935,238607,153975,202492,9083,51726,53823,228356,192087,73050,23981,203808,160040,101490,190154,230382,233218,132108,59418,159384,217876,220205,30766,110059,143788,123602,193651,191746,147489,163224,176345,50166,78215,214714,210411,53094,139796,21891,39038,27613,181572,52353,103254,3379,71806,42198,206504,104311,33746,106656,176018,144131,120707,109341,208079,135217,98424,4857,1802,209997,163228,78792,160032,55955,211063,34261,240520,3126,165848,192083,170603,154756,226068,163691,36999,2728,126411,89261,219704,157069,186200,44161,159768,237787,179137,59575,204,78258,68423,67945,54440,160708,173727,8419,122577,104783,73260,76230,196389,194595,30133,86637,203966,36632,109659,32807,206488,13241,75564,195696,190622,126808,92926,174739,113533,4319,7746,112121,28865,208890,28748,114463,63821,43645,230773,22251,162985,49272,103300,205045,132060,26849,44197,3714,23376,219438,26716,99341,80605,41598,160353,228640,3772,173024,128008,185228,166722,173481,112224,103766,29927,177476,80610,220458,177365,200815,179689,73157,1329,134711,45867,63986,170641,70246,66590,192862,122635,13790,222471,234742,23129,46830,100759,30050,5253,210336,17245,125257,198625,47334,81772,156629,88185,231592,201958,158115,63716,137841,114162,125294,78343,221351,116508,62697,22964,160475,20645,226352,216017,136973,106755,107831,95943,51054,79139,59584,81511,205136,18338,240211,19064,221455,227181,31521,166127,65549,12924,45967,31571,29599,235669,215956,120650,236106,206655,211781,210611,228905,98353,112096,97129,123830,167873,197442,81874,195758,2076,145244,229178,238469,30259,21730,55130,57365,114973,18825,94382,39674,158351,83473,122628,4027,150526,33056,209999,234772,133725,148902,174450,122988,127974,172185,195425,122050,22937,157195,121293,135966,180501,2460,165155,188110,26637,161045,196841,240592,172300,218308,32044,104885,112389,230762,110041,221815,110487,53180,87855,218241,41730,69437,3962,231756,52541,90442,113620,228791,111242,109248,9616,107563,134687,149903,126713,63560,92152,160926,30870,220732,112612,26124,98725,184025,207745,219419,68971,179080,186340,239421,154822,180610,51352,150991,62807,107628,53457,130418,5629,184712,237727,198586,96072,93463,133023,63622,144247,179362,167122,43821,29338,43535,146109,129269,53212,29354,134605,104291,40229,38608,46677,162386,38893,134775,169506,137355,55122,11830,135882,63345,101684,151333,24140,116172,75355,179219,105187,86688,103210,113898,66485,46417,6024,116833,137829,166180,36337,145123,232304,163676,222342,192333,209886,42792,38023,55824,97110,166085,6971,62536,39056,190227,194687,192824,207145,173268,193300,149106,12067,191411,195919,226625,115492,55136,31356,39131,226076,209226,16090,198849,119109,218243,113274,124370,233473,109610,205107,184155,45285,180449,67444,180743,236849,74100,44585,166713,92174,225987,153851,98302,212852,19863,167004,154263,157265,218923,133493,31592,58888,210863,99091,41322,153562,107757,95866,184302,9667,6807,211953,106729,140323,103737,195744,223191,1354,66447,130927,165502,87662,52193,155118,180918,240283,188238,33274,67142,206444,123760,70243,199915,230783,139330,197009,234263,214493,5311,119343,166456,43128,25365,140210,152398,100042,130113,164655,109544,9924,55853,171934,120370,86227,216547,85494,225540,46073,213788,53356,127061,239525,24854,149434,194515,56065,55086,167884,109652,23044,134543,52196,21793,142997,223588,5019,21482,87391,224262,51247,4546,186837,210671,209456,61856,18837,42364,128631,91571,72520,75460,85023,221798,224286,187852,182460,53277,188765,115120,223848,161381,184183,84337,227588,152265,155186,207004,182877,50459,211848,200925,23712,206780,111102,154629,14562,164740,21831,58487,64110,34190,107118,98453,79681,196728,48612,76598,125230,195345,147982,232027,121113,194313,49351,41596,88809,173707,14902,54529,216083,91515,235057,221823,156022,32271,43335,210939,170712,203648,211904,38388,117990,135781,59988,94939,232116,176488,112101,35348,140842,140048,132718,222648,69079,192200,24389,119683,56245,237380,58393,70516,99390,148946,63931,128309,123755,132024,182903,17967,204054,56235,120301,24369,126166,228838,108039,76648,229343,124824,110373,66069,85007,130728,25463,36251,197064,35954,160984,180518,129302,30483,93505,191601,14010,151158,20706,2034,86666,38149,231558,188915,186818,12285,48554,167591,216660,36833,80601,139151,50487,10259,7423,108533,181223,81257,22765,20436,209875,130582,96853,117039,46990,48895,93152,77417,64296,190475,162426,25927,30230,187547,100845,218750,201603,213028,59069,188288,137387,237262,168835,198443,34137,136330,206895,133985,64623,96510,119934,131300,32562,105424,142217,235784,238839,30644,77413,161849,80609,184686,29578,206380,121,237515,74793,48558,70038,85885,14573,76950,203642,237913,114230,151380,20937,83572,54441,196480,80873,2854,61504,181066,240437,162383,172218,172696,186201,79933,66914,232222,118064,135858,167381,164411,44252,46046,210508,154004,36675,204009,130982,207834,34153,227400,165077,44945,50019,113833,147715,65902,127108,236322,232895,128520,211776,31751,211893,126178,176820,196996,9868,218390,77656,191369,137341,35596,108581,213792,196444,236927,217265,21203,213925,141300,160036,199043,80288,12001,236869,67617,112633,55413,73919,67160,128417,136875,210714,63165,160031,20183,63276,39826,60952,167484,239312,105930,194774,176655,70000,170395,174051,47779,118006,226851,18170,5899,217512,193811,139882,210591,235388,30305,223396,115384,42016,193307,158869,84012,152456,9049,38683,82526,176925,102800,126479,115347,162298,19290,124133,177944,217677,80166,219996,14289,24624,103668,133886,132810,144698,189587,161502,181057,159130,35505,222303,430,221577,19186,13460,209120,74514,175092,227717,194674,209070,211042,4972,24685,119991,4535,33986,28860,30030,11736,142288,128545,143512,116811,72768,43199,158767,44883,238565,95397,11463,2172,210382,218911,185511,183276,125668,221816,146259,200967,82290,157168,118013,236614,90115,207585,30642,5869,106916,91739,66191,117653,112667,68456,45216,118591,217704,83446,119348,104675,60140,238181,75486,52531,214004,79596,43800,49,68341,22333,208597,135756,128252,9879,130600,18826,130154,187461,152786,22400,198911,171204,236679,8885,188100,150199,127021,11850,129399,131393,231025,133078,105954,90738,113928,177081,148489,79715,209771,19909,128029,214517,141916,56616,32896,21222,171670,61561,54301,1220,85819,60031,189289,89650,177834,133013,187184,110223,235012,55929,2914,42055,144569,147178,107618,177019,96394,61279,73519,196820,211303,197106,94532,111372,187429,211287,106036,136350,200412,202033,193964,78255,201748,105866,71135,103286,185519,228811,104759,177296,138957,89308,216501,124469,165286,61422,135454,153953,137431,126743,174156,194224,234617,123808,102812,74461,204304,95518,8337,76965,18299,48308,30755,197849,202618,184817,143531,74556,233670,178105,201585,50414,45954,47817,33496,67373,47341,91535,228574,49230,44722,14016,125149,185505,209285,201510,14565,31415,224551,41792,121532,22398,127367,116271,7168,131031,35534,56486,195356,60192,173197,59898,3792,166541,196056,73928,148467,14654,86790,142339,27789,220778,73637,86378,83376,21718,107148,209049,181753,29778,141550,199319,87079,132884,144775,56339,230974,233834,28688,133912,100318,136904,44897,17450,239287,174194,109714,75139,152979,188448,85523,59723,358,52403,207367,173499,34197,116881,170398,40726,9858,101311,43632,6378,26148,235330,121298,74185,197513,215276,100431,88243,140599,110528,75986,131097,230717,184788,68707,120271,154414,24094,155147,15101,194568,26853,187285,113580,1116,215787,91207,46126,184576,185555,72757,130989,217597,106098,188445,218848,97644,17053,235622,219159,153250,16379,189394,236095,53804,29970,31185,178785,221804,198277,112010,149070,168121,165181,155618,18843,16355,52789,58181,187364,51876,125521,16793,79260,56458,156304,13053,88376,85455,33637,57764,190182,28793,39716,216929,33861,129539};

/* multiplication inverses of omega_256,512,1024, respectively (in Montgomery form) */
static const uint64_t omega_256_inv[128]={86012,28793,88376,16793,52789,168121,178785,189394,17053,217597,46126,187285,24094,230717,88243,121298,101311,34197,59723,109714,136904,230974,199319,107148,220778,148467,59898,35534,22398,14565,14016,47341,50414,143531,48308,204304,194224,135454,89308,185519,78255,106036,197106,96394,42055,187184,60031,171670,214517,148489,133078,127021,171204,130154,135756,43800,238181,217704,117653,30642,157168,125668,2172,158767,128545,33986,211042,74514,430,161502,103668,217677,115347,38683,193307,235388,5899,174051,105930,63276,136875,112633,199043,217265,35596,9868,31751,127108,44945,130982,46046,118064,172696,61504,83572,203642,48558,29578,30644,32562,133985,168835,213028,30230,77417,96853,81257,50487,167591,231558,151158,129302,36251,110373,228838,204054,128309,58393,192200,140842,94939,211904,32271,216083,41596,147982,196728,64110};
static const uint64_t omega_512_inv[512]={86012,126635,28793,156062,88376,209460,16793,215691,52789,159631,168121,202337,178785,17315,189394,17158,17053,173089,217597,121807,46126,153696,187285,105425,24094,2320,230717,82281,88243,22080,121298,94357,101311,135459,34197,18434,59723,85991,109714,133951,136904,121368,230974,71639,199319,84651,107148,117544,220778,83721,148467,64853,59898,66572,35534,52960,22398,102512,14565,47645,14016,120941,47341,204510,50414,113779,143531,29541,48308,170086,204304,239659,194224,58732,135454,7250,89308,227048,185519,69000,78255,144465,106036,92428,197106,238087,96394,58161,42055,208036,187184,138634,60031,13311,171670,174294,214517,126684,148489,231548,133078,52265,127021,87717,171204,165500,130154,79709,135756,239131,43800,227540,238181,217972,217704,24678,117653,182556,30642,110397,157168,177412,125668,63217,2172,203137,158767,228243,128545,215625,33986,180732,211042,168517,74514,52179,430,151673,161502,48510,103668,132430,217677,71677,115347,123547,38683,34926,193307,121985,235388,133248,5899,123715,174051,156226,105930,98690,63276,175762,136875,109460,112633,79560,199043,137279,217265,209526,35596,194590,9868,193451,31751,167473,127108,123441,44945,141737,130982,162466,46046,203826,118064,135574,172696,72819,61504,203257,83572,211754,203642,233363,48558,73590,29578,55203,30644,169304,32562,110482,133985,175759,168835,55728,213028,187405,30230,7605,77417,7814,96853,221742,81257,7984,50487,218436,167591,233647,231558,186972,151158,33012,129302,11991,36251,115032,110373,172207,228838,206905,204054,95514,128309,2547,58393,137319,192200,123816,140842,120289,94939,157737,211904,49488,32271,82269,216083,47793,41596,44455,147982,98045,196728,174150,64110,194599,154629,114006,211848,84579,152265,31181,223848,24950,187852,81010,72520,38304,61856,223326,51247,223483,223588,67552,23044,118834,194515,86945,53356,135216,216547,238321,9924,158360,152398,218561,119343,146284,139330,105182,206444,222207,180918,154650,130927,106690,103737,119273,9667,169002,41322,155990,133493,123097,19863,156920,92174,175788,180743,174069,205107,187681,218243,138129,226076,192996,226625,119700,193300,36131,190227,126862,97110,211100,192333,70555,36337,982,46417,181909,105187,233391,151333,13593,55122,171641,162386,96176,134605,148213,43535,2554,144247,182480,198586,32605,53457,102007,180610,227330,68971,66347,26124,113957,92152,9093,107563,188376,113620,152924,69437,75141,110487,160932,104885,1510,196841,13101,2460,22669,22937,215963,122988,58085,209999,130244,83473,63229,114973,177424,238469,37504,81874,12398,112096,25016,206655,59909,29599,72124,166127,188462,240211,88968,79139,192131,136973,108211,22964,168964,125294,117094,201958,205715,47334,118656,5253,107393,234742,116926,66590,84415,134711,141951,177365,64879,103766,131181,128008,161081,41598,103362,23376,31115,205045,46051,230773,47190,208890,73168,113533,117200,195696,98904,109659,78175,194595,36815,122577,105067,67945,167822,179137,37384,157069,28887,36999,7278,192083,167051,211063,185438,209997,71337,208079,130159,106656,64882,71806,184913,27613,53236,210411,233036,163224,232827,143788,18899,159384,232657,190154,22205,73050,6994,9083,53669,89483,207629,111339,228650,204390,125609,130268,68434,11803,33736,36587,145127,112332,238094,182248,103322,48441,116825,99799,120352,145702,82904,28737,191153,208370,158372,24558,192848,199045,196186,92659,142596,43913,66491,176531,46042};
static const uint64_t omega_1024_inv[1024]={86012,59005,126635,114786,28793,84042,156062,97721,88376,38793,209460,146478,16793,77925,215691,50450,52789,211541,159631,66392,168121,28006,202337,198014,178785,30073,17315,75905,189394,233348,17158,208358,17053,45571,173089,50271,217597,113146,121807,149143,46126,2216,153696,55245,187285,64486,105425,199629,24094,70878,2320,44498,230717,90957,82281,66067,88243,201579,22080,232645,121298,77353,94357,47918,101311,233989,135459,197733,34197,55754,18434,16255,59723,11373,85991,122704,109714,115726,133951,96617,136904,8664,121368,105664,230974,205212,71639,31645,199319,173735,84651,233919,107148,61116,117544,85426,220778,193036,83721,201560,148467,33990,64853,57905,59898,202471,66572,34657,35534,91148,52960,36622,22398,93115,102512,97496,14565,29383,47645,207475,14016,147679,120941,197672,47341,63898,204510,207123,50414,127610,113779,229997,143531,52169,29541,187177,48308,52780,170086,14870,204304,6925,239659,22240,194224,21038,58732,232799,135454,41013,7250,78896,89308,133840,227048,116219,185519,58412,69000,95333,78255,211648,144465,209904,106036,99533,92428,226874,197106,114071,238087,80877,96394,125781,58161,142809,42055,181163,208036,31207,187184,27075,138634,89559,60031,39685,13311,189131,171670,91720,174294,39154,214517,70667,126684,206796,148489,1635,231548,148593,133078,166379,52265,150873,127021,181520,87717,78223,171204,164517,165500,174604,130154,200744,79709,64034,135756,121902,239131,76837,43800,10295,227540,136443,238181,139521,217972,75737,217704,97980,24678,87058,117653,132948,182556,73566,30642,44617,110397,106629,157168,111881,177412,69500,125668,125904,63217,35654,2172,218406,203137,5909,158767,177609,228243,32303,128545,62217,215625,147515,33986,180118,180732,174668,211042,160640,168517,167539,74514,145911,52179,102340,430,2024,151673,175557,161502,235253,48510,127602,103668,235010,132430,69311,217677,214256,71677,19512,115347,45984,123547,62196,38683,130594,34926,44635,193307,155510,121985,193632,235388,189053,133248,200757,5899,85968,123715,33886,174051,123074,156226,184676,105930,146043,98690,139946,63276,200463,175762,89715,136875,62252,109460,95503,112633,165282,79560,206598,199043,185867,137279,211896,217265,54501,209526,49413,35596,109348,194590,182815,9868,78907,193451,96867,31751,152809,167473,171579,127108,20756,123441,108706,44945,43666,141737,131027,130982,164348,162466,130103,46046,141747,203826,184876,118064,20718,135574,192678,172696,4770,72819,199492,61504,6325,203257,157574,83572,103483,211754,97955,203642,192964,233363,6036,48558,188268,73590,60975,29578,143700,55203,74042,30644,107305,169304,49244,32562,64847,110482,123818,133985,199749,175759,236324,168835,28009,55728,166054,213028,83805,187405,216151,30230,125503,7605,136530,77417,175245,7814,190119,96853,74217,221742,87886,81257,215705,7984,224497,50487,9312,218436,180893,167591,19915,233647,4015,231558,221392,186972,120095,151158,156344,33012,212469,129302,206807,11991,205303,36251,185183,115032,38905,110373,76296,172207,78578,228838,152626,206905,196011,204054,112078,95514,216776,128309,124904,2547,180997,58393,195387,137319,21810,192200,110006,123816,71297,140842,233144,120289,215869,94939,1410,157737,139183,211904,227376,49488,220627,32271,88101,82269,171221,216083,64607,47793,33567,41596,232727,44455,86130,147982,233174,98045,136910,196728,57448,174150,97797,64110,111490,194599,224270,154629,181636,114006,125855,211848,156599,84579,142920,152265,201848,31181,94163,223848,162716,24950,190191,187852,29100,81010,174249,72520,212635,38304,42627,61856,210568,223326,164736,51247,7293,223483,32283,223588,195070,67552,190370,23044,127495,118834,91498,194515,238425,86945,185396,53356,176155,135216,41012,216547,169763,238321,196143,9924,149684,158360,174574,152398,39062,218561,7996,119343,163288,146284,192723,139330,6652,105182,42908,206444,184887,222207,224386,180918,229268,154650,117937,130927,124915,106690,144024,103737,231977,119273,134977,9667,35429,169002,208996,41322,66906,155990,6722,133493,179525,123097,155215,19863,47605,156920,39081,92174,206651,175788,182736,180743,38170,174069,205984,205107,149493,187681,204019,218243,147526,138129,143145,226076,211258,192996,33166,226625,92962,119700,42969,193300,176743,36131,33518,190227,113031,126862,10644,97110,188472,211100,53464,192333,187861,70555,225771,36337,233716,982,218401,46417,219603,181909,7842,105187,199628,233391,161745,151333,106801,13593,124422,55122,182229,171641,145308,162386,28993,96176,30737,134605,141108,148213,13767,43535,126570,2554,159764,144247,114860,182480,97832,198586,59478,32605,209434,53457,213566,102007,151082,180610,200956,227330,51510,68971,148921,66347,201487,26124,169974,113957,33845,92152,239006,9093,92048,107563,74262,188376,89768,113620,59121,152924,162418,69437,76124,75141,66037,110487,39897,160932,176607,104885,118739,1510,163804,196841,230346,13101,104198,2460,101120,22669,164904,22937,142661,215963,153583,122988,107693,58085,167075,209999,196024,130244,134012,83473,128760,63229,171141,114973,114737,177424,204987,238469,22235,37504,234732,81874,63032,12398,208338,112096,178424,25016,93126,206655,60523,59909,65973,29599,80001,72124,73102,166127,94730,188462,138301,240211,238617,88968,65084,79139,5388,192131,113039,136973,5631,108211,171330,22964,26385,168964,221129,125294,194657,117094,178445,201958,110047,205715,196006,47334,85131,118656,47009,5253,51588,107393,39884,234742,154673,116926,206755,66590,117567,84415,55965,134711,94598,141951,100695,177365,40178,64879,150926,103766,178389,131181,145138,128008,75359,161081,34043,41598,54774,103362,28745,23376,186140,31115,191228,205045,131293,46051,57826,230773,161734,47190,143774,208890,87832,73168,69062,113533,219885,117200,131935,195696,196975,98904,109614,109659,76293,78175,110538,194595,98894,36815,55765,122577,219923,105067,47963,67945,235871,167822,41149,179137,234316,37384,83067,157069,137158,28887,142686,36999,47677,7278,234605,192083,52373,167051,179666,211063,96941,185438,166599,209997,133336,71337,191397,208079,175794,130159,116823,106656,40892,64882,4317,71806,212632,184913,74587,27613,156836,53236,24490,210411,115138,233036,104111,163224,65396,232827,50522,143788,166424,18899,152755,159384,24936,232657,16144,190154,231329,22205,59748,73050,220726,6994,236626,9083,19249,53669,120546,89483,84297,207629,28172,111339,33834,228650,35338,204390,55458,125609,201736,130268,164345,68434,162063,11803,88015,33736,44630,36587,128563,145127,23865,112332,115737,238094,59644,182248,45254,103322,218831,48441,130635,116825,169344,99799,7497,120352,24772,145702,239231,82904,101458,28737,13265,191153,20014,208370,152540,158372,69420,24558,176034,192848,207074,199045,7914,196186,154511,92659,7467,142596,103731,43913,183193,66491,142844,176531,129151,46042,16371};

static const __m256i V_B4Q_B4Q_B4Q_B4Q = {BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q};
static const __m256i V_B8Q_B8Q_B8Q_B8Q = {BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q};
static const __m256i V_B16Q_B16Q_B16Q_B16Q = {BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q};
static const __m256i V_Q_Q_Q_Q = {Q, Q, Q, Q};
static const __m256i V_Q2_Q2_Q2_Q2 = {Q2, Q2, Q2, Q2};
static const __m256i V_MM_MM_MM_MM = {MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK};
static const __m256i V_MF_MF_MF_MF = {MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint64_t *a, uint32_t n, const uint64_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	__m256i u, v, t, t1, o, u1, v1, r1, r2;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			j_omega = 0;

			for (j = j1; j < j2; j += 4)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = _mm256_loadu_si256((__m256i *)(a + j));
				v = _mm256_loadu_si256((__m256i *)(a + j + d));
				
				t = _mm256_add_epi64(u, v);
				t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
				t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				r1 = _mm256_sub_epi64(t, t1);
				
				t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
				t = _mm256_sub_epi64(t, v);
				o = _mm256_set_epi64x(omega[j_omega + num_of_problems * 3], omega[j_omega + num_of_problems * 2], omega[j_omega + num_of_problems], omega[j_omega]);
				t = _mm256_mul_epu32(t, o);
				t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
				t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				t1 = _mm256_add_epi64(t, t1);
				r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);

				_mm256_storeu_si256((__m256i *)(a + j), r1);
				_mm256_storeu_si256((__m256i *)(a + j + d), r2);

				j_omega += num_of_problems * 4;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k += 2)
	{
		j = k << 2;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);
		
		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		o = _mm256_set_epi64x(omega[num_of_problems], omega[0], omega[num_of_problems], omega[0]);
		t = _mm256_mul_epu32(t, o);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
		
		u = _mm256_permute2f128_si256(r1, r2, 0x20);
		v = _mm256_permute2f128_si256(r1, r2, 0x31);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
	
	for (k = 0; k < (n >> 1); k += 4)
	{
		j = k << 1;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u1 = _mm256_permute4x64_epi64(u1, 0xD8);
		v1 = _mm256_permute4x64_epi64(v1, 0xD8);
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);

		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r2 = _mm256_sub_epi64(t, t1);

		u1 = _mm256_permute2f128_si256(r1, r2, 0x20);
		v1 = _mm256_permute2f128_si256(r1, r2, 0x31);
		u = _mm256_permute4x64_epi64(u1, 0xD8);
		v = _mm256_permute4x64_epi64(v1, 0xD8);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint64_t *a, uint32_t N1, uint32_t N2, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t))
{
	uint32_t n1, n2;
	__m256i u, v, t, t1;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint64_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), uint64_t inv_n)
{
	uint32_t i, n1, n2;
	__m256i u, v, t, t1;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i += 4)
	{
		u = _mm256_loadu_si256((__m256i *)(a + i));
		v = _mm256_set1_epi64x(inv_n);
		
		t = _mm256_mul_epu32(u, v);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
		_mm256_storeu_si256((__m256i *)(a + i), u);
	}
}

/* 256 * 3 --> 256 * 5 */
static void ntt_butterfly_768_1280(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_5[0][0]);
	d1 = _mm256_mul_epu32(d, w_5[0][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 + n2), t);
	a[N2_1280 + n2] %= Q;
	a[N2_1280 + n2 + 1] %= Q;
	a[N2_1280 + n2 + 2] %= Q;
	a[N2_1280 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_5[1][0]);
	d1 = _mm256_mul_epu32(d, w_5[1][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 2 + n2), t);
	a[N2_1280 * 2 + n2] %= Q;
	a[N2_1280 * 2 + n2 + 1] %= Q;
	a[N2_1280 * 2 + n2 + 2] %= Q;
	a[N2_1280 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[2][0]);
	d1 = _mm256_mul_epu32(d, w_5[2][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 3 + n2), t);
	a[N2_1280 * 3 + n2] %= Q;
	a[N2_1280 * 3 + n2 + 1] %= Q;
	a[N2_1280 * 3 + n2 + 2] %= Q;
	a[N2_1280 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[3][0]);
	d1 = _mm256_mul_epu32(d, w_5[3][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 4 + n2), t);
	a[N2_1280 * 4 + n2] %= Q;
	a[N2_1280 * 4 + n2 + 1] %= Q;
	a[N2_1280 * 4 + n2 + 2] %= Q;
	a[N2_1280 * 4 + n2 + 3] %= Q;
}

/* 256 * 5 --> 256 * 2 */
static void ntt_butterfly_1280_512(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, c1, d1, e1, f1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 4 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_5[0][0]);
	d1 = _mm256_mul_epu32(d, w_5[0][1]);
	e1 = _mm256_mul_epu32(e, w_5[0][2]);
	f1 = _mm256_mul_epu32(f, w_5[0][3]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 + n2), t);
	a[N2_1280 + n2] %= Q;
	a[N2_1280 + n2 + 1] %= Q;
	a[N2_1280 + n2 + 2] %= Q;
	a[N2_1280 + n2 + 3] %= Q;
}

/* 256 * 1 --> 256 * 4 */
static void ntt_butterfly_256_1024(uint64_t *a, uint32_t n2)
{
	__m256i t;
	
	t = _mm256_loadu_si256((__m256i *)(a + n2));
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
}

/* 256 * 3 --> 256 * 4 */
static void ntt_butterfly_768_1024(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_4[0][0]);
	d1 = _mm256_mul_epu32(d, w_4[0][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	a[N2_1024 + n2] %= Q;
	a[N2_1024 + n2 + 1] %= Q;
	a[N2_1024 + n2 + 2] %= Q;
	a[N2_1024 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4[1][0]);
	d1 = _mm256_mul_epu32(d, w_4[1][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	a[N2_1024 * 2 + n2] %= Q;
	a[N2_1024 * 2 + n2 + 1] %= Q;
	a[N2_1024 * 2 + n2 + 2] %= Q;
	a[N2_1024 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4[2][0]);
	d1 = _mm256_mul_epu32(d, w_4[2][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
	a[N2_1024 * 3 + n2] %= Q;
	a[N2_1024 * 3 + n2 + 1] %= Q;
	a[N2_1024 * 3 + n2 + 2] %= Q;
	a[N2_1024 * 3 + n2 + 3] %= Q;
}

/* 256 * 4 --> 256 * 4 */
static void ntt_butterfly_1024_1024_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 3 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_4_inv[0][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[0][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	a[N2_1024 + n2] %= Q;
	a[N2_1024 + n2 + 1] %= Q;
	a[N2_1024 + n2 + 2] %= Q;
	a[N2_1024 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4_inv[1][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[1][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	a[N2_1024 * 2 + n2] %= Q;
	a[N2_1024 * 2 + n2 + 1] %= Q;
	a[N2_1024 * 2 + n2 + 2] %= Q;
	a[N2_1024 * 2 + n2 + 3] %= Q;	

	c1 = _mm256_mul_epu32(c, w_4_inv[2][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[2][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
	a[N2_1024 * 3 + n2] %= Q;
	a[N2_1024 * 3 + n2 + 1] %= Q;
	a[N2_1024 * 3 + n2 + 2] %= Q;
	a[N2_1024 * 3 + n2 + 3] %= Q;	
}

/* 256 * 2 --> 256 * 2 */
static void ntt_butterfly_512_512_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_512 + n2));

	t = _mm256_add_epi64(b, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, b);
	t = _mm256_sub_epi64(t, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + N2_512 + n2), t);
}

/* 256 * 2 --> 256 * 1 */
static void ntt_butterfly_512_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_512 + n2));

	t = _mm256_add_epi64(b, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

/* 256 * 4 --> 256 * 5 */
static void ntt_butterfly_1024_1280(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 3 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_5[0][0]);
	d1 = _mm256_mul_epu32(d, w_5[0][1]);
	e1 = _mm256_mul_epu32(e, w_5[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 + n2), t);
	a[N2_1280 + n2] %= Q;
	a[N2_1280 + n2 + 1] %= Q;
	a[N2_1280 + n2 + 2] %= Q;
	a[N2_1280 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_5[1][0]);
	d1 = _mm256_mul_epu32(d, w_5[1][1]);
	e1 = _mm256_mul_epu32(e, w_5[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 2 + n2), t);
	a[N2_1280 * 2 + n2] %= Q;
	a[N2_1280 * 2 + n2 + 1] %= Q;
	a[N2_1280 * 2 + n2 + 2] %= Q;
	a[N2_1280 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[2][0]);
	d1 = _mm256_mul_epu32(d, w_5[2][1]);
	e1 = _mm256_mul_epu32(e, w_5[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 3 + n2), t);
	a[N2_1280 * 3 + n2] %= Q;
	a[N2_1280 * 3 + n2 + 1] %= Q;
	a[N2_1280 * 3 + n2 + 2] %= Q;
	a[N2_1280 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[3][0]);
	d1 = _mm256_mul_epu32(d, w_5[3][1]);
	e1 = _mm256_mul_epu32(e, w_5[3][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 4 + n2), t);
	a[N2_1280 * 4 + n2] %= Q;
	a[N2_1280 * 4 + n2 + 1] %= Q;
	a[N2_1280 * 4 + n2 + 2] %= Q;
	a[N2_1280 * 4 + n2 + 3] %= Q;
}

/* 256 * 5 --> 256 * 1 */
static void ntt_butterfly_1280_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 4 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

void ntt_768_1280(uint64_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_768_1280);
}

void intt_1280_512(uint64_t *a)
{
	intt_core(a, N1_1280, N2_1280, 512, omega_256, omega_1280, ntt_butterfly_1280_512, INV_1280);
}

void ntt_256_1024(uint64_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_256_1024);
}

void ntt_768_1024(uint64_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_768_1024);
}

void intt_1024_1024_inv(uint64_t *a)
{
	intt_core(a, N1_1024, N2_1024, 1024, omega_256_inv, omega_1024_inv, ntt_butterfly_1024_1024_inv, INV_1024);
}

void ntt_512_512_inv(uint64_t *a)
{
	ntt_core(a, N1_512, N2_512, omega_256_inv, omega_512_inv, ntt_butterfly_512_512_inv);
}

void intt_512_256(uint64_t *a)
{
	intt_core(a, N1_512, N2_512, 256, omega_256, omega_512, ntt_butterfly_512_256, INV_512);
}

void ntt_1024_1280(uint64_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_1024_1280);
}

void intt_1280_256(uint64_t *a)
{
	intt_core(a, N1_1280, N2_1280, 256, omega_256, omega_1280, ntt_butterfly_1280_256, INV_1280);
}
