/* ****************************** *
 * Titanium_CPA_std               *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>
#include <x86intrin.h>

/* 768=3*256 */
#define N1_768 3
#define N2_768 256

/* 1536=3*512 */
#define N1_1536 3
#define N2_1536 512

/* 1792=7*256 */
#define N1_1792 7
#define N2_1792 256

/* multiplication inverses of 768, 1536, 1792 (in Montgomery form) */
#define INV_768 29355
#define INV_1536 57686
#define INV_1792 37157

/* omega_n: n-th root of unity mod Q */
static const __m256i w_3[2]={{40648,40648,40648,40648},{45368,45368,45368,45368}};

static const __m256i w_7[6][6]={{{3429,3429,3429,3429},{59729,59729,59729,59729},{4264,4264,4264,4264},{84383,84383,84383,84383},{74136,74136,74136,74136},{32109,32109,32109,32109}},
{{59729,59729,59729,59729},{84383,84383,84383,84383},{32109,32109,32109,32109},{3429,3429,3429,3429},{4264,4264,4264,4264},{74136,74136,74136,74136}},
{{4264,4264,4264,4264},{32109,32109,32109,32109},{59729,59729,59729,59729},{74136,74136,74136,74136},{3429,3429,3429,3429},{84383,84383,84383,84383}},
{{84383,84383,84383,84383},{3429,3429,3429,3429},{74136,74136,74136,74136},{59729,59729,59729,59729},{32109,32109,32109,32109},{4264,4264,4264,4264}},
{{74136,74136,74136,74136},{4264,4264,4264,4264},{3429,3429,3429,3429},{32109,32109,32109,32109},{84383,84383,84383,84383},{59729,59729,59729,59729}},
{{32109,32109,32109,32109},{74136,74136,74136,74136},{84383,84383,84383,84383},{4264,4264,4264,4264},{59729,59729,59729,59729},{3429,3429,3429,3429}}};

static const __m256i w_3_inv[2]={{45368,45368,45368,45368},{40648,40648,40648,40648}};

/* omega_256,512,768,1536,1792, respectively (in Montgomery form) */
static const uint64_t omega_256[128]={8186,66903,49380,14303,71387,41558,40532,72938,57460,41797,27953,37140,16088,11990,44844,57973,25594,35692,1963,23010,50405,55370,60022,9167,72136,61161,17961,24261,1838,3316,49693,69810,43580,29485,72757,23438,166,17896,69071,63400,62435,85872,73494,64547,85564,80707,54535,79856,45699,30968,9820,5736,42172,1018,39276,58785,61316,69907,56110,52746,3060,21058,79362,42187,17144,11836,5442,52967,22740,18188,33188,74009,73432,60972,55621,25937,37434,5293,76285,65932,83570,12901,32167,83118,20135,27528,38994,48074,61086,23348,75444,10502,45061,27477,1369,55353,18808,68938,29371,19013,59948,27098,64145,31862,41946,4635,79965,36723,32277,669,48287,66431,63785,74923,12370,80629,22290,50510,82235,39976,65851,13693,75060,10558,59389,68396,25866,6980};
static const uint64_t omega_512[256]={8186,56662,66903,9657,49380,25472,14303,53630,71387,81780,41558,9578,40532,66700,72938,83458,57460,70262,41797,36346,27953,34124,37140,30864,16088,81516,11990,52625,44844,33542,57973,41701,25594,27967,35692,40722,1963,47822,23010,82627,50405,54255,55370,8216,60022,13138,9167,80517,72136,79651,61161,54689,17961,33241,24261,50705,1838,33822,3316,27324,49693,60528,69810,77190,43580,64008,29485,33674,72757,63186,23438,44546,166,18592,17896,25961,69071,80439,63400,47406,62435,25343,85872,69777,73494,59713,64547,3836,85564,35281,80707,7399,54535,713,79856,84121,45699,43285,30968,27736,9820,67636,5736,40313,42172,78346,1018,27999,39276,12045,58785,46628,61316,72049,69907,2037,56110,5079,52746,58396,3060,84669,21058,36037,79362,28793,42187,80026,17144,27754,11836,35377,5442,7385,52967,83148,22740,52387,18188,58665,33188,18325,74009,31376,73432,52769,60972,33521,55621,36328,25937,66383,37434,63792,5293,76714,76285,28237,65932,72939,83570,70004,12901,68640,32167,76007,83118,19380,20135,18678,27528,72541,38994,66478,48074,51234,61086,46289,23348,34466,75444,20062,10502,58003,45061,57846,27477,66829,1369,67311,55353,6312,18808,42088,68938,65543,29371,20906,19013,65048,59948,4850,27098,24381,64145,44829,31862,41847,41946,53034,4635,3018,79965,10312,36723,70177,32277,2310,669,74928,48287,75090,66431,42810,63785,4509,74923,47727,12370,9168,80629,84680,22290,1987,50510,66015,82235,6501,39976,4428,65851,63867,13693,71327,75060,63071,10558,64275,59389,28259,68396,4839,25866,58431,6980,7607};
static const uint64_t omega_768[768]={8186,70095,54170,66903,5906,60197,49380,24227,53942,14303,5427,38726,71387,36841,40945,41558,50180,6573,40532,71531,47426,72938,41537,18172,57460,35159,4518,41797,25337,74606,27953,80530,78721,37140,70689,1064,16088,59580,14181,11990,55824,3308,44844,77876,35358,57973,67492,27100,25594,40334,3216,35692,83719,85548,1963,75600,52037,23010,74992,55132,50405,17736,85145,55370,40422,71808,60022,69370,75545,9167,29308,73208,72136,2894,3660,61161,3162,63979,17961,10291,13966,24261,64804,58892,1838,40726,27252,3316,11981,17530,49693,17965,36868,69810,74437,44800,43580,23193,22139,29485,23498,48740,72757,64670,71741,23438,80170,9250,166,27733,81084,17896,30004,52688,69071,45801,49661,63400,20201,12470,62435,81279,44774,85872,4275,40063,73494,37009,38958,64547,7147,26575,85564,22254,40925,80707,29011,13744,54535,62074,26668,79856,30372,3279,45699,17075,15650,30968,6470,22806,9820,45649,71939,5736,5887,84486,42172,43942,62944,1018,11512,19493,39276,70002,59878,58785,43552,9188,61316,22321,77509,69907,9289,22745,56110,54198,80908,52746,67361,81386,3060,31393,56228,21058,7966,70649,79362,59767,73922,42187,79093,14308,17144,22514,48090,11836,21805,3739,5442,73877,22751,52967,51947,70155,22740,44393,70410,18188,77751,484,33188,47798,50106,74009,39622,3445,73432,12142,33546,60972,59158,5860,55621,9293,49322,25937,18357,60904,37434,2699,62799,5293,51575,6970,76285,22943,38408,65932,70127,8735,83570,63246,72199,12901,23033,77280,32167,80866,74747,83118,70640,41068,20135,47043,1179,27528,30772,80469,38994,45689,79658,48074,77562,56480,61086,85458,49108,23348,41298,43015,75444,47738,81536,10502,61135,45454,45061,35885,54300,27477,14479,56594,1369,42689,16835,55353,34991,6505,18808,68370,54604,68938,43790,85222,29371,83215,5492,19013,32665,78048,59948,50789,74635,27098,55314,12412,64145,45694,5358,31862,54265,31475,41946,47639,4370,4635,23517,24451,79965,44955,62739,36723,74085,28483,32277,80589,62151,669,36632,50073,48287,8994,19578,66431,52449,7897,63785,62240,54401,74923,48268,33283,12370,129,61451,80629,69870,43007,22290,22067,67201,50510,5742,2744,82235,31419,13936,39976,76059,26640,65851,69549,82132,13693,38242,38199,75060,76856,53566,10558,3128,53117,59389,13880,11966,68396,12312,1839,25866,41213,15860,6980,13702,76536,77831,15922,31847,19114,80111,25820,36637,61790,32075,71714,80590,47291,14630,49176,45072,44459,35837,79444,45485,14486,38591,13079,44480,67845,28557,50858,81499,44220,60680,11411,58064,5487,7296,48877,15328,84953,69929,26437,71836,74027,30193,82709,41173,8141,50659,28044,18525,58917,60423,45683,82801,50325,2298,469,84054,10417,33980,63007,11025,30885,35612,68281,872,30647,45595,14209,25995,16647,10472,76850,56709,12809,13881,83123,82357,24856,82855,22038,68056,75726,72051,61756,21213,27125,84179,45291,58765,82701,74036,68487,36324,68052,49149,16207,11580,41217,42437,62824,63878,56532,62519,37277,13260,21347,14276,62579,5847,76767,85851,58284,4933,68121,56013,33329,16946,40216,36356,22617,65816,73547,23582,4738,41243,145,81742,45954,12523,49008,47059,21470,78870,59442,453,63763,45092,5310,57006,72273,31482,23943,59349,6161,55645,82738,40318,68942,70367,55049,79547,63211,76197,40368,14078,80281,80130,1531,43845,42075,23073,84999,74505,66524,46741,16015,26139,27232,42465,76829,24701,63696,8508,16110,76728,63272,29907,31819,5109,33271,18656,4631,82957,54624,29789,64959,78051,15368,6655,26250,12095,43830,6924,71709,68873,63503,37927,74181,64212,82278,80575,12140,63266,33050,34070,15862,63277,41624,15607,67829,8266,85533,52829,38219,35911,12008,46395,82572,12585,73875,52471,25045,26859,80157,30396,76724,36695,60080,67660,25113,48583,83318,23218,80724,34442,79047,9732,63074,47609,20085,15890,77282,2447,22771,13818,73116,62984,8737,53850,5151,11270,2899,15377,44949,65882,38974,84838,58489,55245,5548,47023,40328,6359,37943,8455,29537,24931,559,36909,62669,44719,43002,10573,38279,4481,75515,24882,40563,40956,50132,31717,58540,71538,29423,84648,43328,69182,30664,51026,79512,67209,17647,31413,17079,42227,795,56646,2802,80525,67004,53352,7969,26069,35228,11382,58919,30703,73605,21872,40323,80659,54155,31752,54542,44071,38378,81647,81382,62500,61566,6052,41062,23278,49294,11932,57534,53740,5428,23866,85348,49385,35944,37730,77023,66439,19586,33568,78120,22232,23777,31616,11094,37749,52734,73647,85888,24566,5388,16147,43010,63727,63950,18816,35507,80275,83273,3782,54598,72081,46041,9958,59377,20166,16468,3885,72324,47775,47818,10957,9161,32451,75459,82889,32900,26628,72137,74051,17621,73705,84178,60151,44804,70157,79037,72315,9481};
static const uint64_t omega_1536[1536]={8186,29668,70095,56662,54170,23093,66903,45850,5906,9657,60197,59353,49380,32738,24227,25472,53942,46897,14303,20314,5427,53630,38726,5705,71387,36462,36841,81780,40945,83393,41558,26939,50180,9578,6573,29055,40532,48040,71531,66700,47426,11891,72938,64675,41537,83458,18172,7226,57460,56873,35159,70262,4518,67043,41797,75931,25337,36346,74606,85200,27953,12223,80530,34124,78721,73592,37140,43018,70689,30864,1064,3604,16088,33151,59580,81516,14181,49651,11990,39966,55824,52625,3308,59064,44844,26428,77876,33542,35358,34395,57973,3314,67492,41701,27100,75625,25594,24605,40334,27967,3216,44524,35692,16124,83719,40722,85548,675,1963,33489,75600,47822,52037,37534,23010,65005,74992,82627,55132,55455,50405,67577,17736,54255,85145,8041,55370,74370,40422,8216,71808,54380,60022,42915,69370,13138,75545,27910,9167,31374,29308,80517,73208,13850,72136,27681,2894,79651,3660,66077,61161,65852,3162,54689,63979,10076,17961,26237,10291,33241,13966,34371,24261,15886,64804,50705,58892,32620,1838,58612,40726,33822,27252,2411,3316,41629,11981,27324,17530,51617,49693,70986,17965,60528,36868,33689,69810,400,74437,77190,44800,79312,43580,28614,23193,64008,22139,17106,29485,71092,23498,33674,48740,51266,72757,39809,64670,63186,71741,17612,23438,35411,80170,44546,9250,33272,166,3796,27733,18592,81084,9484,17896,49623,30004,25961,52688,5785,69071,51900,45801,80439,49661,54709,63400,56944,20201,47406,12470,26070,62435,20368,81279,25343,44774,71463,85872,25702,4275,69777,40063,48715,73494,14172,37009,59713,38958,16192,64547,62446,7147,3836,26575,26311,85564,51822,22254,35281,40925,83972,80707,24699,29011,7399,13744,66603,54535,77039,62074,713,26668,70928,79856,62238,30372,84121,3279,47001,45699,23180,17075,43285,15650,20026,30968,32460,6470,27736,22806,36504,9820,59779,45649,67636,71939,37685,5736,57587,5887,40313,84486,57225,42172,562,43942,78346,62944,18535,1018,82351,11512,27999,19493,85106,39276,32791,70002,12045,59878,12677,58785,83027,43552,46628,9188,60872,61316,82869,22321,72049,77509,5459,69907,79308,9289,2037,22745,8164,56110,52947,54198,5079,80908,48986,52746,29911,67361,58396,81386,60953,3060,83447,31393,84669,56228,75336,21058,18295,7966,36037,70649,32022,79362,85141,59767,28793,73922,70595,42187,21632,79093,80026,14308,84682,17144,54190,22514,27754,48090,27075,11836,53026,21805,35377,3739,33684,5442,74700,73877,7385,22751,16592,52967,53619,51947,83148,70155,54925,22740,29813,44393,52387,70410,69047,18188,58373,77751,58665,484,20395,33188,54208,47798,18325,50106,20322,74009,20767,39622,31376,3445,50797,73432,41772,12142,52769,33546,69649,60972,58421,59158,33521,5860,2387,55621,54201,9293,36328,49322,8612,25937,18976,18357,66383,60904,77593,37434,25905,2699,63792,62799,44237,5293,66111,51575,76714,6970,13261,76285,6487,22943,28237,38408,75123,65932,846,70127,72939,8735,26677,83570,32133,63246,70004,72199,30158,12901,690,23033,68640,77280,85203,32167,53660,80866,76007,74747,25207,83118,28015,70640,19380,41068,84133,20135,40715,47043,18678,1179,21779,27528,46031,30772,72541,80469,5784,38994,66760,45689,66478,79658,42165,48074,61945,77562,51234,56480,85244,61086,46519,85458,46289,49108,23409,23348,81025,41298,34466,43015,66475,75444,728,47738,20062,81536,13602,10502,14230,61135,58003,45454,51777,45061,15845,35885,57846,54300,62338,27477,60410,14479,66829,56594,73342,1369,59287,42689,67311,16835,50233,55353,79163,34991,6312,6505,48227,18808,40424,68370,42088,54604,1927,68938,8441,43790,65543,85222,1511,29371,82994,83215,20906,5492,30244,19013,12985,32665,65048,78048,45766,59948,53659,50789,4850,74635,11246,27098,15471,55314,24381,12412,1944,64145,13872,45694,44829,5358,42725,31862,83994,54265,41847,31475,56490,41946,84520,47639,53034,4370,2514,4635,59355,23517,3018,24451,53394,79965,71985,44955,10312,62739,45974,36723,59391,74085,70177,28483,39888,32277,7467,80589,2310,62151,80200,669,79552,36632,74928,50073,59985,48287,17071,8994,75090,19578,61141,66431,42311,52449,42810,7897,25132,63785,24294,62240,4509,54401,3503,74923,71722,48268,47727,33283,72962,12370,28965,129,9168,61451,14448,80629,1152,69870,84680,43007,83910,22290,85849,22067,1987,67201,63028,50510,43033,5742,66015,2744,40985,82235,49277,31419,6501,13936,78248,39976,12526,76059,4428,26640,2925,65851,59102,69549,63867,82132,47958,13693,80982,38242,71327,38199,68271,75060,63455,76856,63071,53566,6172,10558,64219,3128,64275,53117,6268,59389,13931,13880,28259,11966,6254,68396,49937,12312,4839,1839,2672,25866,33934,41213,58431,15860,56955,6980,55980,13702,7607,76536,72335,77831,56349,15922,29355,31847,62924,19114,40167,80111,76360,25820,26664,36637,53279,61790,60545,32075,39120,71714,65703,80590,32387,47291,80312,14630,49555,49176,4237,45072,2624,44459,59078,35837,76439,79444,56962,45485,37977,14486,19317,38591,74126,13079,21342,44480,2559,67845,78791,28557,29144,50858,15755,81499,18974,44220,10086,60680,49671,11411,817,58064,73794,5487,51893,7296,12425,48877,42999,15328,55153,84953,82413,69929,52866,26437,4501,71836,36366,74027,46051,30193,33392,82709,26953,41173,59589,8141,52475,50659,51622,28044,82703,18525,44316,58917,10392,60423,61412,45683,58050,82801,41493,50325,69893,2298,45295,469,85342,84054,52528,10417,38195,33980,48483,63007,21012,11025,3390,30885,30562,35612,18440,68281,31762,872,77976,30647,11647,45595,77801,14209,31637,25995,43102,16647,72879,10472,58107,76850,54643,56709,5500,12809,72167,13881,58336,83123,6366,82357,19940,24856,20165,82855,31328,22038,75941,68056,59780,75726,52776,72051,51646,61756,70131,21213,35312,27125,53397,84179,27405,45291,52195,58765,83606,82701,44388,74036,58693,68487,34400,36324,15031,68052,25489,49149,52328,16207,85617,11580,8827,41217,6705,42437,57403,62824,22009,63878,68911,56532,14925,62519,52343,37277,34751,13260,46208,21347,22831,14276,68405,62579,50606,5847,41471,76767,52745,85851,82221,58284,67425,4933,76533,68121,36394,56013,60056,33329,80232,16946,34117,40216,5578,36356,31308,22617,29073,65816,38611,73547,59947,23582,65649,4738,60674,41243,14554,145,60315,81742,16240,45954,37302,12523,71845,49008,26304,47059,69825,21470,23571,78870,82181,59442,59706,453,34195,63763,50736,45092,2045,5310,61318,57006,78618,72273,19414,31482,8978,23943,85304,59349,15089,6161,23779,55645,1896,82738,39016,40318,62837,68942,42732,70367,65991,55049,53557,79547,58281,63211,49513,76197,26238,40368,18381,14078,48332,80281,28430,80130,45704,1531,28792,43845,85455,42075,7671,23073,67482,84999,3666,74505,58018,66524,911,46741,53226,16015,73972,26139,73340,27232,2990,42465,39389,76829,25145,24701,3148,63696,13968,8508,80558,16110,6709,76728,83980,63272,77853,29907,33070,31819,80938,5109,37031,33271,56106,18656,27621,4631,25064,82957,2570,54624,1348,29789,10681,64959,67722,78051,49980,15368,53995,6655,876,26250,57224,12095,15422,43830,64385,6924,5991,71709,1335,68873,31827,63503,58263,37927,58942,74181,32991,64212,50640,82278,52333,80575,11317,12140,78632,63266,69425,33050,32398,34070,2869,15862,31092,63277,56204,41624,33630,15607,16970,67829,27644,8266,27352,85533,65622,52829,31809,38219,67692,35911,65695,12008,65250,46395,54641,82572,35220,12585,44245,73875,33248,52471,16368,25045,27596,26859,52496,80157,83630,30396,31816,76724,49689,36695,77405,60080,67041,67660,19634,25113,8424,48583,60112,83318,22225,23218,41780,80724,19906,34442,9303,79047,72756,9732,79530,63074,57780,47609,10894,20085,85171,15890,13078,77282,59340,2447,53884,22771,16013,13818,55859,73116,85327,62984,17377,8737,814,53850,32357,5151,10010,11270,60810,2899,58002,15377,66637,44949,1884,65882,45302,38974,67339,84838,64238,58489,39986,55245,13476,5548,80233,47023,19257,40328,19539,6359,43852,37943,24072,8455,34783,29537,773,24931,39498,559,39728,36909,62608,62669,4992,44719,51551,43002,19542,10573,85289,38279,65955,4481,72415,75515,71787,24882,28014,40563,34240,40956,70172,50132,28171,31717,23679,58540,25607,71538,19188,29423,12675,84648,26730,43328,18706,69182,35784,30664,6854,51026,79705,79512,37790,67209,45593,17647,43929,31413,84090,17079,77576,42227,20474,795,84506,56646,3023,2802,65111,80525,55773,67004,73032,53352,20969,7969,40251,26069,32358,35228,81167,11382,74771,58919,70546,30703,61636,73605,84073,21872,72145,40323,41188,80659,43292,54155,2023,31752,44170,54542,29527,44071,1497,38378,32983,81647,83503,81382,26662,62500,82999,61566,32623,6052,14032,41062,75705,23278,40043,49294,26626,11932,15840,57534,46129,53740,78550,5428,83707,23866,5817,85348,6465,49385,11089,35944,26032,37730,68946,77023,10927,66439,24876,19586,43706,33568,43207,78120,60885,22232,61723,23777,81508,31616,82514,11094,14295,37749,38290,52734,13055,73647,57052,85888,76849,24566,71569,5388,84865,16147,1337,43010,2107,63727,168,63950,84030,18816,22989,35507,42984,80275,20002,83273,45032,3782,36740,54598,79516,72081,7769,46041,73491,9958,81589,59377,83092,20166,26915,16468,22150,3885,38059,72324,5035,47775,14690,47818,17746,10957,22562,9161,22946,32451,79845,75459,21798,82889,21742,32900,79749,26628,72086,72137,57758,74051,79763,17621,36080,73705,81178,84178,83345,60151,52083,44804,27586,70157,29062,79037,30037,72315,78410,9481,13682};
static const uint64_t omega_1792[1792]={8186,44675,62648,29104,58380,30757,35510,66903,2445,5200,24428,55999,29563,41414,49380,48028,27914,32278,36634,18985,40553,14303,164,64026,13213,34082,52784,78311,71387,78825,1415,75130,20118,49647,19044,41558,15385,30258,28468,72331,8888,18727,40532,53309,49348,46025,12748,13040,85078,72938,11938,42980,77513,5309,55443,5513,57460,80692,72581,72921,18938,29547,83421,41797,38409,52136,16246,65335,76332,36219,27953,21279,6733,15551,78281,53381,75359,37140,13025,76075,71205,72809,54936,62483,16088,39317,12202,81009,73607,34997,85865,11990,56987,37645,58075,19730,57617,71703,44844,43658,71567,14827,22211,32814,48680,57973,61730,63036,21134,5721,27471,7237,25594,16086,55320,502,26046,12122,32993,35692,72919,34941,17847,28458,66329,36405,1963,77175,43289,56534,6602,74552,67,23010,47882,77912,38348,67134,3464,66295,50405,61114,2974,30248,22466,13831,78141,55370,30512,60495,9925,21812,85792,36989,60022,52895,7306,32601,75668,16161,14318,9167,65759,38359,22126,67814,67532,1496,72136,63883,82215,57702,36703,25992,14118,61161,13980,47147,66850,39448,39218,73206,17961,62474,45093,72684,65928,19369,64589,24261,58986,84817,53913,33394,52728,10293,1838,2150,175,19018,77563,35319,3875,3316,46279,44775,36651,11985,53986,8395,49693,81060,52607,75296,68141,74560,22072,69810,9683,65801,46364,9775,17799,68462,43580,7548,74629,29079,43375,56541,79617,29485,63412,23165,54896,38475,40139,58278,72757,40929,16334,49339,75030,46115,66766,23438,63920,1202,16101,64323,2235,51192,166,48023,24913,3028,28252,80315,35543,17896,23461,8911,49735,3048,40256,25281,69071,30627,43501,80556,42564,51474,66202,63400,33166,70713,52765,15297,46254,29770,62435,56092,16568,69362,67658,25511,35083,85872,85005,11920,14973,58230,26744,18180,73494,35988,26934,46201,66773,10436,18853,64547,16256,71337,48815,52983,77327,31299,85564,54974,16477,66354,51410,62196,33068,80707,81584,74654,44084,17591,12434,31018,54535,45447,78714,72420,27899,23275,34901,79856,52509,85290,10943,47900,19902,57631,45699,40727,84331,71877,28855,29354,36396,30968,24525,10998,80911,83601,63816,59205,9820,44808,73661,33001,57697,33702,82759,5736,36474,8970,50740,4130,70350,75740,42172,5433,9444,42777,24486,21997,24795,1018,26088,20127,20642,71694,73849,77025,39276,39204,13193,22078,21801,44783,58656,58785,15787,82301,57709,23701,66942,77463,61316,20994,7710,68641,30592,22494,47840,69907,50699,31132,2534,24211,28976,50368,56110,44575,2628,46223,62774,53119,21327,52746,38300,21121,66732,37438,37054,13018,3060,30255,9464,54781,55469,55525,37526,21058,11716,12956,69068,11623,25951,41120,79362,48468,33951,25768,97,41016,51348,42187,14436,11177,67923,12530,37027,14016,17144,19399,82595,27727,23261,60905,83973,11836,84980,82932,40757,16320,75343,79147,5442,66456,9410,56777,83637,33813,11754,52967,33317,23716,75945,79196,445,9038,22740,57862,46718,15805,24291,76992,2266,18188,9482,82788,74752,34090,74789,39094,33188,66714,9431,17771,34453,51814,12219,74009,1023,29089,49377,29024,10364,78859,73432,15979,8302,62688,53112,34329,11796,60972,20966,59718,76875,35263,21874,19784,55621,43535,66556,69430,39658,79243,11451,25937,67124,83479,7795,33641,11740,78971,37434,69060,75635,65168,79319,5456,40452,5293,11433,83947,47841,18897,56549,15605,76285,25213,11054,62912,67133,54474,60445,65932,73380,1972,48170,9922,2808,68242,83570,10803,49889,61072,80986,42599,72481,12901,36057,33941,19766,27614,24252,1974,32167,21622,57771,43710,85574,60976,74977,83118,14767,72216,25882,34113,19780,1610,20135,42647,32477,35650,64914,47292,67862,27528,24245,14976,77234,44294,57616,36696,38994,59185,83833,13825,40133,20270,37657,48074,3913,43327,10528,56868,628,50061,61086,54982,38482,27137,13211,50085,41084,23348,9902,76821,37259,50042,84089,29849,75444,2140,80190,46535,60799,71962,79872,10502,6856,20562,23678,35934,28930,74369,45061,70681,50762,131,27016,78214,30371,27477,45245,60694,8941,67741,6514,4531,1369,13114,9069,75753,67178,81483,65644,55353,37512,47062,15833,58300,68758,83612,18808,37538,11057,81916,84683,7893,23647,68938,19614,39604,81239,39619,4225,41352,29371,29396,44401,18617,60527,11928,36978,19013,74562,6069,81510,64646,41269,48368,59948,42887,4491,63378,37165,28030,50291,27098,24210,79986,44518,71637,56841,1626,64145,50230,42096,11428,80946,18591,10515,31862,10595,79878,48510,41956,13417,36099,41946,7415,63616,25182,44058,53596,32368,4635,29383,19395,28584,4327,85369,23952,79965,83524,34804,38840,1161,43103,82524,36723,37996,45101,8672,26711,67187,52478,32277,1627,13135,56080,26569,85179,81948,669,23059,42885,20494,51678,68219,52562,48287,62942,85139,57940,24720,42020,17423,66431,80422,82561,41727,82412,72721,70932,63785,6192,504,10043,23822,1939,11160,74923,85114,42935,50504,110,66022,41381,12370,27012,24203,6971,3568,8292,56686,80629,17565,48439,50952,28152,20295,52662,22290,45823,80745,35578,38903,56177,67585,50510,38118,15105,34236,24791,33024,2688,82235,69706,67686,59520,26849,81201,85625,39976,29259,65394,77337,37301,58047,71738,65851,76374,44224,15602,57281,7663,57635,13693,64127,22223,22813,32863,43683,555,75060,64121,70232,73730,40008,31262,80560,10558,74874,4094,14336,37174,85042,16924,59389,85850,2987,55254,12499,70031,4700,68396,55577,51533,67207,64482,63260,35155,25866,76120,12197,78008,44357,26615,61178,6980,60580,60942,2960,56252,26583,59175,77831,41342,23369,56913,27637,55260,50507,19114,83572,80817,61589,30018,56454,44603,36637,37989,58103,53739,49383,67032,45464,71714,85853,21991,72804,51935,33233,7706,14630,7192,84602,10887,65899,36370,66973,44459,70632,55759,57549,13686,77129,67290,45485,32708,36669,39992,73269,72977,939,13079,74079,43037,8504,80708,30574,80504,28557,5325,13436,13096,67079,56470,2596,44220,47608,33881,69771,20682,9685,49798,58064,64738,79284,70466,7736,32636,10658,48877,72992,9942,14812,13208,31081,23534,69929,46700,73815,5008,12410,51020,152,74027,29030,48372,27942,66287,28400,14314,41173,42359,14450,71190,63806,53203,37337,28044,24287,22981,64883,80296,58546,78780,60423,69931,30697,85515,59971,73895,53024,50325,13098,51076,68170,57559,19688,49612,84054,8842,42728,29483,79415,11465,85950,63007,38135,8105,47669,18883,82553,19722,35612,24903,83043,55769,63551,72186,7876,30647,55505,25522,76092,64205,225,49028,25995,33122,78711,53416,10349,69856,71699,76850,20258,47658,63891,18203,18485,84521,13881,22134,3802,28315,49314,60025,71899,24856,72037,38870,19167,46569,46799,12811,68056,23543,40924,13333,20089,66648,21428,61756,27031,1200,32104,52623,33289,75724,84179,83867,85842,66999,8454,50698,82142,82701,39738,41242,49366,74032,32031,77622,36324,4957,33410,10721,17876,11457,63945,16207,76334,20216,39653,76242,68218,17555,42437,78469,11388,56938,42642,29476,6400,56532,22605,62852,31121,47542,45878,27739,13260,45088,69683,36678,10987,39902,19251,62579,22097,84815,69916,21694,83782,34825,85851,37994,61104,82989,57765,5702,50474,68121,62556,77106,36282,82969,45761,60736,16946,55390,42516,5461,43453,34543,19815,22617,52851,15304,33252,70720,39763,56247,23582,29925,69449,16655,18359,60506,50934,145,1012,74097,71044,27787,59273,67837,12523,50029,59083,39816,19244,75581,67164,21470,69761,14680,37202,33034,8690,54718,453,31043,69540,19663,34607,23821,52949,5310,4433,11363,41933,68426,73583,54999,31482,40570,7303,13597,58118,62742,51116,6161,33508,727,75074,38117,66115,28386,40318,45290,1686,14140,57162,56663,49621,55049,61492,75019,5106,2416,22201,26812,76197,41209,12356,53016,28320,52315,3258,80281,49543,77047,35277,81887,15667,10277,43845,80584,76573,43240,61531,64020,61222,84999,59929,65890,65375,14323,12168,8992,46741,46813,72824,63939,64216,41234,27361,27232,70230,3716,28308,62316,19075,8554,24701,65023,78307,17376,55425,63523,38177,16110,35318,54885,83483,61806,57041,35649,29907,41442,83389,39794,23243,32898,64690,33271,47717,64896,19285,48579,48963,72999,82957,55762,76553,31236,30548,30492,48491,64959,74301,73061,16949,74394,60066,44897,6655,37549,52066,60249,85920,45001,34669,43830,71581,74840,18094,73487,48990,72001,68873,66618,3422,58290,62756,25112,2044,74181,1037,3085,45260,69697,10674,6870,80575,19561,76607,29240,2380,52204,74263,33050,52700,62301,10072,6821,85572,76979,63277,28155,39299,70212,61726,9025,83751,67829,76535,3229,11265,51927,11228,46923,52829,19303,76586,68246,51564,34203,73798,12008,84994,56928,36640,56993,75653,7158,12585,70038,77715,23329,32905,51688,74221,25045,65051,26299,9142,50754,64143,66233,30396,42482,19461,16587,46359,6774,74566,60080,18893,2538,78222,52376,74277,7046,48583,16957,10382,20849,6698,80561,45565,80724,74584,2070,38176,67120,29468,70412,9732,60804,74963,23105,18884,31543,25572,20085,12637,84045,37847,76095,83209,17775,2447,75214,36128,24945,5031,43418,13536,73116,49960,52076,66251,58403,61765,84043,53850,64395,28246,42307,443,25041,11040,2899,71250,13801,60135,51904,66237,84407,65882,43370,53540,50367,21103,38725,18155,58489,61772,71041,8783,41723,28401,49321,47023,26832,2184,72192,45884,65747,48360,37943,82104,42690,75489,29149,85389,35956,24931,31035,47535,58880,72806,35932,44933,62669,76115,9196,48758,35975,1928,56168,10573,83877,5827,39482,25218,14055,6145,75515,79161,65455,62339,50083,57087,11648,40956,15336,35255,85886,59001,7803,55646,58540,40772,25323,77076,18276,79503,81486,84648,72903,76948,10264,18839,4534,20373,30664,48505,38955,70184,27717,17259,2405,67209,48479,74960,4101,1334,78124,62370,17079,66403,46413,4778,46398,81792,44665,56646,56621,41616,67400,25490,74089,49039,67004,11455,79948,4507,21371,44748,37649,26069,43130,81526,22639,48852,57987,35726,58919,61807,6031,41499,14380,29176,84391,21872,35787,43921,74589,5071,67426,75502,54155,75422,6139,37507,44061,72600,49918,44071,78602,22401,60835,41959,32421,53649,81382,56634,66622,57433,81690,648,62065,6052,2493,51213,47177,84856,42914,3493,49294,48021,40916,77345,59306,18830,33539,53740,84390,72882,29937,59448,838,4069,85348,62958,43132,65523,34339,17798,33455,37730,23075,878,28077,61297,43997,68594,19586,5595,3456,44290,3605,13296,15085,22232,79825,85513,75974,62195,84078,74857,11094,903,43082,35513,85907,19995,44636,73647,59005,61814,79046,82449,77725,29331,5388,68452,37578,35065,57865,65722,33355,63727,40194,5272,50439,47114,29840,18432,35507,47899,70912,51781,61226,52993,83329,3782,16311,18331,26497,59168,4816,392,46041,56758,20623,8680,48716,27970,14279,20166,9643,41793,70415,28736,78354,28382,72324,21890,63794,63204,53154,42334,85462,10957,21896,15785,12287,46009,54755,5457,75459,11143,81923,71681,48843,975,69093,26628,167,83030,30763,73518,15986,81317,17621,30440,34484,18810,21535,22757,50862,60151,9897,73820,8009,41660,59402,24839,79037,25437,25075,83057,29765,59434,26842};

/* multiplication inverses of omega_256,512,768,1536, respectively (in Montgomery form) */
static const uint64_t omega_256_inv[128]={8186,79037,60151,17621,26628,75459,10957,72324,20166,46041,3782,35507,63727,5388,73647,11094,22232,19586,37730,85348,53740,49294,6052,81382,44071,54155,21872,58919,26069,67004,56646,17079,67209,30664,84648,58540,40956,75515,10573,62669,24931,37943,47023,58489,65882,2899,53850,73116,2447,20085,9732,80724,48583,60080,30396,25045,12585,12008,52829,67829,63277,33050,80575,74181,68873,43830,6655,64959,82957,33271,29907,16110,24701,27232,46741,84999,43845,80281,76197,55049,40318,6161,31482,5310,453,21470,12523,145,23582,22617,16946,68121,85851,62579,13260,56532,42437,16207,36324,82701,84179,61756,68056,24856,13881,76850,25995,30647,35612,63007,84054,50325,60423,28044,41173,74027,69929,48877,58064,44220,28557,13079,45485,44459,14630,71714,36637,19114};
static const uint64_t omega_512_inv[256]={8186,78410,79037,27586,60151,81178,17621,57758,26628,21742,75459,22946,10957,14690,72324,22150,20166,81589,46041,79516,3782,20002,35507,84030,63727,1337,5388,76849,73647,38290,11094,81508,22232,43207,19586,10927,37730,11089,85348,83707,53740,15840,49294,75705,6052,82999,81382,32983,44071,44170,54155,41188,21872,61636,58919,81167,26069,20969,67004,65111,56646,20474,17079,43929,67209,79705,30664,18706,84648,19188,58540,28171,40956,28014,75515,65955,10573,51551,62669,39728,24931,34783,37943,19539,47023,13476,58489,67339,65882,66637,2899,10010,53850,17377,73116,16013,2447,13078,20085,57780,9732,9303,80724,22225,48583,19634,60080,49689,30396,52496,25045,33248,12585,54641,12008,67692,52829,27352,67829,33630,63277,2869,33050,78632,80575,50640,74181,58263,68873,5991,43830,57224,6655,49980,64959,1348,82957,27621,33271,80938,29907,83980,16110,13968,24701,39389,27232,73972,46741,58018,84999,7671,43845,45704,80281,18381,76197,58281,55049,42732,40318,1896,6161,85304,31482,78618,5310,50736,453,82181,21470,26304,12523,16240,145,60674,23582,38611,22617,5578,16946,60056,68121,67425,85851,41471,62579,22831,13260,52343,56532,22009,42437,8827,16207,25489,36324,58693,82701,52195,84179,35312,61756,52776,68056,31328,24856,6366,13881,5500,76850,72879,25995,77801,30647,31762,35612,3390,63007,38195,84054,45295,50325,58050,60423,44316,28044,52475,41173,33392,74027,4501,69929,55153,48877,51893,58064,49671,44220,15755,28557,2559,13079,19317,45485,76439,44459,4237,14630,32387,71714,60545,36637,76360,19114,29355};
static const uint64_t omega_768_inv[768]={8186,9481,72315,79037,70157,44804,60151,84178,73705,17621,74051,72137,26628,32900,82889,75459,32451,9161,10957,47818,47775,72324,3885,16468,20166,59377,9958,46041,72081,54598,3782,83273,80275,35507,18816,63950,63727,43010,16147,5388,24566,85888,73647,52734,37749,11094,31616,23777,22232,78120,33568,19586,66439,77023,37730,35944,49385,85348,23866,5428,53740,57534,11932,49294,23278,41062,6052,61566,62500,81382,81647,38378,44071,54542,31752,54155,80659,40323,21872,73605,30703,58919,11382,35228,26069,7969,53352,67004,80525,2802,56646,795,42227,17079,31413,17647,67209,79512,51026,30664,69182,43328,84648,29423,71538,58540,31717,50132,40956,40563,24882,75515,4481,38279,10573,43002,44719,62669,36909,559,24931,29537,8455,37943,6359,40328,47023,5548,55245,58489,84838,38974,65882,44949,15377,2899,11270,5151,53850,8737,62984,73116,13818,22771,2447,77282,15890,20085,47609,63074,9732,79047,34442,80724,23218,83318,48583,25113,67660,60080,36695,76724,30396,80157,26859,25045,52471,73875,12585,82572,46395,12008,35911,38219,52829,85533,8266,67829,15607,41624,63277,15862,34070,33050,63266,12140,80575,82278,64212,74181,37927,63503,68873,71709,6924,43830,12095,26250,6655,15368,78051,64959,29789,54624,82957,4631,18656,33271,5109,31819,29907,63272,76728,16110,8508,63696,24701,76829,42465,27232,26139,16015,46741,66524,74505,84999,23073,42075,43845,1531,80130,80281,14078,40368,76197,63211,79547,55049,70367,68942,40318,82738,55645,6161,59349,23943,31482,72273,57006,5310,45092,63763,453,59442,78870,21470,47059,49008,12523,45954,81742,145,41243,4738,23582,73547,65816,22617,36356,40216,16946,33329,56013,68121,4933,58284,85851,76767,5847,62579,14276,21347,13260,37277,62519,56532,63878,62824,42437,41217,11580,16207,49149,68052,36324,68487,74036,82701,58765,45291,84179,27125,21213,61756,72051,75726,68056,22038,82855,24856,82357,83123,13881,12809,56709,76850,10472,16647,25995,14209,45595,30647,872,68281,35612,30885,11025,63007,33980,10417,84054,469,2298,50325,82801,45683,60423,58917,18525,28044,50659,8141,41173,82709,30193,74027,71836,26437,69929,84953,15328,48877,7296,5487,58064,11411,60680,44220,81499,50858,28557,67845,44480,13079,38591,14486,45485,79444,35837,44459,45072,49176,14630,47291,80590,71714,32075,61790,36637,25820,80111,19114,31847,15922,77831,76536,13702,6980,15860,41213,25866,1839,12312,68396,11966,13880,59389,53117,3128,10558,53566,76856,75060,38199,38242,13693,82132,69549,65851,26640,76059,39976,13936,31419,82235,2744,5742,50510,67201,22067,22290,43007,69870,80629,61451,129,12370,33283,48268,74923,54401,62240,63785,7897,52449,66431,19578,8994,48287,50073,36632,669,62151,80589,32277,28483,74085,36723,62739,44955,79965,24451,23517,4635,4370,47639,41946,31475,54265,31862,5358,45694,64145,12412,55314,27098,74635,50789,59948,78048,32665,19013,5492,83215,29371,85222,43790,68938,54604,68370,18808,6505,34991,55353,16835,42689,1369,56594,14479,27477,54300,35885,45061,45454,61135,10502,81536,47738,75444,43015,41298,23348,49108,85458,61086,56480,77562,48074,79658,45689,38994,80469,30772,27528,1179,47043,20135,41068,70640,83118,74747,80866,32167,77280,23033,12901,72199,63246,83570,8735,70127,65932,38408,22943,76285,6970,51575,5293,62799,2699,37434,60904,18357,25937,49322,9293,55621,5860,59158,60972,33546,12142,73432,3445,39622,74009,50106,47798,33188,484,77751,18188,70410,44393,22740,70155,51947,52967,22751,73877,5442,3739,21805,11836,48090,22514,17144,14308,79093,42187,73922,59767,79362,70649,7966,21058,56228,31393,3060,81386,67361,52746,80908,54198,56110,22745,9289,69907,77509,22321,61316,9188,43552,58785,59878,70002,39276,19493,11512,1018,62944,43942,42172,84486,5887,5736,71939,45649,9820,22806,6470,30968,15650,17075,45699,3279,30372,79856,26668,62074,54535,13744,29011,80707,40925,22254,85564,26575,7147,64547,38958,37009,73494,40063,4275,85872,44774,81279,62435,12470,20201,63400,49661,45801,69071,52688,30004,17896,81084,27733,166,9250,80170,23438,71741,64670,72757,48740,23498,29485,22139,23193,43580,44800,74437,69810,36868,17965,49693,17530,11981,3316,27252,40726,1838,58892,64804,24261,13966,10291,17961,63979,3162,61161,3660,2894,72136,73208,29308,9167,75545,69370,60022,71808,40422,55370,85145,17736,50405,55132,74992,23010,52037,75600,1963,85548,83719,35692,3216,40334,25594,27100,67492,57973,35358,77876,44844,3308,55824,11990,14181,59580,16088,1064,70689,37140,78721,80530,27953,74606,25337,41797,4518,35159,57460,18172,41537,72938,47426,71531,40532,6573,50180,41558,40945,36841,71387,38726,5427,14303,53942,24227,49380,60197,5906,66903,54170,70095};
static const uint64_t omega_1536_inv[1536]={8186,13682,9481,78410,72315,30037,79037,29062,70157,27586,44804,52083,60151,83345,84178,81178,73705,36080,17621,79763,74051,57758,72137,72086,26628,79749,32900,21742,82889,21798,75459,79845,32451,22946,9161,22562,10957,17746,47818,14690,47775,5035,72324,38059,3885,22150,16468,26915,20166,83092,59377,81589,9958,73491,46041,7769,72081,79516,54598,36740,3782,45032,83273,20002,80275,42984,35507,22989,18816,84030,63950,168,63727,2107,43010,1337,16147,84865,5388,71569,24566,76849,85888,57052,73647,13055,52734,38290,37749,14295,11094,82514,31616,81508,23777,61723,22232,60885,78120,43207,33568,43706,19586,24876,66439,10927,77023,68946,37730,26032,35944,11089,49385,6465,85348,5817,23866,83707,5428,78550,53740,46129,57534,15840,11932,26626,49294,40043,23278,75705,41062,14032,6052,32623,61566,82999,62500,26662,81382,83503,81647,32983,38378,1497,44071,29527,54542,44170,31752,2023,54155,43292,80659,41188,40323,72145,21872,84073,73605,61636,30703,70546,58919,74771,11382,81167,35228,32358,26069,40251,7969,20969,53352,73032,67004,55773,80525,65111,2802,3023,56646,84506,795,20474,42227,77576,17079,84090,31413,43929,17647,45593,67209,37790,79512,79705,51026,6854,30664,35784,69182,18706,43328,26730,84648,12675,29423,19188,71538,25607,58540,23679,31717,28171,50132,70172,40956,34240,40563,28014,24882,71787,75515,72415,4481,65955,38279,85289,10573,19542,43002,51551,44719,4992,62669,62608,36909,39728,559,39498,24931,773,29537,34783,8455,24072,37943,43852,6359,19539,40328,19257,47023,80233,5548,13476,55245,39986,58489,64238,84838,67339,38974,45302,65882,1884,44949,66637,15377,58002,2899,60810,11270,10010,5151,32357,53850,814,8737,17377,62984,85327,73116,55859,13818,16013,22771,53884,2447,59340,77282,13078,15890,85171,20085,10894,47609,57780,63074,79530,9732,72756,79047,9303,34442,19906,80724,41780,23218,22225,83318,60112,48583,8424,25113,19634,67660,67041,60080,77405,36695,49689,76724,31816,30396,83630,80157,52496,26859,27596,25045,16368,52471,33248,73875,44245,12585,35220,82572,54641,46395,65250,12008,65695,35911,67692,38219,31809,52829,65622,85533,27352,8266,27644,67829,16970,15607,33630,41624,56204,63277,31092,15862,2869,34070,32398,33050,69425,63266,78632,12140,11317,80575,52333,82278,50640,64212,32991,74181,58942,37927,58263,63503,31827,68873,1335,71709,5991,6924,64385,43830,15422,12095,57224,26250,876,6655,53995,15368,49980,78051,67722,64959,10681,29789,1348,54624,2570,82957,25064,4631,27621,18656,56106,33271,37031,5109,80938,31819,33070,29907,77853,63272,83980,76728,6709,16110,80558,8508,13968,63696,3148,24701,25145,76829,39389,42465,2990,27232,73340,26139,73972,16015,53226,46741,911,66524,58018,74505,3666,84999,67482,23073,7671,42075,85455,43845,28792,1531,45704,80130,28430,80281,48332,14078,18381,40368,26238,76197,49513,63211,58281,79547,53557,55049,65991,70367,42732,68942,62837,40318,39016,82738,1896,55645,23779,6161,15089,59349,85304,23943,8978,31482,19414,72273,78618,57006,61318,5310,2045,45092,50736,63763,34195,453,59706,59442,82181,78870,23571,21470,69825,47059,26304,49008,71845,12523,37302,45954,16240,81742,60315,145,14554,41243,60674,4738,65649,23582,59947,73547,38611,65816,29073,22617,31308,36356,5578,40216,34117,16946,80232,33329,60056,56013,36394,68121,76533,4933,67425,58284,82221,85851,52745,76767,41471,5847,50606,62579,68405,14276,22831,21347,46208,13260,34751,37277,52343,62519,14925,56532,68911,63878,22009,62824,57403,42437,6705,41217,8827,11580,85617,16207,52328,49149,25489,68052,15031,36324,34400,68487,58693,74036,44388,82701,83606,58765,52195,45291,27405,84179,53397,27125,35312,21213,70131,61756,51646,72051,52776,75726,59780,68056,75941,22038,31328,82855,20165,24856,19940,82357,6366,83123,58336,13881,72167,12809,5500,56709,54643,76850,58107,10472,72879,16647,43102,25995,31637,14209,77801,45595,11647,30647,77976,872,31762,68281,18440,35612,30562,30885,3390,11025,21012,63007,48483,33980,38195,10417,52528,84054,85342,469,45295,2298,69893,50325,41493,82801,58050,45683,61412,60423,10392,58917,44316,18525,82703,28044,51622,50659,52475,8141,59589,41173,26953,82709,33392,30193,46051,74027,36366,71836,4501,26437,52866,69929,82413,84953,55153,15328,42999,48877,12425,7296,51893,5487,73794,58064,817,11411,49671,60680,10086,44220,18974,81499,15755,50858,29144,28557,78791,67845,2559,44480,21342,13079,74126,38591,19317,14486,37977,45485,56962,79444,76439,35837,59078,44459,2624,45072,4237,49176,49555,14630,80312,47291,32387,80590,65703,71714,39120,32075,60545,61790,53279,36637,26664,25820,76360,80111,40167,19114,62924,31847,29355,15922,56349,77831,72335,76536,7607,13702,55980,6980,56955,15860,58431,41213,33934,25866,2672,1839,4839,12312,49937,68396,6254,11966,28259,13880,13931,59389,6268,53117,64275,3128,64219,10558,6172,53566,63071,76856,63455,75060,68271,38199,71327,38242,80982,13693,47958,82132,63867,69549,59102,65851,2925,26640,4428,76059,12526,39976,78248,13936,6501,31419,49277,82235,40985,2744,66015,5742,43033,50510,63028,67201,1987,22067,85849,22290,83910,43007,84680,69870,1152,80629,14448,61451,9168,129,28965,12370,72962,33283,47727,48268,71722,74923,3503,54401,4509,62240,24294,63785,25132,7897,42810,52449,42311,66431,61141,19578,75090,8994,17071,48287,59985,50073,74928,36632,79552,669,80200,62151,2310,80589,7467,32277,39888,28483,70177,74085,59391,36723,45974,62739,10312,44955,71985,79965,53394,24451,3018,23517,59355,4635,2514,4370,53034,47639,84520,41946,56490,31475,41847,54265,83994,31862,42725,5358,44829,45694,13872,64145,1944,12412,24381,55314,15471,27098,11246,74635,4850,50789,53659,59948,45766,78048,65048,32665,12985,19013,30244,5492,20906,83215,82994,29371,1511,85222,65543,43790,8441,68938,1927,54604,42088,68370,40424,18808,48227,6505,6312,34991,79163,55353,50233,16835,67311,42689,59287,1369,73342,56594,66829,14479,60410,27477,62338,54300,57846,35885,15845,45061,51777,45454,58003,61135,14230,10502,13602,81536,20062,47738,728,75444,66475,43015,34466,41298,81025,23348,23409,49108,46289,85458,46519,61086,85244,56480,51234,77562,61945,48074,42165,79658,66478,45689,66760,38994,5784,80469,72541,30772,46031,27528,21779,1179,18678,47043,40715,20135,84133,41068,19380,70640,28015,83118,25207,74747,76007,80866,53660,32167,85203,77280,68640,23033,690,12901,30158,72199,70004,63246,32133,83570,26677,8735,72939,70127,846,65932,75123,38408,28237,22943,6487,76285,13261,6970,76714,51575,66111,5293,44237,62799,63792,2699,25905,37434,77593,60904,66383,18357,18976,25937,8612,49322,36328,9293,54201,55621,2387,5860,33521,59158,58421,60972,69649,33546,52769,12142,41772,73432,50797,3445,31376,39622,20767,74009,20322,50106,18325,47798,54208,33188,20395,484,58665,77751,58373,18188,69047,70410,52387,44393,29813,22740,54925,70155,83148,51947,53619,52967,16592,22751,7385,73877,74700,5442,33684,3739,35377,21805,53026,11836,27075,48090,27754,22514,54190,17144,84682,14308,80026,79093,21632,42187,70595,73922,28793,59767,85141,79362,32022,70649,36037,7966,18295,21058,75336,56228,84669,31393,83447,3060,60953,81386,58396,67361,29911,52746,48986,80908,5079,54198,52947,56110,8164,22745,2037,9289,79308,69907,5459,77509,72049,22321,82869,61316,60872,9188,46628,43552,83027,58785,12677,59878,12045,70002,32791,39276,85106,19493,27999,11512,82351,1018,18535,62944,78346,43942,562,42172,57225,84486,40313,5887,57587,5736,37685,71939,67636,45649,59779,9820,36504,22806,27736,6470,32460,30968,20026,15650,43285,17075,23180,45699,47001,3279,84121,30372,62238,79856,70928,26668,713,62074,77039,54535,66603,13744,7399,29011,24699,80707,83972,40925,35281,22254,51822,85564,26311,26575,3836,7147,62446,64547,16192,38958,59713,37009,14172,73494,48715,40063,69777,4275,25702,85872,71463,44774,25343,81279,20368,62435,26070,12470,47406,20201,56944,63400,54709,49661,80439,45801,51900,69071,5785,52688,25961,30004,49623,17896,9484,81084,18592,27733,3796,166,33272,9250,44546,80170,35411,23438,17612,71741,63186,64670,39809,72757,51266,48740,33674,23498,71092,29485,17106,22139,64008,23193,28614,43580,79312,44800,77190,74437,400,69810,33689,36868,60528,17965,70986,49693,51617,17530,27324,11981,41629,3316,2411,27252,33822,40726,58612,1838,32620,58892,50705,64804,15886,24261,34371,13966,33241,10291,26237,17961,10076,63979,54689,3162,65852,61161,66077,3660,79651,2894,27681,72136,13850,73208,80517,29308,31374,9167,27910,75545,13138,69370,42915,60022,54380,71808,8216,40422,74370,55370,8041,85145,54255,17736,67577,50405,55455,55132,82627,74992,65005,23010,37534,52037,47822,75600,33489,1963,675,85548,40722,83719,16124,35692,44524,3216,27967,40334,24605,25594,75625,27100,41701,67492,3314,57973,34395,35358,33542,77876,26428,44844,59064,3308,52625,55824,39966,11990,49651,14181,81516,59580,33151,16088,3604,1064,30864,70689,43018,37140,73592,78721,34124,80530,12223,27953,85200,74606,36346,25337,75931,41797,67043,4518,70262,35159,56873,57460,7226,18172,83458,41537,64675,72938,11891,47426,66700,71531,48040,40532,29055,6573,9578,50180,26939,41558,83393,40945,81780,36841,36462,71387,5705,38726,53630,5427,20314,14303,46897,53942,25472,24227,32738,49380,59353,60197,9657,5906,45850,66903,23093,54170,56662,70095,29668};

static const __m256i V_B4Q_B4Q_B4Q_B4Q = {BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q};
static const __m256i V_B8Q_B8Q_B8Q_B8Q = {BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q};
static const __m256i V_B16Q_B16Q_B16Q_B16Q = {BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q};
static const __m256i V_Q_Q_Q_Q = {Q, Q, Q, Q};
static const __m256i V_Q2_Q2_Q2_Q2 = {Q2, Q2, Q2, Q2};
static const __m256i V_MM_MM_MM_MM = {MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK};
static const __m256i V_MF_MF_MF_MF = {MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* bit reverse step of dimension 512 */
static void bit_reverse_512(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[256];a[256]=t;
t=a[2];a[2]=a[128];a[128]=t;
t=a[3];a[3]=a[384];a[384]=t;
t=a[4];a[4]=a[64];a[64]=t;
t=a[5];a[5]=a[320];a[320]=t;
t=a[6];a[6]=a[192];a[192]=t;
t=a[7];a[7]=a[448];a[448]=t;
t=a[8];a[8]=a[32];a[32]=t;
t=a[9];a[9]=a[288];a[288]=t;
t=a[10];a[10]=a[160];a[160]=t;
t=a[11];a[11]=a[416];a[416]=t;
t=a[12];a[12]=a[96];a[96]=t;
t=a[13];a[13]=a[352];a[352]=t;
t=a[14];a[14]=a[224];a[224]=t;
t=a[15];a[15]=a[480];a[480]=t;
t=a[17];a[17]=a[272];a[272]=t;
t=a[18];a[18]=a[144];a[144]=t;
t=a[19];a[19]=a[400];a[400]=t;
t=a[20];a[20]=a[80];a[80]=t;
t=a[21];a[21]=a[336];a[336]=t;
t=a[22];a[22]=a[208];a[208]=t;
t=a[23];a[23]=a[464];a[464]=t;
t=a[24];a[24]=a[48];a[48]=t;
t=a[25];a[25]=a[304];a[304]=t;
t=a[26];a[26]=a[176];a[176]=t;
t=a[27];a[27]=a[432];a[432]=t;
t=a[28];a[28]=a[112];a[112]=t;
t=a[29];a[29]=a[368];a[368]=t;
t=a[30];a[30]=a[240];a[240]=t;
t=a[31];a[31]=a[496];a[496]=t;
t=a[33];a[33]=a[264];a[264]=t;
t=a[34];a[34]=a[136];a[136]=t;
t=a[35];a[35]=a[392];a[392]=t;
t=a[36];a[36]=a[72];a[72]=t;
t=a[37];a[37]=a[328];a[328]=t;
t=a[38];a[38]=a[200];a[200]=t;
t=a[39];a[39]=a[456];a[456]=t;
t=a[41];a[41]=a[296];a[296]=t;
t=a[42];a[42]=a[168];a[168]=t;
t=a[43];a[43]=a[424];a[424]=t;
t=a[44];a[44]=a[104];a[104]=t;
t=a[45];a[45]=a[360];a[360]=t;
t=a[46];a[46]=a[232];a[232]=t;
t=a[47];a[47]=a[488];a[488]=t;
t=a[49];a[49]=a[280];a[280]=t;
t=a[50];a[50]=a[152];a[152]=t;
t=a[51];a[51]=a[408];a[408]=t;
t=a[52];a[52]=a[88];a[88]=t;
t=a[53];a[53]=a[344];a[344]=t;
t=a[54];a[54]=a[216];a[216]=t;
t=a[55];a[55]=a[472];a[472]=t;
t=a[57];a[57]=a[312];a[312]=t;
t=a[58];a[58]=a[184];a[184]=t;
t=a[59];a[59]=a[440];a[440]=t;
t=a[60];a[60]=a[120];a[120]=t;
t=a[61];a[61]=a[376];a[376]=t;
t=a[62];a[62]=a[248];a[248]=t;
t=a[63];a[63]=a[504];a[504]=t;
t=a[65];a[65]=a[260];a[260]=t;
t=a[66];a[66]=a[132];a[132]=t;
t=a[67];a[67]=a[388];a[388]=t;
t=a[69];a[69]=a[324];a[324]=t;
t=a[70];a[70]=a[196];a[196]=t;
t=a[71];a[71]=a[452];a[452]=t;
t=a[73];a[73]=a[292];a[292]=t;
t=a[74];a[74]=a[164];a[164]=t;
t=a[75];a[75]=a[420];a[420]=t;
t=a[76];a[76]=a[100];a[100]=t;
t=a[77];a[77]=a[356];a[356]=t;
t=a[78];a[78]=a[228];a[228]=t;
t=a[79];a[79]=a[484];a[484]=t;
t=a[81];a[81]=a[276];a[276]=t;
t=a[82];a[82]=a[148];a[148]=t;
t=a[83];a[83]=a[404];a[404]=t;
t=a[85];a[85]=a[340];a[340]=t;
t=a[86];a[86]=a[212];a[212]=t;
t=a[87];a[87]=a[468];a[468]=t;
t=a[89];a[89]=a[308];a[308]=t;
t=a[90];a[90]=a[180];a[180]=t;
t=a[91];a[91]=a[436];a[436]=t;
t=a[92];a[92]=a[116];a[116]=t;
t=a[93];a[93]=a[372];a[372]=t;
t=a[94];a[94]=a[244];a[244]=t;
t=a[95];a[95]=a[500];a[500]=t;
t=a[97];a[97]=a[268];a[268]=t;
t=a[98];a[98]=a[140];a[140]=t;
t=a[99];a[99]=a[396];a[396]=t;
t=a[101];a[101]=a[332];a[332]=t;
t=a[102];a[102]=a[204];a[204]=t;
t=a[103];a[103]=a[460];a[460]=t;
t=a[105];a[105]=a[300];a[300]=t;
t=a[106];a[106]=a[172];a[172]=t;
t=a[107];a[107]=a[428];a[428]=t;
t=a[109];a[109]=a[364];a[364]=t;
t=a[110];a[110]=a[236];a[236]=t;
t=a[111];a[111]=a[492];a[492]=t;
t=a[113];a[113]=a[284];a[284]=t;
t=a[114];a[114]=a[156];a[156]=t;
t=a[115];a[115]=a[412];a[412]=t;
t=a[117];a[117]=a[348];a[348]=t;
t=a[118];a[118]=a[220];a[220]=t;
t=a[119];a[119]=a[476];a[476]=t;
t=a[121];a[121]=a[316];a[316]=t;
t=a[122];a[122]=a[188];a[188]=t;
t=a[123];a[123]=a[444];a[444]=t;
t=a[125];a[125]=a[380];a[380]=t;
t=a[126];a[126]=a[252];a[252]=t;
t=a[127];a[127]=a[508];a[508]=t;
t=a[129];a[129]=a[258];a[258]=t;
t=a[131];a[131]=a[386];a[386]=t;
t=a[133];a[133]=a[322];a[322]=t;
t=a[134];a[134]=a[194];a[194]=t;
t=a[135];a[135]=a[450];a[450]=t;
t=a[137];a[137]=a[290];a[290]=t;
t=a[138];a[138]=a[162];a[162]=t;
t=a[139];a[139]=a[418];a[418]=t;
t=a[141];a[141]=a[354];a[354]=t;
t=a[142];a[142]=a[226];a[226]=t;
t=a[143];a[143]=a[482];a[482]=t;
t=a[145];a[145]=a[274];a[274]=t;
t=a[147];a[147]=a[402];a[402]=t;
t=a[149];a[149]=a[338];a[338]=t;
t=a[150];a[150]=a[210];a[210]=t;
t=a[151];a[151]=a[466];a[466]=t;
t=a[153];a[153]=a[306];a[306]=t;
t=a[154];a[154]=a[178];a[178]=t;
t=a[155];a[155]=a[434];a[434]=t;
t=a[157];a[157]=a[370];a[370]=t;
t=a[158];a[158]=a[242];a[242]=t;
t=a[159];a[159]=a[498];a[498]=t;
t=a[161];a[161]=a[266];a[266]=t;
t=a[163];a[163]=a[394];a[394]=t;
t=a[165];a[165]=a[330];a[330]=t;
t=a[166];a[166]=a[202];a[202]=t;
t=a[167];a[167]=a[458];a[458]=t;
t=a[169];a[169]=a[298];a[298]=t;
t=a[171];a[171]=a[426];a[426]=t;
t=a[173];a[173]=a[362];a[362]=t;
t=a[174];a[174]=a[234];a[234]=t;
t=a[175];a[175]=a[490];a[490]=t;
t=a[177];a[177]=a[282];a[282]=t;
t=a[179];a[179]=a[410];a[410]=t;
t=a[181];a[181]=a[346];a[346]=t;
t=a[182];a[182]=a[218];a[218]=t;
t=a[183];a[183]=a[474];a[474]=t;
t=a[185];a[185]=a[314];a[314]=t;
t=a[187];a[187]=a[442];a[442]=t;
t=a[189];a[189]=a[378];a[378]=t;
t=a[190];a[190]=a[250];a[250]=t;
t=a[191];a[191]=a[506];a[506]=t;
t=a[193];a[193]=a[262];a[262]=t;
t=a[195];a[195]=a[390];a[390]=t;
t=a[197];a[197]=a[326];a[326]=t;
t=a[199];a[199]=a[454];a[454]=t;
t=a[201];a[201]=a[294];a[294]=t;
t=a[203];a[203]=a[422];a[422]=t;
t=a[205];a[205]=a[358];a[358]=t;
t=a[206];a[206]=a[230];a[230]=t;
t=a[207];a[207]=a[486];a[486]=t;
t=a[209];a[209]=a[278];a[278]=t;
t=a[211];a[211]=a[406];a[406]=t;
t=a[213];a[213]=a[342];a[342]=t;
t=a[215];a[215]=a[470];a[470]=t;
t=a[217];a[217]=a[310];a[310]=t;
t=a[219];a[219]=a[438];a[438]=t;
t=a[221];a[221]=a[374];a[374]=t;
t=a[222];a[222]=a[246];a[246]=t;
t=a[223];a[223]=a[502];a[502]=t;
t=a[225];a[225]=a[270];a[270]=t;
t=a[227];a[227]=a[398];a[398]=t;
t=a[229];a[229]=a[334];a[334]=t;
t=a[231];a[231]=a[462];a[462]=t;
t=a[233];a[233]=a[302];a[302]=t;
t=a[235];a[235]=a[430];a[430]=t;
t=a[237];a[237]=a[366];a[366]=t;
t=a[239];a[239]=a[494];a[494]=t;
t=a[241];a[241]=a[286];a[286]=t;
t=a[243];a[243]=a[414];a[414]=t;
t=a[245];a[245]=a[350];a[350]=t;
t=a[247];a[247]=a[478];a[478]=t;
t=a[249];a[249]=a[318];a[318]=t;
t=a[251];a[251]=a[446];a[446]=t;
t=a[253];a[253]=a[382];a[382]=t;
t=a[255];a[255]=a[510];a[510]=t;
t=a[259];a[259]=a[385];a[385]=t;
t=a[261];a[261]=a[321];a[321]=t;
t=a[263];a[263]=a[449];a[449]=t;
t=a[265];a[265]=a[289];a[289]=t;
t=a[267];a[267]=a[417];a[417]=t;
t=a[269];a[269]=a[353];a[353]=t;
t=a[271];a[271]=a[481];a[481]=t;
t=a[275];a[275]=a[401];a[401]=t;
t=a[277];a[277]=a[337];a[337]=t;
t=a[279];a[279]=a[465];a[465]=t;
t=a[281];a[281]=a[305];a[305]=t;
t=a[283];a[283]=a[433];a[433]=t;
t=a[285];a[285]=a[369];a[369]=t;
t=a[287];a[287]=a[497];a[497]=t;
t=a[291];a[291]=a[393];a[393]=t;
t=a[293];a[293]=a[329];a[329]=t;
t=a[295];a[295]=a[457];a[457]=t;
t=a[299];a[299]=a[425];a[425]=t;
t=a[301];a[301]=a[361];a[361]=t;
t=a[303];a[303]=a[489];a[489]=t;
t=a[307];a[307]=a[409];a[409]=t;
t=a[309];a[309]=a[345];a[345]=t;
t=a[311];a[311]=a[473];a[473]=t;
t=a[315];a[315]=a[441];a[441]=t;
t=a[317];a[317]=a[377];a[377]=t;
t=a[319];a[319]=a[505];a[505]=t;
t=a[323];a[323]=a[389];a[389]=t;
t=a[327];a[327]=a[453];a[453]=t;
t=a[331];a[331]=a[421];a[421]=t;
t=a[333];a[333]=a[357];a[357]=t;
t=a[335];a[335]=a[485];a[485]=t;
t=a[339];a[339]=a[405];a[405]=t;
t=a[343];a[343]=a[469];a[469]=t;
t=a[347];a[347]=a[437];a[437]=t;
t=a[349];a[349]=a[373];a[373]=t;
t=a[351];a[351]=a[501];a[501]=t;
t=a[355];a[355]=a[397];a[397]=t;
t=a[359];a[359]=a[461];a[461]=t;
t=a[363];a[363]=a[429];a[429]=t;
t=a[367];a[367]=a[493];a[493]=t;
t=a[371];a[371]=a[413];a[413]=t;
t=a[375];a[375]=a[477];a[477]=t;
t=a[379];a[379]=a[445];a[445]=t;
t=a[383];a[383]=a[509];a[509]=t;
t=a[391];a[391]=a[451];a[451]=t;
t=a[395];a[395]=a[419];a[419]=t;
t=a[399];a[399]=a[483];a[483]=t;
t=a[407];a[407]=a[467];a[467]=t;
t=a[411];a[411]=a[435];a[435]=t;
t=a[415];a[415]=a[499];a[499]=t;
t=a[423];a[423]=a[459];a[459]=t;
t=a[431];a[431]=a[491];a[491]=t;
t=a[439];a[439]=a[475];a[475]=t;
t=a[447];a[447]=a[507];a[507]=t;
t=a[463];a[463]=a[487];a[487]=t;
t=a[479];a[479]=a[503];a[503]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint64_t *a, uint32_t n, const uint64_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	__m256i u, v, t, t1, o, u1, v1, r1, r2;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			j_omega = 0;

			for (j = j1; j < j2; j += 4)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = _mm256_loadu_si256((__m256i *)(a + j));
				v = _mm256_loadu_si256((__m256i *)(a + j + d));
				
				t = _mm256_add_epi64(u, v);
				t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
				t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				r1 = _mm256_sub_epi64(t, t1);
				
				t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
				t = _mm256_sub_epi64(t, v);
				o = _mm256_set_epi64x(omega[j_omega + num_of_problems * 3], omega[j_omega + num_of_problems * 2], omega[j_omega + num_of_problems], omega[j_omega]);
				t = _mm256_mul_epu32(t, o);
				t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
				t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				t1 = _mm256_add_epi64(t, t1);
				r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);

				_mm256_storeu_si256((__m256i *)(a + j), r1);
				_mm256_storeu_si256((__m256i *)(a + j + d), r2);

				j_omega += num_of_problems * 4;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k += 2)
	{
		j = k << 2;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);
		
		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		o = _mm256_set_epi64x(omega[num_of_problems], omega[0], omega[num_of_problems], omega[0]);
		t = _mm256_mul_epu32(t, o);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
		
		u = _mm256_permute2f128_si256(r1, r2, 0x20);
		v = _mm256_permute2f128_si256(r1, r2, 0x31);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
	
	for (k = 0; k < (n >> 1); k += 4)
	{
		j = k << 1;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u1 = _mm256_permute4x64_epi64(u1, 0xD8);
		v1 = _mm256_permute4x64_epi64(v1, 0xD8);
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);

		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r2 = _mm256_sub_epi64(t, t1);

		u1 = _mm256_permute2f128_si256(r1, r2, 0x20);
		v1 = _mm256_permute2f128_si256(r1, r2, 0x31);
		u = _mm256_permute4x64_epi64(u1, 0xD8);
		v = _mm256_permute4x64_epi64(v1, 0xD8);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint64_t *a, uint32_t N1, uint32_t N2, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), void (*bit_reverse)(uint64_t *))
{
	uint32_t n1, n2;
	__m256i u, v, t, t1;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint64_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), uint64_t inv_n, void (*bit_reverse)(uint64_t *))
{
	uint32_t i, n1, n2;
	__m256i u, v, t, t1;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i += 4)
	{
		u = _mm256_loadu_si256((__m256i *)(a + i));
		v = _mm256_set1_epi64x(inv_n);
		
		t = _mm256_mul_epu32(u, v);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
		_mm256_storeu_si256((__m256i *)(a + i), u);
	}
}

/* 256 * 4 --> 256 * 7 */
static void ntt_butterfly_1024_1792(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_7[0][0]);
	d1 = _mm256_mul_epu32(d, w_7[0][1]);
	e1 = _mm256_mul_epu32(e, w_7[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 + n2), t);
	a[N2_1792 + n2] %= Q;
	a[N2_1792 + n2 + 1] %= Q;
	a[N2_1792 + n2 + 2] %= Q;
	a[N2_1792 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_7[1][0]);
	d1 = _mm256_mul_epu32(d, w_7[1][1]);
	e1 = _mm256_mul_epu32(e, w_7[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 2 + n2), t);
	a[N2_1792 * 2 + n2] %= Q;
	a[N2_1792 * 2 + n2 + 1] %= Q;
	a[N2_1792 * 2 + n2 + 2] %= Q;
	a[N2_1792 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[2][0]);
	d1 = _mm256_mul_epu32(d, w_7[2][1]);
	e1 = _mm256_mul_epu32(e, w_7[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 3 + n2), t);
	a[N2_1792 * 3 + n2] %= Q;
	a[N2_1792 * 3 + n2 + 1] %= Q;
	a[N2_1792 * 3 + n2 + 2] %= Q;
	a[N2_1792 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[3][0]);
	d1 = _mm256_mul_epu32(d, w_7[3][1]);
	e1 = _mm256_mul_epu32(e, w_7[3][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 4 + n2), t);
	a[N2_1792 * 4 + n2] %= Q;
	a[N2_1792 * 4 + n2 + 1] %= Q;
	a[N2_1792 * 4 + n2 + 2] %= Q;
	a[N2_1792 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[4][0]);
	d1 = _mm256_mul_epu32(d, w_7[4][1]);
	e1 = _mm256_mul_epu32(e, w_7[4][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 5 + n2), t);
	a[N2_1792 * 5 + n2] %= Q;
	a[N2_1792 * 5 + n2 + 1] %= Q;
	a[N2_1792 * 5 + n2 + 2] %= Q;
	a[N2_1792 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[5][0]);
	d1 = _mm256_mul_epu32(d, w_7[5][1]);
	e1 = _mm256_mul_epu32(e, w_7[5][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 6 + n2), t);
	a[N2_1792 * 6 + n2] %= Q;
	a[N2_1792 * 6 + n2 + 1] %= Q;
	a[N2_1792 * 6 + n2 + 2] %= Q;
	a[N2_1792 * 6 + n2 + 3] %= Q;
}

/* 256 * 7 --> 256 * 3 */
static void ntt_butterfly_1792_768(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, c1, d1, e1, f1, g1, h1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 5 + n2));
	h = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 6 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);	
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_7[0][0]);
	d1 = _mm256_mul_epu32(d, w_7[0][1]);
	e1 = _mm256_mul_epu32(e, w_7[0][2]);
	f1 = _mm256_mul_epu32(f, w_7[0][3]);
	g1 = _mm256_mul_epu32(g, w_7[0][4]);
	h1 = _mm256_mul_epu32(h, w_7[0][5]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 + n2), t);
	a[N2_1792 + n2] %= Q;
	a[N2_1792 + n2 + 1] %= Q;
	a[N2_1792 + n2 + 2] %= Q;
	a[N2_1792 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_7[1][0]);
	d1 = _mm256_mul_epu32(d, w_7[1][1]);
	e1 = _mm256_mul_epu32(e, w_7[1][2]);
	f1 = _mm256_mul_epu32(f, w_7[1][3]);
	g1 = _mm256_mul_epu32(g, w_7[1][4]);
	h1 = _mm256_mul_epu32(h, w_7[1][5]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 2 + n2), t);
	a[N2_1792 * 2 + n2] %= Q;
	a[N2_1792 * 2 + n2 + 1] %= Q;
	a[N2_1792 * 2 + n2 + 2] %= Q;
	a[N2_1792 * 2 + n2 + 3] %= Q;
}

/* 512 * 1 --> 512 * 3 */
static void ntt_butterfly_512_1536(uint64_t *a, uint32_t n2)
{
	__m256i t;
	
	t = _mm256_loadu_si256((__m256i *)(a + n2));
	_mm256_storeu_si256((__m256i *)(a + N2_1536 + n2), t);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 * 2 + n2), t);
}

/* 512 * 2 --> 512 * 3 */
static void ntt_butterfly_1024_1536(uint64_t *a, uint32_t n2)
{
	__m256i b, c, c1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1536 + n2));
	
	t = _mm256_add_epi64(b, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_3[0]);
	t = _mm256_add_epi64(b, c1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 + n2), t);
	a[N2_1536 + n2] %= Q;
	a[N2_1536 + n2 + 1] %= Q;
	a[N2_1536 + n2 + 2] %= Q;
	a[N2_1536 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_3[1]);
	t = _mm256_add_epi64(b, c1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 * 2 + n2), t);
	a[N2_1536 * 2 + n2] %= Q;
	a[N2_1536 * 2 + n2 + 1] %= Q;
	a[N2_1536 * 2 + n2 + 2] %= Q;
	a[N2_1536 * 2 + n2 + 3] %= Q;
}

/* 512 * 3 --> 512 * 3 */
static void ntt_butterfly_1536_1536_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1536 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1536 * 2 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_3_inv[0]);
	d1 = _mm256_mul_epu32(d, w_3_inv[1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 + n2), t);
	a[N2_1536 + n2] %= Q;
	a[N2_1536 + n2 + 1] %= Q;
	a[N2_1536 + n2 + 2] %= Q;
	a[N2_1536 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_3_inv[1]);
	d1 = _mm256_mul_epu32(d, w_3_inv[0]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 * 2 + n2), t);
	a[N2_1536 * 2 + n2] %= Q;
	a[N2_1536 * 2 + n2 + 1] %= Q;
	a[N2_1536 * 2 + n2 + 2] %= Q;
	a[N2_1536 * 2 + n2 + 3] %= Q;	
}

/* 256 * 3 --> 256 * 3 */
static void ntt_butterfly_768_768_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_768 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_768 * 2 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_3_inv[0]);
	d1 = _mm256_mul_epu32(d, w_3_inv[1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_768 + n2), t);
	a[N2_768 + n2] %= Q;
	a[N2_768 + n2 + 1] %= Q;
	a[N2_768 + n2 + 2] %= Q;
	a[N2_768 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_3_inv[1]);
	d1 = _mm256_mul_epu32(d, w_3_inv[0]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_768 * 2 + n2), t);
	a[N2_768 * 2 + n2] %= Q;
	a[N2_768 * 2 + n2 + 1] %= Q;
	a[N2_768 * 2 + n2 + 2] %= Q;
	a[N2_768 * 2 + n2 + 3] %= Q;	
}

/* 256 * 3 --> 256 * 1 */
static void ntt_butterfly_768_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_768 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_768 * 2 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

/* 256 * 6 --> 256 * 7 */
static void ntt_butterfly_1536_1792(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, c1, d1, e1, f1, g1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 5 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_7[0][0]);
	d1 = _mm256_mul_epu32(d, w_7[0][1]);
	e1 = _mm256_mul_epu32(e, w_7[0][2]);
	f1 = _mm256_mul_epu32(f, w_7[0][3]);
	g1 = _mm256_mul_epu32(g, w_7[0][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 + n2), t);
	a[N2_1792 + n2] %= Q;
	a[N2_1792 + n2 + 1] %= Q;
	a[N2_1792 + n2 + 2] %= Q;
	a[N2_1792 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_7[1][0]);
	d1 = _mm256_mul_epu32(d, w_7[1][1]);
	e1 = _mm256_mul_epu32(e, w_7[1][2]);
	f1 = _mm256_mul_epu32(f, w_7[1][3]);
	g1 = _mm256_mul_epu32(g, w_7[1][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 2 + n2), t);
	a[N2_1792 * 2 + n2] %= Q;
	a[N2_1792 * 2 + n2 + 1] %= Q;
	a[N2_1792 * 2 + n2 + 2] %= Q;
	a[N2_1792 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[2][0]);
	d1 = _mm256_mul_epu32(d, w_7[2][1]);
	e1 = _mm256_mul_epu32(e, w_7[2][2]);
	f1 = _mm256_mul_epu32(f, w_7[2][3]);
	g1 = _mm256_mul_epu32(g, w_7[2][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 3 + n2), t);
	a[N2_1792 * 3 + n2] %= Q;
	a[N2_1792 * 3 + n2 + 1] %= Q;
	a[N2_1792 * 3 + n2 + 2] %= Q;
	a[N2_1792 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[3][0]);
	d1 = _mm256_mul_epu32(d, w_7[3][1]);
	e1 = _mm256_mul_epu32(e, w_7[3][2]);
	f1 = _mm256_mul_epu32(f, w_7[3][3]);
	g1 = _mm256_mul_epu32(g, w_7[3][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 4 + n2), t);
	a[N2_1792 * 4 + n2] %= Q;
	a[N2_1792 * 4 + n2 + 1] %= Q;
	a[N2_1792 * 4 + n2 + 2] %= Q;
	a[N2_1792 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[4][0]);
	d1 = _mm256_mul_epu32(d, w_7[4][1]);
	e1 = _mm256_mul_epu32(e, w_7[4][2]);
	f1 = _mm256_mul_epu32(f, w_7[4][3]);
	g1 = _mm256_mul_epu32(g, w_7[4][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 5 + n2), t);
	a[N2_1792 * 5 + n2] %= Q;
	a[N2_1792 * 5 + n2 + 1] %= Q;
	a[N2_1792 * 5 + n2 + 2] %= Q;
	a[N2_1792 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[5][0]);
	d1 = _mm256_mul_epu32(d, w_7[5][1]);
	e1 = _mm256_mul_epu32(e, w_7[5][2]);
	f1 = _mm256_mul_epu32(f, w_7[5][3]);
	g1 = _mm256_mul_epu32(g, w_7[5][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 6 + n2), t);
	a[N2_1792 * 6 + n2] %= Q;
	a[N2_1792 * 6 + n2 + 1] %= Q;
	a[N2_1792 * 6 + n2 + 2] %= Q;
	a[N2_1792 * 6 + n2 + 3] %= Q;
}

/* 256 * 7 --> 256 * 1 */
static void ntt_butterfly_1792_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 5 + n2));
	h = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 6 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

void ntt_1024_1792(uint64_t *a)
{
	ntt_core(a, N1_1792, N2_1792, omega_256, omega_1792, ntt_butterfly_1024_1792, bit_reverse_256);
}

void intt_1792_768(uint64_t *a)
{
	intt_core(a, N1_1792, N2_1792, 768, omega_256, omega_1792, ntt_butterfly_1792_768, INV_1792, bit_reverse_256);
}

void ntt_512_1536(uint64_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_512, omega_1536, ntt_butterfly_512_1536, bit_reverse_512);
}

void ntt_1024_1536(uint64_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_512, omega_1536, ntt_butterfly_1024_1536, bit_reverse_512);
}

void intt_1536_1536_inv(uint64_t *a)
{
	intt_core(a, N1_1536, N2_1536, 1536, omega_512_inv, omega_1536_inv, ntt_butterfly_1536_1536_inv, INV_1536, bit_reverse_512);
}

void ntt_768_768_inv(uint64_t *a)
{
	ntt_core(a, N1_768, N2_768, omega_256_inv, omega_768_inv, ntt_butterfly_768_768_inv, bit_reverse_256);
}

void intt_768_256(uint64_t *a)
{
	intt_core(a, N1_768, N2_768, 256, omega_256, omega_768, ntt_butterfly_768_256, INV_768, bit_reverse_256);
}

void ntt_1536_1792(uint64_t *a)
{
	ntt_core(a, N1_1792, N2_1792, omega_256, omega_1792, ntt_butterfly_1536_1792, bit_reverse_256);
}

void intt_1792_256(uint64_t *a)
{
	intt_core(a, N1_1792, N2_1792, 256, omega_256, omega_1792, ntt_butterfly_1792_256, INV_1792, bit_reverse_256);
}
