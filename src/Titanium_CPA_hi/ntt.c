/* ****************************** *
 * Titanium_CPA_hi                *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>
#include <x86intrin.h>

/* 1024=4*256 */
#define N1_1024 4
#define N2_1024 256

/* 2304=9*256 */
#define N1_2304 9
#define N2_2304 256

/* 2560=10*256 */
#define N1_2560 10
#define N2_2560 256

/* multiplication inverses of 1024, 2304, 2560 (in Montgomery form) */
#define INV_1024 4096
#define INV_2304 411421
#define INV_2560 444007

/* omega_n: n-th root of unity mod Q */
static const __m256i w_4[3][3]={{{511371,511371,511371,511371},{737280,737280,737280,737280},{225910,225910,225910,225910}},
{{737280,737280,737280,737280},{1,1,1,1},{737280,737280,737280,737280}},
{{225910,225910,225910,225910},{737280,737280,737280,737280},{511371,511371,511371,511371}}};

static const __m256i w_9[8][8]={{{17175,17175,17175,17175},{68225,68225,68225,68225},{224866,224866,224866,224866},{195672,195672,195672,195672},{139802,139802,139802,139802},{512414,512414,512414,512414},{524434,524434,524434,524434},{529254,529254,529254,529254}},
{{68225,68225,68225,68225},{195672,195672,195672,195672},{512414,512414,512414,512414},{529254,529254,529254,529254},{17175,17175,17175,17175},{224866,224866,224866,224866},{139802,139802,139802,139802},{524434,524434,524434,524434}},
{{224866,224866,224866,224866},{512414,512414,512414,512414},{1,1,1,1},{224866,224866,224866,224866},{512414,512414,512414,512414},{1,1,1,1},{224866,224866,224866,224866},{512414,512414,512414,512414}},
{{195672,195672,195672,195672},{529254,529254,529254,529254},{224866,224866,224866,224866},{524434,524434,524434,524434},{68225,68225,68225,68225},{512414,512414,512414,512414},{17175,17175,17175,17175},{139802,139802,139802,139802}},
{{139802,139802,139802,139802},{17175,17175,17175,17175},{512414,512414,512414,512414},{68225,68225,68225,68225},{524434,524434,524434,524434},{224866,224866,224866,224866},{529254,529254,529254,529254},{195672,195672,195672,195672}},
{{512414,512414,512414,512414},{224866,224866,224866,224866},{1,1,1,1},{512414,512414,512414,512414},{224866,224866,224866,224866},{1,1,1,1},{512414,512414,512414,512414},{224866,224866,224866,224866}},
{{524434,524434,524434,524434},{139802,139802,139802,139802},{224866,224866,224866,224866},{17175,17175,17175,17175},{529254,529254,529254,529254},{512414,512414,512414,512414},{195672,195672,195672,195672},{68225,68225,68225,68225}},
{{529254,529254,529254,529254},{524434,524434,524434,524434},{512414,512414,512414,512414},{139802,139802,139802,139802},{195672,195672,195672,195672},{224866,224866,224866,224866},{68225,68225,68225,68225},{17175,17175,17175,17175}}};

static const __m256i w_10[9][9]={{{364663,364663,364663,364663},{153285,153285,153285,153285},{408940,408940,408940,408940},{620317,620317,620317,620317},{737280,737280,737280,737280},{372618,372618,372618,372618},{583996,583996,583996,583996},{328341,328341,328341,328341},{116964,116964,116964,116964}},
{{153285,153285,153285,153285},{620317,620317,620317,620317},{372618,372618,372618,372618},{328341,328341,328341,328341},{1,1,1,1},{153285,153285,153285,153285},{620317,620317,620317,620317},{372618,372618,372618,372618},{328341,328341,328341,328341}},
{{408940,408940,408940,408940},{372618,372618,372618,372618},{116964,116964,116964,116964},{153285,153285,153285,153285},{737280,737280,737280,737280},{328341,328341,328341,328341},{364663,364663,364663,364663},{620317,620317,620317,620317},{583996,583996,583996,583996}},
{{620317,620317,620317,620317},{328341,328341,328341,328341},{153285,153285,153285,153285},{372618,372618,372618,372618},{1,1,1,1},{620317,620317,620317,620317},{328341,328341,328341,328341},{153285,153285,153285,153285},{372618,372618,372618,372618}},
{{737280,737280,737280,737280},{1,1,1,1},{737280,737280,737280,737280},{1,1,1,1},{737280,737280,737280,737280},{1,1,1,1},{737280,737280,737280,737280},{1,1,1,1},{737280,737280,737280,737280}},
{{372618,372618,372618,372618},{153285,153285,153285,153285},{328341,328341,328341,328341},{620317,620317,620317,620317},{1,1,1,1},{372618,372618,372618,372618},{153285,153285,153285,153285},{328341,328341,328341,328341},{620317,620317,620317,620317}},
{{583996,583996,583996,583996},{620317,620317,620317,620317},{364663,364663,364663,364663},{328341,328341,328341,328341},{737280,737280,737280,737280},{153285,153285,153285,153285},{116964,116964,116964,116964},{372618,372618,372618,372618},{408940,408940,408940,408940}},
{{328341,328341,328341,328341},{372618,372618,372618,372618},{620317,620317,620317,620317},{153285,153285,153285,153285},{1,1,1,1},{328341,328341,328341,328341},{372618,372618,372618,372618},{620317,620317,620317,620317},{153285,153285,153285,153285}},
{{116964,116964,116964,116964},{328341,328341,328341,328341},{583996,583996,583996,583996},{372618,372618,372618,372618},{737280,737280,737280,737280},{620317,620317,620317,620317},{408940,408940,408940,408940},{153285,153285,153285,153285},{364663,364663,364663,364663}}};

/* omega_256,1024,2304,2560, respectively (in Montgomery form) */
static const uint64_t omega_256[128]={507899,98818,405168,81664,733535,223169,727351,689598,632231,249917,292697,253105,50811,98984,735774,516285,562448,251836,614718,23191,520244,239399,344207,553910,631377,165777,197535,715779,214233,705082,477752,621617,678739,57902,737189,607351,469758,583379,561501,533217,369334,346318,121307,735382,90893,95737,718029,218355,724430,619366,432787,155855,609930,409602,349310,404006,716546,640312,683497,526682,3467,136113,296545,366323,629816,157019,458708,268223,597553,640552,477498,391120,244672,17667,604496,140124,14879,257290,559829,223445,379860,17605,356656,39976,167608,619665,486419,472344,4190,243606,275237,309592,696934,61744,136708,415600,613923,198682,139852,592409,460079,40703,505140,129153,372268,611216,270400,642829,375501,192465,735982,681817,494113,215120,659521,388386,422509,1366,37892,494092,297657,173718,689841,414441,499733,490837,557115,76915};
static const uint64_t omega_1024[1024]={507899,662125,460817,672811,98818,475732,89241,501207,405168,205039,198879,104253,81664,222277,594378,179195,733535,301043,339823,298794,223169,628188,581268,128615,727351,165833,256823,29184,689598,468957,429212,312988,632231,45171,444218,620580,249917,147634,448116,576569,292697,235076,119057,47674,253105,377575,731260,140423,50811,396805,71545,68511,98984,19157,691404,573779,735774,400787,169578,691370,516285,97231,3958,57449,562448,7078,172402,305787,251836,443539,209672,660472,614718,659209,690828,337044,23191,140088,221607,198689,520244,156371,476763,358100,239399,56440,330791,508583,344207,339328,199030,359594,553910,314940,246658,534913,631377,75619,322116,584778,165777,162127,625506,469692,197535,43392,385053,105500,715779,504168,251252,193276,214233,263032,206669,6085,705082,110285,697123,659955,477752,555937,56192,648704,621617,528922,85249,386264,678739,538413,651629,406825,57902,591190,686535,450391,737189,581709,137065,270681,607351,735389,487033,29926,469758,309141,25202,591565,583379,11911,234914,582396,561501,617544,277008,247093,533217,712565,230261,86983,369334,66787,132824,471960,346318,222624,443874,38876,121307,166019,571349,313049,735382,475196,657427,626590,90893,345615,508413,56737,95737,426728,536230,646581,718029,622513,569496,128750,218355,597805,76004,235870,724430,387389,369271,697535,619366,408886,593929,157217,432787,460065,138460,417783,155855,341488,165185,635617,609930,672792,66689,704387,409602,330123,116276,505970,349310,121129,602302,307621,404006,451940,407424,333530,716546,326603,62204,493062,640312,439084,49077,413735,683497,474100,278653,79664,526682,721095,646152,729871,3467,701730,340301,369811,136113,135411,422891,683392,296545,106515,220301,202086,366323,136153,203051,523576,629816,385092,171449,168826,157019,97969,514635,256205,458708,55616,411969,646315,268223,137278,630864,682698,597553,387153,707476,472134,640552,107643,653187,92279,477498,126423,707084,546543,391120,42863,227795,340663,244672,125711,240373,228912,17667,383657,693988,519637,604496,331270,581291,167508,140124,282483,657946,29657,14879,92835,680413,420023,257290,81600,114053,433282,559829,2035,492061,422183,223445,357623,170073,53853,379860,171509,270286,676687,17605,278815,353606,12855,356656,9438,476757,347954,39976,506845,354373,572571,167608,309224,165555,524006,619665,177214,332788,199105,486419,466214,214485,689164,472344,258381,451919,371913,4190,449761,409140,286162,243606,534948,690562,624519,275237,201456,38274,577887,309592,50562,713027,274222,696934,340356,462816,366715,61744,452483,588356,317927,136708,404275,169538,623730,415600,150807,652692,729796,613923,52145,440756,664586,198682,508407,46591,633595,139852,559812,710569,541430,592409,536021,293162,284110,460079,162134,637343,579472,40703,261640,64640,188652,505140,420342,59438,239442,129153,162547,598445,420963,372268,604495,329579,670934,611216,635575,538908,14112,270400,132180,120237,568492,642829,271645,25632,581414,375501,173250,265193,174515,192465,317394,709967,260729,735982,15234,693140,560231,681817,582344,473569,118013,494113,205710,596259,410842,215120,288387,319676,145143,659521,481139,385106,195123,388386,580636,534465,611090,422509,37430,625245,28341,1366,98063,673589,677135,37892,669206,638292,709669,494092,170199,266919,144057,297657,512345,70220,39779,173718,319300,246608,450363,689841,142589,27112,134970,414441,402781,592308,365230,499733,124477,365522,256224,490837,564242,91608,80118,557115,573628,480433,665822,76915,301809,160567,199389,229382,75156,276464,64470,638463,261549,648040,236074,332113,532242,538402,633028,655617,515004,142903,558086,3746,436238,397458,438487,514112,109093,156013,608666,9930,571448,480458,708097,47683,268324,308069,424293,105050,692110,293063,116701,487364,589647,289165,160712,444584,502205,618224,689607,484176,359706,6021,596858,686470,340476,665736,668770,638297,718124,45877,163502,1507,336494,567703,45911,220996,640050,733323,679832,174833,730203,564879,431494,485445,293742,527609,76809,122563,78072,46453,400237,714090,597193,515674,538592,217037,580910,260518,379181,497882,680841,406490,228698,393074,397953,538251,377687,183371,422341,490623,202368,105904,661662,415165,152503,571504,575154,111775,267589,539746,693889,352228,631781,21502,233113,486029,544005,523048,474249,530612,731196,32199,626996,40158,77326,259529,181344,681089,88577,115664,208359,652032,351017,58542,198868,85652,330456,679379,146091,50746,286890,92,155572,600216,466600,129930,1892,250248,707355,267523,428140,712079,145716,153902,725370,502367,154885,175780,119737,460273,490188,204064,24716,507020,650298,367947,670494,604457,265321,390963,514657,293407,698405,615974,571262,165932,424232,1899,262085,79854,110691,646388,391666,228868,680544,641544,310553,201051,90700,19252,114768,167785,608531,518926,139476,661277,501411,12851,349892,368010,39746,117915,328395,143352,580064,304494,277216,598821,319498,581426,395793,572096,101664,127351,64489,670592,32894,327679,407158,621005,231311,387971,616152,134979,429660,333275,285341,329857,403751,20735,410678,675077,244219,96969,298197,688204,323546,53784,263181,458628,657617,210599,16186,91129,7410,733814,35551,396980,367470,601168,601870,314390,53889,440736,630766,516980,535195,370958,601128,534230,213705,107465,352189,565832,568455,580262,639312,222646,481076,278573,681665,325312,90966,469058,600003,106417,54583,139728,350128,29805,265147,96729,629638,84094,645002,259783,610858,30197,190738,346161,694418,509486,396618,492609,611570,496908,508369,719614,353624,43293,217644,132785,406011,155990,569773,597157,454798,79335,707624,722402,644446,56868,317258,479991,655681,623228,303999,177452,735246,245220,315098,513836,379658,567208,683428,357421,565772,466995,60594,719676,458466,383675,724426,380625,727843,260524,389327,697305,230436,382908,164710,569673,428057,571726,213275,117616,560067,404493,538176,250862,271067,522796,48117,264937,478900,285362,365368,733091,287520,328141,451119,493675,202333,46719,112762,462044,535825,699007,159394,427689,686719,24254,463059,40347,396925,274465,370566,675537,284798,148925,419354,600573,333006,567743,113551,321681,586474,84589,7485,123358,685136,296525,72695,538599,228874,690690,103686,597429,177469,26712,195851,144872,201260,444119,453171,277202,575147,99938,157809,696578,475641,672641,548629,232141,316939,677843,497839,608128,574734,138836,316318,365013,132786,407702,66347,126065,101706,198373,723169,466881,605101,617044,168789,94452,465636,711649,155867,361780,564031,472088,562766,544816,419887,27314,476552,1299,722047,44141,177050,55464,154937,263712,619268,243168,531571,141022,326439,522161,448894,417605,592138,77760,256142,352175,542158,348895,156645,202816,126191,314772,699851,112036,708940,735915,639218,63692,60146,699389,68075,98989,27612,243189,567082,470362,593224,439624,224936,667061,697502,563563,417981,490673,286918,47440,594692,710169,602311,322840,334500,144973,372051,237548,612804,371759,481057,246444,173039,645673,657163,180166,163653,256848,71459,660366,435472,576714,537892};
static const uint64_t omega_2304[2304]={507899,116429,204825,134835,320933,63488,478763,461381,31921,98818,961,80327,158544,605644,163496,334455,84376,123360,405168,155115,335903,608958,543308,69493,52388,396405,284978,81664,77732,13753,543481,275754,646357,290617,608249,362827,733535,213184,13399,87327,735213,517624,72347,135203,116162,223169,650076,667456,348727,509359,706459,734161,678264,313079,727351,400574,166993,237787,13019,226650,466144,204488,508680,689598,197111,87696,535896,194900,562679,287744,421808,224112,632231,661918,372996,161905,504513,81210,550740,53166,215931,249917,552030,453297,178645,381629,60303,65236,427702,666905,292697,156073,399868,2874,191895,393591,420323,235013,366524,253105,244638,514323,500718,27148,608992,728744,625186,577100,50811,642819,163671,551624,450816,655610,621371,413958,172510,98984,169044,364726,31466,566372,522779,171039,186241,522477,735774,628194,25269,682860,312109,597938,159989,376583,556097,516285,142251,217342,572701,388938,110415,582114,117770,145829,562448,502432,527932,258823,464808,290754,618166,628632,202278,251836,696322,5757,432876,131942,25412,725501,632608,506233,614718,255265,228782,297576,224023,146825,96384,734264,502745,23191,408663,47539,492075,74210,711352,141186,307080,449169,520244,353488,671018,606569,47479,164835,264551,2237,404102,239399,694776,421245,102634,169557,213504,284117,546737,339234,344207,187552,299861,152636,86495,621171,60439,69699,438631,553910,384883,112875,727896,423880,465585,104826,328229,42698,631377,427888,206787,513649,511127,27197,138957,683891,36935,165777,241252,479104,109352,682760,503990,177892,698453,569016,197535,188349,223013,536533,719974,716871,13291,235576,488002,715779,693052,603202,115886,192427,345995,354651,378491,640395,214233,573678,556529,660570,393814,162003,301724,728785,111519,705082,596813,659768,443392,715569,284993,163474,214467,375352,477752,108354,400635,499687,302322,303872,647481,522665,286564,621617,281080,203121,425872,270738,568490,277855,308715,519087,678739,691886,142086,54713,543178,97754,96153,211671,608869,57902,241240,413656,737245,540937,409117,311812,452662,401760,737189,235513,144400,141492,501442,289439,81685,192266,205182,607351,626102,411997,536431,163666,524354,650998,535077,151760,469758,8657,29294,516780,630138,305911,708972,431724,484463,583379,381551,372172,91495,611774,418871,425896,401634,49985,561501,498461,251247,433040,289117,537340,697666,700404,150555,533217,329254,472081,144522,69599,630512,133864,186066,305308,369334,95944,546347,424017,475502,370631,534253,81350,577019,346318,641731,127967,464192,617495,655403,229674,1577,490867,121307,267321,364197,95424,659391,599077,473847,191633,439205,735382,702069,384093,227901,653569,548972,732428,73854,244290,90893,277590,337967,69518,188738,132776,150362,217876,536013,95737,154650,11636,56578,392954,632530,80821,640977,439337,718029,430775,469584,534223,655011,303549,360401,35908,462767,218355,199355,529976,347584,173685,609186,312258,673303,535182,724430,689622,328007,306472,82261,384646,294839,42045,19039,619366,537903,81863,425797,598969,622096,681703,637360,618806,432787,383817,197159,349488,236167,24911,204890,489345,667691,155855,685458,473262,687448,267507,641360,316376,277164,226406,609930,683629,82549,480836,708308,496673,84148,354410,538639,409602,7878,204314,296965,578034,721161,555240,265893,685976,349310,2636,368405,190145,433744,442328,73480,416337,613799,404006,453096,556953,23942,80931,503636,459019,420631,440283,716546,452584,713629,26167,419585,633647,274691,9722,676837,640312,498832,62838,620068,680206,582813,243711,619432,160586,683497,99902,14849,622817,190351,82706,599833,173385,447548,526682,76852,375200,386025,443095,570293,526764,524080,631164,3467,476993,392454,117373,192434,384173,664221,399781,265657,136113,655616,654095,468652,612062,515061,102084,118981,115094,296545,499197,578986,15121,631743,212209,593997,46924,86989,366323,631413,624232,534951,201837,58465,362718,139049,448378,629816,24285,477091,189665,27667,490494,298808,307822,72351,157019,398385,24683,435940,622816,184897,565111,280814,226919,458708,198999,62914,297291,144195,497984,598813,508553,734221,268223,122738,699185,137658,234674,729461,112018,477504,230324,597553,272042,307696,122428,483007,15165,134438,367538,622494,640552,333230,38755,507404,365823,116256,735845,278147,426721,477498,197600,542859,569771,628900,189388,728752,668818,404265,391120,214547,74391,223964,562320,541601,344168,712127,681631,244672,699759,319130,551860,263398,349304,707193,313711,487874,17667,509288,319225,332709,146345,427588,45149,728073,651957,604496,537833,437364,279221,386069,683071,725622,555261,380427,140124,413180,352984,134045,435959,726442,603855,728224,949,14879,49156,463821,68623,468375,575866,693385,207541,202279,257290,213917,324776,379342,120782,353095,2158,710517,10782,559829,226745,246993,87435,586964,27554,611473,251779,385444,223445,680818,234256,661532,479595,575423,489106,101466,434814,379860,734111,405564,103056,259302,128150,724993,73819,53400,17605,171140,737095,460118,516329,382227,372671,601198,245285,356656,254546,731042,624701,143753,299159,10333,322826,65976,39976,531209,436837,354087,251559,660126,184081,538333,215240,167608,642873,458187,306589,720379,713898,18731,414096,187881,619665,694087,349844,703229,75204,234380,600547,381136,320605,486419,192188,517051,633610,72893,163963,669630,409227,174471,472344,104362,9416,482475,62761,200110,224060,348623,679424,4190,733830,347552,736438,563245,425584,174548,155021,560508,243606,46762,678003,364147,560005,449368,131028,201423,12352,275237,38482,493024,89089,23227,605007,375703,180263,358829,309592,141278,71567,304769,378752,589327,381579,524884,592494,696934,394481,113416,729386,440249,531110,634172,188917,371761,61744,551640,538080,309940,564708,294695,731231,180945,392052,136708,214341,425429,66459,462415,510390,431285,302000,22246,415600,280606,567049,528732,198337,138771,406728,553264,548004,613923,343021,354637,302135,21255,171653,585873,712769,496694,198682,545839,602509,22669,510799,450128,589663,2280,638624,139852,404254,331126,360035,251587,75557,685080,623493,190850,592409,233344,111170,276198,118809,651568,694733,186723,202181,460079,303623,26716,464707,477181,680525,110796,448245,641715,40703,72581,674158,37385,408234,656897,267859,349325,84446,505140,551744,368015,274928,565039,625407,307872,345051,367042,129153,297107,615221,49503,144516,36875,575818,431593,507270,372268,615079,12316,78893,447599,67555,541751,424987,604915,611216,324663,500321,73753,430717,153252,497035,583934,459397,270400,199600,391644,123319,181554,27133,527182,592009,263587,642829,218211,151260,691882,120270,509771,4383,311890,140793,375501,553117,483547,11201,633212,114044,468093,512400,334610,192465,553247,455286,704717,80665,527434,491855,348892,671988,735982,288064,692526,683522,236252,488501,488201,326563,540987,681817,521835,183430,674184,179189,399481,104019,350537,59165,494113,130247,365535,20066,322376,560800,361612,5173,196864,215120,250409,286274,514519,95140,585017,467831,558014,649669,659521,570816,430082,376367,115314,21863,538561,721471,34137,388386,48931,711233,229441,205357,87239,255261,206966,15353,422509,360961,141024,160813,446993,448836,178624,267095,606155,1366,77354,163984,46883,600656,238341,85411,607283,255230,37892,224288,117573,545953,486984,324574,14915,245500,54704,494092,15713,174106,693477,709309,57879,115798,449756,35337,297657,665797,147913,132088,84415,336066,23398,63079,459920,173718,51887,613075,141715,243122,356150,443946,50680,665626,689841,47871,90960,643008,457196,62642,288365,122337,723974,414441,594949,78165,163492,312639,539434,321846,619304,199755,499733,553206,231672,576735,271944,510485,212134,184947,100530,490837,694968,731132,378280,226882,256910,353240,55707,66206,557115,170209,83107,575044,633883,87273,440697,25378,540065,76915,718802,223031,634705,146775,560965,524241,34696,488048,229382,620852,532456,602446,416348,673793,258518,275900,705360,638463,736320,656954,578737,131637,573785,402826,652905,613921,332113,582166,401378,128323,193973,667788,684893,340876,452303,655617,659549,723528,193800,461527,90924,446664,129032,374454,3746,524097,723882,649954,2068,219657,664934,602078,621119,514112,87205,69825,388554,227922,30822,3120,59017,424202,9930,336707,570288,499494,724262,510631,271137,532793,228601,47683,540170,649585,201385,542381,174602,449537,315473,513169,105050,75363,364285,575376,232768,656071,186541,684115,521350,487364,185251,283984,558636,355652,676978,672045,309579,70376,444584,581208,337413,734407,545386,343690,316958,502268,370757,484176,492643,222958,236563,710133,128289,8537,112095,160181,686470,94462,573610,185657,286465,81671,115910,323323,564771,638297,568237,372555,705815,170909,214502,566242,551040,214804,1507,109087,712012,54421,425172,139343,577292,360698,181184,220996,595030,519939,164580,348343,626866,155167,619511,591452,174833,234849,209349,478458,272473,446527,119115,108649,535003,485445,40959,731524,304405,605339,711869,11780,104673,231048,122563,482016,508499,439705,513258,590456,640897,3017,234536,714090,328618,689742,245206,663071,25929,596095,430201,288112,217037,383793,66263,130712,689802,572446,472730,735044,333179,497882,42505,316036,634647,567724,523777,453164,190544,398047,393074,549729,437420,584645,650786,116110,676842,667582,298650,183371,352398,624406,9385,313401,271696,632455,409052,694583,105904,309393,530494,223632,226154,710084,598324,53390,700346,571504,496029,258177,627929,54521,233291,559389,38828,168265,539746,548932,514268,200748,17307,20410,723990,501705,249279,21502,44229,134079,621395,544854,391286,382630,358790,96886,523048,163603,180752,76711,343467,575278,435557,8496,625762,32199,140468,77513,293889,21712,452288,573807,522814,361929,259529,628927,336646,237594,434959,433409,89800,214616,450717,115664,456201,534160,311409,466543,168791,459426,428566,218194,58542,45395,595195,682568,194103,639527,641128,525610,128412,679379,496041,323625,36,196344,328164,425469,284619,335521,92,501768,592881,595789,235839,447842,655596,545015,532099,129930,111179,325284,200850,573615,212927,86283,202204,585521,267523,728624,707987,220501,107143,431370,28309,305557,252818,153902,355730,365109,645786,125507,318410,311385,335647,687296,175780,238820,486034,304241,448164,199941,39615,36877,586726,204064,408027,265200,592759,667682,106769,603417,551215,431973,367947,641337,190934,313264,261779,366650,203028,655931,160262,390963,95550,609314,273089,119786,81878,507607,735704,246414,615974,469960,373084,641857,77890,138204,263434,545648,298076,1899,35212,353188,509380,83712,188309,4853,663427,492991,646388,459691,399314,667763,548543,604505,586919,519405,201268,641544,582631,725645,680703,344327,104751,656460,96304,297944,19252,306506,267697,203058,82270,433732,376880,701373,274514,518926,537926,207305,389697,563596,128095,425023,63978,202099,12851,47659,409274,430809,655020,352635,442442,695236,718242,117915,199378,655418,311484,138312,115185,55578,99921,118475,304494,353464,540122,387793,501114,712370,532391,247936,69590,581426,51823,264019,49833,469774,95921,420905,460117,510875,127351,53652,654732,256445,28973,240608,653133,382871,198642,327679,729403,532967,440316,159247,16120,182041,471388,51305,387971,734645,368876,547136,303537,294953,663801,320944,123482,333275,284185,180328,713339,656350,233645,278262,316650,296998,20735,284697,23652,711114,317696,103634,462590,727559,60444,96969,238449,674443,117213,57075,154468,493570,117849,576695,53784,637379,722432,114464,546930,654575,137448,563896,289733,210599,660429,362081,351256,294186,166988,210517,213201,106117,733814,260288,344827,619908,544847,353108,73060,337500,471624,601168,81665,83186,268629,125219,222220,635197,618300,622187,440736,238084,158295,722160,105538,525072,143284,690357,650292,370958,105868,113049,202330,535444,678816,374563,598232,288903,107465,712996,260190,547616,709614,246787,438473,429459,664930,580262,338896,712598,301341,114465,552384,172170,456467,510362,278573,538282,674367,439990,593086,239297,138468,228728,3060,469058,614543,38096,599623,502607,7820,625263,259777,506957,139728,465239,429585,614853,254274,722116,602843,369743,114787,96729,404051,698526,229877,371458,621025,1436,459134,310560,259783,539681,194422,167510,108381,547893,8529,68463,333016,346161,522734,662890,513317,174961,195680,393113,25154,55650,492609,37522,418151,185421,473883,387977,30088,423570,249407,719614,227993,418056,404572,590936,309693,692132,9208,85324,132785,199448,299917,458060,351212,54210,11659,182020,356854,597157,324101,384297,603236,301322,10839,133426,9057,736332,722402,688125,273460,668658,268906,161415,43896,529740,535002,479991,523364,412505,357939,616499,384186,735123,26764,726499,177452,510536,490288,649846,150317,709727,125808,485502,351837,513836,56463,503025,75749,257686,161858,248175,635815,302467,357421,3170,331717,634225,477979,609131,12288,663462,683881,719676,566141,186,277163,220952,355054,364610,136083,491996,380625,482735,6239,112580,593528,438122,726948,414455,671305,697305,206072,300444,383194,485722,77155,553200,198948,522041,569673,94408,279094,430692,16902,23383,718550,323185,549400,117616,43194,387437,34052,662077,502901,136734,356145,416676,250862,545093,220230,103671,664388,573318,67651,328054,562810,264937,632919,727865,254806,674520,537171,513221,388658,57857,733091,3451,389729,843,174036,311697,562733,582260,176773,493675,690519,59278,373134,177276,287913,606253,535858,724929,462044,698799,244257,648192,714054,132274,361578,557018,378452,427689,596003,665714,432512,358529,147954,355702,212397,144787,40347,342800,623865,7895,297032,206171,103109,548364,365520,675537,185641,199201,427341,172573,442586,6050,556336,345229,600573,522940,311852,670822,274866,226891,305996,435281,715035,321681,456675,170232,208549,538944,598510,330553,184017,189277,123358,394260,382644,435146,716026,565628,151408,24512,240587,538599,191442,134772,714612,226482,287153,147618,735001,98657,597429,333027,406155,377246,485694,661724,52201,113788,546431,144872,503937,626111,461083,618472,85713,42548,550558,535100,277202,433658,710565,272574,260100,56756,626485,289036,95566,696578,664700,63123,699896,329047,80384,469422,387956,652835,232141,185537,369266,462353,172242,111874,429409,392230,370239,608128,440174,122060,687778,592765,700406,161463,305688,230011,365013,122202,724965,658388,289682,669726,195530,312294,132366,126065,412618,236960,663528,306564,584029,240246,153347,277884,466881,537681,345637,613962,555727,710148,210099,145272,473694,94452,519070,586021,45399,617011,227510,732898,425391,596488,361780,184164,253734,726080,104069,623237,269188,224881,402671,544816,184034,281995,32564,656616,209847,245426,388389,65293,1299,449217,44755,53759,501029,248780,249080,410718,196294,55464,215446,553851,63097,558092,337800,633262,386744,678116,243168,607034,371746,717215,414905,176481,375669,732108,540417,522161,486872,451007,222762,642141,152264,269450,179267,87612,77760,166465,307199,360914,621967,715418,198720,15810,703144,348895,688350,26048,507840,531924,650042,482020,530315,721928,314772,376320,596257,576468,290288,288445,558657,470186,131126,735915,659927,573297,690398,136625,498940,651870,129998,482051,699389,512993,619708,191328,250297,412707,722366,491781,682577,243189,721568,563175,43804,27972,679402,621483,287525,701944,439624,71484,589368,605193,652866,401215,713883,674202,277361,563563,685394,124206,595566,494159,381131,293335,686601,71655,47440,689410,646321,94273,280085,674639,448916,614944,13307,322840,142332,659116,573789,424642,197847,415435,117977,537526,237548,184075,505609,160546,465337,226796,525147,552334,636751,246444,42313,6149,359001,510399,480371,384041,681574,671075,180166,567072,654174,162237,103398,650008,296584,711903,197216,660366,18479,514250,102576,590506,176316,213040,702585,249233};
static const uint64_t omega_2560[2560]={507899,484725,674883,405882,309043,460817,189841,530248,337224,529207,98818,3279,221887,224530,642844,89241,235722,487758,228510,155549,405168,383495,359311,293374,316546,198879,296183,616355,625069,338050,81664,230703,664156,295633,644793,594378,560302,716285,136526,176939,733535,115939,603316,264382,520657,339823,330480,191567,639400,318254,223169,206502,108471,702583,582254,581268,192562,333256,581556,75792,727351,124687,558512,715002,559440,256823,600500,586932,599449,710981,689598,476153,238727,318978,523543,429212,362835,113845,561450,394187,632231,270691,36267,425115,298527,444218,576240,326529,733664,232596,249917,236383,491115,572372,440733,448116,111952,238408,453437,48628,292697,155836,693284,323101,382749,119057,393840,307002,341142,77290,253105,438846,644882,686293,459368,731260,367620,308803,312365,230069,50811,426478,662378,596685,623327,71545,201620,111562,365814,150167,98984,622055,464399,119916,593398,691404,634789,452108,664273,109955,735774,431815,19126,549988,13624,169578,272298,403588,143467,378385,516285,289734,276867,317483,520412,3958,310106,639103,392593,162359,562448,347947,47157,156955,316384,172402,397065,274303,353539,114596,251836,354323,452083,464489,544226,209672,226072,48358,494329,569733,614718,607832,256086,402677,354113,690828,131048,401199,103449,619077,23191,299590,622504,41711,695921,221607,51336,198256,390059,585612,520244,194954,633178,229769,602527,476763,247402,339612,236830,140918,239399,292275,705817,591986,260380,330791,347072,427527,610820,334839,344207,682904,538081,648048,211595,199030,352720,677061,352250,17702,553910,154006,667259,261199,505607,246658,26867,508993,645322,221174,631377,258546,449748,679057,259770,322116,326438,714240,161833,458275,165777,538537,340282,282618,151495,625506,350308,364768,461629,249735,197535,349589,251807,299521,542960,385053,659459,597476,338455,516497,715779,44724,237177,466147,168948,251252,140546,451667,59716,220738,214233,429931,475796,275953,268225,206669,322361,662303,734614,451578,705082,321672,199258,198837,343932,697123,154095,21893,160265,520582,477752,158731,87823,22171,405950,56192,400267,706610,234623,139748,621617,119746,119604,105498,448788,85249,420682,616211,683454,509643,678739,726624,301690,446897,426997,651629,546556,544972,449926,125606,57902,352066,51345,240687,56774,686535,535329,125448,623724,59061,737189,385462,212029,688665,9638,137065,178561,188533,16097,114098,607351,364068,28644,612827,212299,487033,333022,215631,631111,315196,469758,153825,223525,574162,442016,25202,32068,371443,719725,52495,583379,724176,556954,414854,255338,234914,282882,167336,433799,361592,561501,388869,218178,105307,367509,277008,736475,459914,110523,54917,533217,736001,682818,706070,637887,230261,464485,689208,603559,672738,369334,115620,494,526748,384142,132824,172638,690499,627962,542361,346318,477237,24498,481346,391141,443874,510915,285885,71047,557135,121307,679656,298505,504338,162135,571349,287189,730180,436867,489829,735382,631712,281440,86396,503470,657427,520232,629900,340277,95205,90893,77917,14247,75702,303041,508413,286563,564152,517219,351363,95737,714874,37897,327430,148192,536230,277257,190077,86401,690883,718029,330540,228680,629343,253793,569496,726170,536965,547571,251199,218355,694023,448433,49984,541626,76004,416115,629825,478206,660737,724430,197969,101943,646006,496806,369271,555884,121646,557568,278547,619366,238816,410893,422609,444187,593929,245709,140280,508317,79726,432787,177988,681977,591374,324196,138460,119837,139028,176261,240430,155855,373260,111020,104288,68983,165185,614724,390359,33896,469959,609930,152970,616266,533154,438984,66689,736890,532292,716803,530663,409602,398206,574564,616945,621373,116276,553719,72727,121737,576992,349310,411008,309422,363471,654699,602302,153269,469436,28380,596986,404006,475749,136289,288391,662668,407424,451838,128624,523852,657208,716546,629744,96327,711178,553404,62204,727497,731092,558616,631875,640312,440003,365215,111432,654043,49077,607290,731841,321493,420314,683497,57008,315179,717291,537603,278653,463748,491385,370740,26836,526682,564502,365071,169817,88355,646152,365930,369375,472757,202518,3467,43262,143866,293410,486270,340301,699875,676695,347045,300234,136113,32070,298952,154141,566443,422891,544890,472933,458839,367183,296545,29261,736424,465232,524576,220301,201975,146827,244870,690374,366323,501873,664932,185803,170658,203051,222562,457731,714023,285656,629816,435775,256741,623507,182884,171449,655460,667514,234609,647185,157019,208515,505739,623219,299654,514635,375048,184794,246958,212432,458708,323017,478247,280593,189173,411969,498344,657048,617578,165042,268223,279160,150664,148355,157821,630864,51822,277687,87413,137206,597553,128035,122662,596190,501465,707476,549103,19168,502239,670137,640552,588455,324987,590869,564789,653187,109423,111793,471835,443224,477498,517716,400734,368784,144058,707084,11719,281482,38647,422702,391120,99108,551299,50398,281609,227795,634887,586454,230054,225853,244672,494173,325783,493410,333062,240373,378646,272222,209122,254510,17667,716581,467073,520541,120615,693988,611104,363051,394908,672701,604496,256990,77109,546652,14528,581291,464837,464569,593710,442023,140124,264367,695699,158017,162275,657946,509483,579771,261922,473586,14879,24257,499,714161,444744,680413,508699,242284,49269,283683,257290,262674,496367,429504,101083,114053,395196,555931,261310,537402,559829,534303,449281,279602,350335,492061,199055,552504,242790,141071,223445,524678,209665,111150,553340,170073,394160,504938,533265,470779,379860,507045,472580,351083,659824,270286,338715,677320,180678,502674,17605,14678,305433,71054,672057,353606,266631,474078,614118,236702,356656,310006,577248,655115,269794,476757,464875,561802,169548,622382,39976,544338,573862,256451,75487,354373,114370,333228,121868,621158,167608,159676,119392,416734,680931,165555,474947,451221,5027,270919,619665,91986,643400,580611,44223,332788,586987,449149,640322,77548,486419,469329,588884,627209,187185,214485,143437,728469,152673,690605,472344,57649,306165,81464,106993,451919,510503,473411,90953,115030,4190,11241,649368,290800,715057,409140,186164,725731,597198,92770,243606,55983,234126,90377,348570,690562,187698,421209,315498,582832,275237,415168,670747,649227,609089,38274,302575,441353,94336,253790,309592,99984,503324,51022,520128,713027,259405,649306,326178,553417,696934,325,385349,252725,203797,462816,357265,723567,143393,111428,61744,442964,316675,315536,680065,588356,595527,570599,191917,487252,136708,215787,137780,436504,7247,169538,247556,656053,186441,639021,415600,495592,134448,292426,25073,652692,724842,10443,82037,350830,613923,300405,205021,335184,4646,440756,720391,243265,250562,82387,198682,432377,293023,136299,663217,46591,28040,386679,706756,103747,139852,538490,200618,302784,607494,710569,139843,496059,533903,201861,592409,42794,149297,666767,399241,293162,627782,431022,376489,670620,460079,396904,580221,171629,29518,637343,41226,211604,241461,19435,40703,367335,685477,544456,720579,64640,169898,470234,595711,536956,505140,584484,117432,678938,517939,59438,712334,678623,507416,665198,129153,150648,728283,258807,205685,598445,237413,22300,522607,440074,372268,677068,467172,250001,140885,329579,39758,335766,290914,269475,611216,727241,425287,699830,464540,538908,532900,60688,379600,346222,270400,630414,142115,721755,202230,120237,386448,600735,547971,498619,642829,264283,53916,319553,694889,25632,666685,422248,626395,199782,375501,354405,429076,131256,234945,265193,248156,289902,85871,731692,192465,531305,732983,216868,400928,709967,578485,424932,664565,585484,735982,265561,180870,179067,280335,693140,381486,554342,716132,152480,681817,492406,596775,310356,425100,473569,262412,408035,55627,603747,494113,288670,503467,397523,631327,596259,581009,364134,585565,380580,215120,351896,314832,392062,608054,319676,291738,631704,571404,136889,659521,562098,500095,228703,164337,385106,581650,355120,687019,687251,388386,398651,296858,112275,696248,534465,475758,178720,692387,26310,422509,382332,119170,353144,54589,625245,594371,445380,483986,549551,1366,623755,41372,80728,241565,673589,121575,550515,450192,68956,37892,140017,87590,725922,678477,638292,665094,212280,69776,545103,494092,681185,543851,162036,104608,266919,357308,270932,517114,102095,297657,274720,353426,155292,504249,70220,672283,272214,499086,305003,173718,621252,446936,119344,681956,246608,364580,640254,330399,546969,689841,147228,87404,94775,193557,27112,107577,665696,510919,140903,414441,110469,537612,321084,130463,592308,385825,694611,517228,393794,499733,78516,52982,257924,138738,365522,411919,98776,51028,302655,490837,326687,167842,525601,301354,91608,335860,570242,229143,436499,557115,108936,437248,319992,634656,480433,674278,584620,349011,557838,76915,205469,317382,126162,549272,160567,633656,599164,350374,184408,229382,252556,62398,331399,428238,276464,547440,207033,400057,208074,638463,734002,515394,512751,94437,648040,501559,249523,508771,581732,332113,353786,377970,443907,420735,538402,441098,120926,112212,399231,655617,506578,73125,441648,92488,142903,176979,20996,600755,560342,3746,621342,133965,472899,216624,397458,406801,545714,97881,419027,514112,530779,628810,34698,155027,156013,544719,404025,155725,661489,9930,612594,178769,22279,177841,480458,136781,150349,137832,26300,47683,261128,498554,418303,213738,308069,374446,623436,175831,343094,105050,466590,701014,312166,438754,293063,161041,410752,3617,504685,487364,500898,246166,164909,296548,289165,625329,498873,283844,688653,444584,581445,43997,414180,354532,618224,343441,430279,396139,659991,484176,298435,92399,50988,277913,6021,369661,428478,424916,507212,686470,310803,74903,140596,113954,665736,535661,625719,371467,587114,638297,115226,272882,617365,143883,45877,102492,285173,73008,627326,1507,305466,718155,187293,723657,567703,464983,333693,593814,358896,220996,447547,460414,419798,216869,733323,427175,98178,344688,574922,174833,389334,690124,580326,420897,564879,340216,462978,383742,622685,485445,382958,285198,272792,193055,527609,511209,688923,242952,167548,122563,129449,481195,334604,383168,46453,606233,336082,633832,118204,714090,437691,114777,695570,41360,515674,685945,539025,347222,151669,217037,542327,104103,507512,134754,260518,489879,397669,500451,596363,497882,445006,31464,145295,476901,406490,390209,309754,126461,402442,393074,54377,199200,89233,525686,538251,384561,60220,385031,719579,183371,583275,70022,476082,231674,490623,710414,228288,91959,516107,105904,478735,287533,58224,477511,415165,410843,23041,575448,279006,571504,198744,396999,454663,585786,111775,386973,372513,275652,487546,539746,387692,485474,437760,194321,352228,77822,139805,398826,220784,21502,692557,500104,271134,568333,486029,596735,285614,677565,516543,523048,307350,261485,461328,469056,530612,414920,74978,2667,285703,32199,415609,538023,538444,393349,40158,583186,715388,577016,216699,259529,578550,649458,715110,331331,681089,337014,30671,502658,597533,115664,617535,617677,631783,288493,652032,316599,121070,53827,227638,58542,10657,435591,290384,310284,85652,190725,192309,287355,611675,679379,385215,685936,496594,680507,50746,201952,611833,113557,678220,92,351819,525252,48616,727643,600216,558720,548748,721184,623183,129930,373213,708637,124454,524982,250248,404259,521650,106170,422085,267523,583456,513756,163119,295265,712079,705213,365838,17556,684786,153902,13105,180327,322427,481943,502367,454399,569945,303482,375689,175780,348412,519103,631974,369772,460273,806,277367,626758,682364,204064,1280,54463,31211,99394,507020,272796,48073,133722,64543,367947,621661,736787,210533,353139,604457,564643,46782,109319,194920,390963,260044,712783,255935,346140,293407,226366,451396,666234,180146,615974,57625,438776,232943,575146,165932,450092,7101,300414,247452,1899,105569,455841,650885,233811,79854,217049,107381,397004,642076,646388,659364,723034,661579,434240,228868,450718,173129,220062,385918,641544,22407,699384,409851,589089,201051,460024,547204,650880,46398,19252,406741,508601,107938,483488,167785,11111,200316,189710,486082,518926,43258,288848,687297,195655,661277,321166,107456,259075,76544,12851,539312,635338,91275,240475,368010,181397,615635,179713,458734,117915,498465,326388,314672,293094,143352,491572,597001,228964,657555,304494,559293,55304,145907,413085,598821,617444,598253,561020,496851,581426,364021,626261,632993,668298,572096,122557,346922,703385,267322,127351,584311,121015,204127,298297,670592,391,204989,20478,206618,327679,339075,162717,120336,115908,621005,183562,664554,615544,160289,387971,326273,427859,373810,82582,134979,584012,267845,708901,140295,333275,261532,600992,448890,74613,329857,285443,608657,213429,80073,20735,107537,640954,26103,183877,675077,9784,6189,178665,105406,96969,297278,372066,625849,83238,688204,129991,5440,415788,316967,53784,680273,422102,19990,199678,458628,273533,245896,366541,710445,210599,172779,372210,567464,648926,91129,371351,367906,264524,534763,733814,694019,593415,443871,251011,396980,37406,60586,390236,437047,601168,705211,438329,583140,170838,314390,192391,264348,278442,370098,440736,708020,857,272049,212705,516980,535306,590454,492411,46907,370958,235408,72349,551478,566623,534230,514719,279550,23258,451625,107465,301506,480540,113774,554397,565832,81821,69767,502672,90096,580262,528766,231542,114062,437627,222646,362233,552487,490323,524849,278573,414264,259034,456688,548108,325312,238937,80233,119703,572239,469058,458121,586617,588926,579460,106417,685459,459594,649868,600075,139728,609246,614619,141091,235816,29805,188178,718113,235042,67144,96729,148826,412294,146412,172492,84094,627858,625488,265446,294057,259783,219565,336547,368497,593223,30197,725562,455799,698634,314579,346161,638173,185982,686883,455672,509486,102394,150827,507227,511428,492609,243108,411498,243871,404219,496908,358635,465059,528159,482771,719614,20700,270208,216740,616666,43293,126177,374230,342373,64580,132785,480291,660172,190629,722753,155990,272444,272712,143571,295258,597157,472914,41582,579264,575006,79335,227798,157510,475359,263695,722402,713024,736782,23120,292537,56868,228582,494997,688012,453598,479991,474607,240914,307777,636198,623228,342085,181350,475971,199879,177452,202978,288000,457679,386946,245220,538226,184777,494491,596210,513836,212603,527616,626131,183941,567208,343121,232343,204016,266502,357421,230236,264701,386198,77457,466995,398566,59961,556603,234607,719676,722603,431848,666227,65224,383675,470650,263203,123163,500579,380625,427275,160033,82166,467487,260524,272406,175479,567733,114899,697305,192943,163419,480830,661794,382908,622911,404053,615413,116123,569673,577605,617889,320547,56350,571726,262334,286060,732254,466362,117616,645295,93881,156670,693058,404493,150294,288132,96959,659733,250862,267952,148397,110072,550096,522796,593844,8812,584608,46676,264937,679632,431116,655817,630288,285362,226778,263870,646328,622251,733091,726040,87913,446481,22224,328141,551117,11550,140083,644511,493675,681298,503155,646904,388711,46719,549583,316072,421783,154449,462044,322113,66534,88054,128192,699007,434706,295928,642945,483491,427689,637297,233957,686259,217153,24254,477876,87975,411103,183864,40347,736956,351932,484556,533484,274465,380016,13714,593888,625853,675537,294317,420606,421745,57216,148925,141754,166682,545364,250029,600573,521494,599501,300777,730034,567743,489725,81228,550840,98260,321681,241689,602833,444855,712208,84589,12439,726838,655244,386451,123358,436876,532260,402097,732635,296525,16890,494016,486719,654894,538599,304904,444258,600982,74064,690690,709241,350602,30525,633534,597429,198791,536663,434497,129787,26712,597438,241222,203378,535420,144872,694487,587984,70514,338040,444119,109499,306259,360792,66661,277202,340377,157060,565652,707763,99938,696055,525677,495820,717846,696578,369946,51804,192825,16702,672641,567383,267047,141570,200325,232141,152797,619849,58343,219342,677843,24947,58658,229865,72083,608128,586633,8998,478474,531596,138836,499868,714981,214674,297207,365013,60213,270109,487280,596396,407702,697523,401515,446367,467806,126065,10040,311994,37451,272741,198373,204381,676593,357681,391059,466881,106867,595166,15526,535051,617044,350833,136546,189310,238662,94452,472998,683365,417728,42392,711649,70596,315033,110886,537499,361780,382876,308205,606025,502336,472088,489125,447379,651410,5589,544816,205976,4298,520413,336353,27314,158796,312349,72716,151797,1299,471720,556411,558214,456946,44141,355795,182939,21149,584801,55464,244875,140506,426925,312181,263712,474869,329246,681654,133534,243168,448611,233814,339758,105954,141022,156272,373147,151716,356701,522161,385385,422449,345219,129227,417605,445543,105577,165877,600392,77760,175183,237186,508578,572944,352175,155631,382161,50262,50030,348895,338630,440423,625006,41033,202816,261523,558561,44894,710971,314772,354949,618111,384137,682692,112036,142910,291901,253295,187730,735915,113526,695909,656553,495716,63692,615706,186766,287089,668325,699389,597264,649691,11359,58804,98989,72187,525001,667505,192178,243189,56096,193430,575245,632673,470362,379973,466349,220167,635186,439624,462561,383855,581989,233032,667061,64998,465067,238195,432278,563563,116029,290345,617937,55325,490673,372701,97027,406882,190312,47440,590053,649877,642506,543724,710169,629704,71585,226362,596378,322840,626812,199669,416197,606818,144973,351456,42670,220053,343487,237548,658765,684299,479357,598543,371759,325362,638505,686253,434626,246444,410594,569439,211680,435927,645673,401421,167039,508138,300782,180166,628345,300033,417289,102625,256848,63003,152661,388270,179443,660366,531812,419899,611119,188009,576714,103625,138117,386907,552873};

/* multiplication inverses of omega */
static const __m256i w_4_inv[3][3]={{{225910,225910,225910,225910},{737280,737280,737280,737280},{511371,511371,511371,511371}},
{{737280,737280,737280,737280},{1,1,1,1},{737280,737280,737280,737280}},
{{511371,511371,511371,511371},{737280,737280,737280,737280},{225910,225910,225910,225910}}};

static const __m256i w_9_inv[8][8]={{{529254,529254,529254,529254},{524434,524434,524434,524434},{512414,512414,512414,512414},{139802,139802,139802,139802},{195672,195672,195672,195672},{224866,224866,224866,224866},{68225,68225,68225,68225},{17175,17175,17175,17175}},
{{524434,524434,524434,524434},{139802,139802,139802,139802},{224866,224866,224866,224866},{17175,17175,17175,17175},{529254,529254,529254,529254},{512414,512414,512414,512414},{195672,195672,195672,195672},{68225,68225,68225,68225}},
{{512414,512414,512414,512414},{224866,224866,224866,224866},{1,1,1,1},{512414,512414,512414,512414},{224866,224866,224866,224866},{1,1,1,1},{512414,512414,512414,512414},{224866,224866,224866,224866}},
{{139802,139802,139802,139802},{17175,17175,17175,17175},{512414,512414,512414,512414},{68225,68225,68225,68225},{524434,524434,524434,524434},{224866,224866,224866,224866},{529254,529254,529254,529254},{195672,195672,195672,195672}},
{{195672,195672,195672,195672},{529254,529254,529254,529254},{224866,224866,224866,224866},{524434,524434,524434,524434},{68225,68225,68225,68225},{512414,512414,512414,512414},{17175,17175,17175,17175},{139802,139802,139802,139802}},
{{224866,224866,224866,224866},{512414,512414,512414,512414},{1,1,1,1},{224866,224866,224866,224866},{512414,512414,512414,512414},{1,1,1,1},{224866,224866,224866,224866},{512414,512414,512414,512414}},
{{68225,68225,68225,68225},{195672,195672,195672,195672},{512414,512414,512414,512414},{529254,529254,529254,529254},{17175,17175,17175,17175},{224866,224866,224866,224866},{139802,139802,139802,139802},{524434,524434,524434,524434}},
{{17175,17175,17175,17175},{68225,68225,68225,68225},{224866,224866,224866,224866},{195672,195672,195672,195672},{139802,139802,139802,139802},{512414,512414,512414,512414},{524434,524434,524434,524434},{529254,529254,529254,529254}}};

/* (in Montgomery form) */
static const uint64_t omega_256_inv[128]={507899,660366,180166,246444,237548,322840,47440,563563,439624,243189,699389,735915,314772,348895,77760,522161,243168,55464,1299,544816,361780,94452,466881,126065,365013,608128,232141,696578,277202,144872,597429,538599,123358,321681,600573,675537,40347,427689,462044,493675,733091,264937,250862,117616,569673,697305,380625,719676,357421,513836,177452,479991,722402,597157,132785,719614,492609,346161,259783,96729,139728,469058,278573,580262,107465,370958,440736,601168,733814,210599,53784,96969,20735,333275,387971,327679,127351,581426,304494,117915,12851,518926,19252,641544,646388,1899,615974,390963,367947,204064,175780,153902,267523,129930,92,679379,58542,115664,259529,32199,523048,21502,539746,571504,105904,183371,393074,497882,217037,714090,122563,485445,174833,220996,1507,638297,686470,484176,444584,487364,105050,47683,9930,514112,3746,655617,332113,638463};
static const uint64_t omega_1024_inv[1024]={507899,537892,576714,435472,660366,71459,256848,163653,180166,657163,645673,173039,246444,481057,371759,612804,237548,372051,144973,334500,322840,602311,710169,594692,47440,286918,490673,417981,563563,697502,667061,224936,439624,593224,470362,567082,243189,27612,98989,68075,699389,60146,63692,639218,735915,708940,112036,699851,314772,126191,202816,156645,348895,542158,352175,256142,77760,592138,417605,448894,522161,326439,141022,531571,243168,619268,263712,154937,55464,177050,44141,722047,1299,476552,27314,419887,544816,562766,472088,564031,361780,155867,711649,465636,94452,168789,617044,605101,466881,723169,198373,101706,126065,66347,407702,132786,365013,316318,138836,574734,608128,497839,677843,316939,232141,548629,672641,475641,696578,157809,99938,575147,277202,453171,444119,201260,144872,195851,26712,177469,597429,103686,690690,228874,538599,72695,296525,685136,123358,7485,84589,586474,321681,113551,567743,333006,600573,419354,148925,284798,675537,370566,274465,396925,40347,463059,24254,686719,427689,159394,699007,535825,462044,112762,46719,202333,493675,451119,328141,287520,733091,365368,285362,478900,264937,48117,522796,271067,250862,538176,404493,560067,117616,213275,571726,428057,569673,164710,382908,230436,697305,389327,260524,727843,380625,724426,383675,458466,719676,60594,466995,565772,357421,683428,567208,379658,513836,315098,245220,735246,177452,303999,623228,655681,479991,317258,56868,644446,722402,707624,79335,454798,597157,569773,155990,406011,132785,217644,43293,353624,719614,508369,496908,611570,492609,396618,509486,694418,346161,190738,30197,610858,259783,645002,84094,629638,96729,265147,29805,350128,139728,54583,106417,600003,469058,90966,325312,681665,278573,481076,222646,639312,580262,568455,565832,352189,107465,213705,534230,601128,370958,535195,516980,630766,440736,53889,314390,601870,601168,367470,396980,35551,733814,7410,91129,16186,210599,657617,458628,263181,53784,323546,688204,298197,96969,244219,675077,410678,20735,403751,329857,285341,333275,429660,134979,616152,387971,231311,621005,407158,327679,32894,670592,64489,127351,101664,572096,395793,581426,319498,598821,277216,304494,580064,143352,328395,117915,39746,368010,349892,12851,501411,661277,139476,518926,608531,167785,114768,19252,90700,201051,310553,641544,680544,228868,391666,646388,110691,79854,262085,1899,424232,165932,571262,615974,698405,293407,514657,390963,265321,604457,670494,367947,650298,507020,24716,204064,490188,460273,119737,175780,154885,502367,725370,153902,145716,712079,428140,267523,707355,250248,1892,129930,466600,600216,155572,92,286890,50746,146091,679379,330456,85652,198868,58542,351017,652032,208359,115664,88577,681089,181344,259529,77326,40158,626996,32199,731196,530612,474249,523048,544005,486029,233113,21502,631781,352228,693889,539746,267589,111775,575154,571504,152503,415165,661662,105904,202368,490623,422341,183371,377687,538251,397953,393074,228698,406490,680841,497882,379181,260518,580910,217037,538592,515674,597193,714090,400237,46453,78072,122563,76809,527609,293742,485445,431494,564879,730203,174833,679832,733323,640050,220996,45911,567703,336494,1507,163502,45877,718124,638297,668770,665736,340476,686470,596858,6021,359706,484176,689607,618224,502205,444584,160712,289165,589647,487364,116701,293063,692110,105050,424293,308069,268324,47683,708097,480458,571448,9930,608666,156013,109093,514112,438487,397458,436238,3746,558086,142903,515004,655617,633028,538402,532242,332113,236074,648040,261549,638463,64470,276464,75156,229382,199389,160567,301809,76915,665822,480433,573628,557115,80118,91608,564242,490837,256224,365522,124477,499733,365230,592308,402781,414441,134970,27112,142589,689841,450363,246608,319300,173718,39779,70220,512345,297657,144057,266919,170199,494092,709669,638292,669206,37892,677135,673589,98063,1366,28341,625245,37430,422509,611090,534465,580636,388386,195123,385106,481139,659521,145143,319676,288387,215120,410842,596259,205710,494113,118013,473569,582344,681817,560231,693140,15234,735982,260729,709967,317394,192465,174515,265193,173250,375501,581414,25632,271645,642829,568492,120237,132180,270400,14112,538908,635575,611216,670934,329579,604495,372268,420963,598445,162547,129153,239442,59438,420342,505140,188652,64640,261640,40703,579472,637343,162134,460079,284110,293162,536021,592409,541430,710569,559812,139852,633595,46591,508407,198682,664586,440756,52145,613923,729796,652692,150807,415600,623730,169538,404275,136708,317927,588356,452483,61744,366715,462816,340356,696934,274222,713027,50562,309592,577887,38274,201456,275237,624519,690562,534948,243606,286162,409140,449761,4190,371913,451919,258381,472344,689164,214485,466214,486419,199105,332788,177214,619665,524006,165555,309224,167608,572571,354373,506845,39976,347954,476757,9438,356656,12855,353606,278815,17605,676687,270286,171509,379860,53853,170073,357623,223445,422183,492061,2035,559829,433282,114053,81600,257290,420023,680413,92835,14879,29657,657946,282483,140124,167508,581291,331270,604496,519637,693988,383657,17667,228912,240373,125711,244672,340663,227795,42863,391120,546543,707084,126423,477498,92279,653187,107643,640552,472134,707476,387153,597553,682698,630864,137278,268223,646315,411969,55616,458708,256205,514635,97969,157019,168826,171449,385092,629816,523576,203051,136153,366323,202086,220301,106515,296545,683392,422891,135411,136113,369811,340301,701730,3467,729871,646152,721095,526682,79664,278653,474100,683497,413735,49077,439084,640312,493062,62204,326603,716546,333530,407424,451940,404006,307621,602302,121129,349310,505970,116276,330123,409602,704387,66689,672792,609930,635617,165185,341488,155855,417783,138460,460065,432787,157217,593929,408886,619366,697535,369271,387389,724430,235870,76004,597805,218355,128750,569496,622513,718029,646581,536230,426728,95737,56737,508413,345615,90893,626590,657427,475196,735382,313049,571349,166019,121307,38876,443874,222624,346318,471960,132824,66787,369334,86983,230261,712565,533217,247093,277008,617544,561501,582396,234914,11911,583379,591565,25202,309141,469758,29926,487033,735389,607351,270681,137065,581709,737189,450391,686535,591190,57902,406825,651629,538413,678739,386264,85249,528922,621617,648704,56192,555937,477752,659955,697123,110285,705082,6085,206669,263032,214233,193276,251252,504168,715779,105500,385053,43392,197535,469692,625506,162127,165777,584778,322116,75619,631377,534913,246658,314940,553910,359594,199030,339328,344207,508583,330791,56440,239399,358100,476763,156371,520244,198689,221607,140088,23191,337044,690828,659209,614718,660472,209672,443539,251836,305787,172402,7078,562448,57449,3958,97231,516285,691370,169578,400787,735774,573779,691404,19157,98984,68511,71545,396805,50811,140423,731260,377575,253105,47674,119057,235076,292697,576569,448116,147634,249917,620580,444218,45171,632231,312988,429212,468957,689598,29184,256823,165833,727351,128615,581268,628188,223169,298794,339823,301043,733535,179195,594378,222277,81664,104253,198879,205039,405168,501207,89241,475732,98818,672811,460817,662125};
static const uint64_t omega_2304_inv[2304]={507899,249233,702585,213040,176316,590506,102576,514250,18479,660366,197216,711903,296584,650008,103398,162237,654174,567072,180166,671075,681574,384041,480371,510399,359001,6149,42313,246444,636751,552334,525147,226796,465337,160546,505609,184075,237548,537526,117977,415435,197847,424642,573789,659116,142332,322840,13307,614944,448916,674639,280085,94273,646321,689410,47440,71655,686601,293335,381131,494159,595566,124206,685394,563563,277361,674202,713883,401215,652866,605193,589368,71484,439624,701944,287525,621483,679402,27972,43804,563175,721568,243189,682577,491781,722366,412707,250297,191328,619708,512993,699389,482051,129998,651870,498940,136625,690398,573297,659927,735915,131126,470186,558657,288445,290288,576468,596257,376320,314772,721928,530315,482020,650042,531924,507840,26048,688350,348895,703144,15810,198720,715418,621967,360914,307199,166465,77760,87612,179267,269450,152264,642141,222762,451007,486872,522161,540417,732108,375669,176481,414905,717215,371746,607034,243168,678116,386744,633262,337800,558092,63097,553851,215446,55464,196294,410718,249080,248780,501029,53759,44755,449217,1299,65293,388389,245426,209847,656616,32564,281995,184034,544816,402671,224881,269188,623237,104069,726080,253734,184164,361780,596488,425391,732898,227510,617011,45399,586021,519070,94452,473694,145272,210099,710148,555727,613962,345637,537681,466881,277884,153347,240246,584029,306564,663528,236960,412618,126065,132366,312294,195530,669726,289682,658388,724965,122202,365013,230011,305688,161463,700406,592765,687778,122060,440174,608128,370239,392230,429409,111874,172242,462353,369266,185537,232141,652835,387956,469422,80384,329047,699896,63123,664700,696578,95566,289036,626485,56756,260100,272574,710565,433658,277202,535100,550558,42548,85713,618472,461083,626111,503937,144872,546431,113788,52201,661724,485694,377246,406155,333027,597429,98657,735001,147618,287153,226482,714612,134772,191442,538599,240587,24512,151408,565628,716026,435146,382644,394260,123358,189277,184017,330553,598510,538944,208549,170232,456675,321681,715035,435281,305996,226891,274866,670822,311852,522940,600573,345229,556336,6050,442586,172573,427341,199201,185641,675537,365520,548364,103109,206171,297032,7895,623865,342800,40347,144787,212397,355702,147954,358529,432512,665714,596003,427689,378452,557018,361578,132274,714054,648192,244257,698799,462044,724929,535858,606253,287913,177276,373134,59278,690519,493675,176773,582260,562733,311697,174036,843,389729,3451,733091,57857,388658,513221,537171,674520,254806,727865,632919,264937,562810,328054,67651,573318,664388,103671,220230,545093,250862,416676,356145,136734,502901,662077,34052,387437,43194,117616,549400,323185,718550,23383,16902,430692,279094,94408,569673,522041,198948,553200,77155,485722,383194,300444,206072,697305,671305,414455,726948,438122,593528,112580,6239,482735,380625,491996,136083,364610,355054,220952,277163,186,566141,719676,683881,663462,12288,609131,477979,634225,331717,3170,357421,302467,635815,248175,161858,257686,75749,503025,56463,513836,351837,485502,125808,709727,150317,649846,490288,510536,177452,726499,26764,735123,384186,616499,357939,412505,523364,479991,535002,529740,43896,161415,268906,668658,273460,688125,722402,736332,9057,133426,10839,301322,603236,384297,324101,597157,356854,182020,11659,54210,351212,458060,299917,199448,132785,85324,9208,692132,309693,590936,404572,418056,227993,719614,249407,423570,30088,387977,473883,185421,418151,37522,492609,55650,25154,393113,195680,174961,513317,662890,522734,346161,333016,68463,8529,547893,108381,167510,194422,539681,259783,310560,459134,1436,621025,371458,229877,698526,404051,96729,114787,369743,602843,722116,254274,614853,429585,465239,139728,506957,259777,625263,7820,502607,599623,38096,614543,469058,3060,228728,138468,239297,593086,439990,674367,538282,278573,510362,456467,172170,552384,114465,301341,712598,338896,580262,664930,429459,438473,246787,709614,547616,260190,712996,107465,288903,598232,374563,678816,535444,202330,113049,105868,370958,650292,690357,143284,525072,105538,722160,158295,238084,440736,622187,618300,635197,222220,125219,268629,83186,81665,601168,471624,337500,73060,353108,544847,619908,344827,260288,733814,106117,213201,210517,166988,294186,351256,362081,660429,210599,289733,563896,137448,654575,546930,114464,722432,637379,53784,576695,117849,493570,154468,57075,117213,674443,238449,96969,60444,727559,462590,103634,317696,711114,23652,284697,20735,296998,316650,278262,233645,656350,713339,180328,284185,333275,123482,320944,663801,294953,303537,547136,368876,734645,387971,51305,471388,182041,16120,159247,440316,532967,729403,327679,198642,382871,653133,240608,28973,256445,654732,53652,127351,510875,460117,420905,95921,469774,49833,264019,51823,581426,69590,247936,532391,712370,501114,387793,540122,353464,304494,118475,99921,55578,115185,138312,311484,655418,199378,117915,718242,695236,442442,352635,655020,430809,409274,47659,12851,202099,63978,425023,128095,563596,389697,207305,537926,518926,274514,701373,376880,433732,82270,203058,267697,306506,19252,297944,96304,656460,104751,344327,680703,725645,582631,641544,201268,519405,586919,604505,548543,667763,399314,459691,646388,492991,663427,4853,188309,83712,509380,353188,35212,1899,298076,545648,263434,138204,77890,641857,373084,469960,615974,246414,735704,507607,81878,119786,273089,609314,95550,390963,160262,655931,203028,366650,261779,313264,190934,641337,367947,431973,551215,603417,106769,667682,592759,265200,408027,204064,586726,36877,39615,199941,448164,304241,486034,238820,175780,687296,335647,311385,318410,125507,645786,365109,355730,153902,252818,305557,28309,431370,107143,220501,707987,728624,267523,585521,202204,86283,212927,573615,200850,325284,111179,129930,532099,545015,655596,447842,235839,595789,592881,501768,92,335521,284619,425469,328164,196344,36,323625,496041,679379,128412,525610,641128,639527,194103,682568,595195,45395,58542,218194,428566,459426,168791,466543,311409,534160,456201,115664,450717,214616,89800,433409,434959,237594,336646,628927,259529,361929,522814,573807,452288,21712,293889,77513,140468,32199,625762,8496,435557,575278,343467,76711,180752,163603,523048,96886,358790,382630,391286,544854,621395,134079,44229,21502,249279,501705,723990,20410,17307,200748,514268,548932,539746,168265,38828,559389,233291,54521,627929,258177,496029,571504,700346,53390,598324,710084,226154,223632,530494,309393,105904,694583,409052,632455,271696,313401,9385,624406,352398,183371,298650,667582,676842,116110,650786,584645,437420,549729,393074,398047,190544,453164,523777,567724,634647,316036,42505,497882,333179,735044,472730,572446,689802,130712,66263,383793,217037,288112,430201,596095,25929,663071,245206,689742,328618,714090,234536,3017,640897,590456,513258,439705,508499,482016,122563,231048,104673,11780,711869,605339,304405,731524,40959,485445,535003,108649,119115,446527,272473,478458,209349,234849,174833,591452,619511,155167,626866,348343,164580,519939,595030,220996,181184,360698,577292,139343,425172,54421,712012,109087,1507,214804,551040,566242,214502,170909,705815,372555,568237,638297,564771,323323,115910,81671,286465,185657,573610,94462,686470,160181,112095,8537,128289,710133,236563,222958,492643,484176,370757,502268,316958,343690,545386,734407,337413,581208,444584,70376,309579,672045,676978,355652,558636,283984,185251,487364,521350,684115,186541,656071,232768,575376,364285,75363,105050,513169,315473,449537,174602,542381,201385,649585,540170,47683,228601,532793,271137,510631,724262,499494,570288,336707,9930,424202,59017,3120,30822,227922,388554,69825,87205,514112,621119,602078,664934,219657,2068,649954,723882,524097,3746,374454,129032,446664,90924,461527,193800,723528,659549,655617,452303,340876,684893,667788,193973,128323,401378,582166,332113,613921,652905,402826,573785,131637,578737,656954,736320,638463,705360,275900,258518,673793,416348,602446,532456,620852,229382,488048,34696,524241,560965,146775,634705,223031,718802,76915,540065,25378,440697,87273,633883,575044,83107,170209,557115,66206,55707,353240,256910,226882,378280,731132,694968,490837,100530,184947,212134,510485,271944,576735,231672,553206,499733,199755,619304,321846,539434,312639,163492,78165,594949,414441,723974,122337,288365,62642,457196,643008,90960,47871,689841,665626,50680,443946,356150,243122,141715,613075,51887,173718,459920,63079,23398,336066,84415,132088,147913,665797,297657,35337,449756,115798,57879,709309,693477,174106,15713,494092,54704,245500,14915,324574,486984,545953,117573,224288,37892,255230,607283,85411,238341,600656,46883,163984,77354,1366,606155,267095,178624,448836,446993,160813,141024,360961,422509,15353,206966,255261,87239,205357,229441,711233,48931,388386,34137,721471,538561,21863,115314,376367,430082,570816,659521,649669,558014,467831,585017,95140,514519,286274,250409,215120,196864,5173,361612,560800,322376,20066,365535,130247,494113,59165,350537,104019,399481,179189,674184,183430,521835,681817,540987,326563,488201,488501,236252,683522,692526,288064,735982,671988,348892,491855,527434,80665,704717,455286,553247,192465,334610,512400,468093,114044,633212,11201,483547,553117,375501,140793,311890,4383,509771,120270,691882,151260,218211,642829,263587,592009,527182,27133,181554,123319,391644,199600,270400,459397,583934,497035,153252,430717,73753,500321,324663,611216,604915,424987,541751,67555,447599,78893,12316,615079,372268,507270,431593,575818,36875,144516,49503,615221,297107,129153,367042,345051,307872,625407,565039,274928,368015,551744,505140,84446,349325,267859,656897,408234,37385,674158,72581,40703,641715,448245,110796,680525,477181,464707,26716,303623,460079,202181,186723,694733,651568,118809,276198,111170,233344,592409,190850,623493,685080,75557,251587,360035,331126,404254,139852,638624,2280,589663,450128,510799,22669,602509,545839,198682,496694,712769,585873,171653,21255,302135,354637,343021,613923,548004,553264,406728,138771,198337,528732,567049,280606,415600,22246,302000,431285,510390,462415,66459,425429,214341,136708,392052,180945,731231,294695,564708,309940,538080,551640,61744,371761,188917,634172,531110,440249,729386,113416,394481,696934,592494,524884,381579,589327,378752,304769,71567,141278,309592,358829,180263,375703,605007,23227,89089,493024,38482,275237,12352,201423,131028,449368,560005,364147,678003,46762,243606,560508,155021,174548,425584,563245,736438,347552,733830,4190,679424,348623,224060,200110,62761,482475,9416,104362,472344,174471,409227,669630,163963,72893,633610,517051,192188,486419,320605,381136,600547,234380,75204,703229,349844,694087,619665,187881,414096,18731,713898,720379,306589,458187,642873,167608,215240,538333,184081,660126,251559,354087,436837,531209,39976,65976,322826,10333,299159,143753,624701,731042,254546,356656,245285,601198,372671,382227,516329,460118,737095,171140,17605,53400,73819,724993,128150,259302,103056,405564,734111,379860,434814,101466,489106,575423,479595,661532,234256,680818,223445,385444,251779,611473,27554,586964,87435,246993,226745,559829,10782,710517,2158,353095,120782,379342,324776,213917,257290,202279,207541,693385,575866,468375,68623,463821,49156,14879,949,728224,603855,726442,435959,134045,352984,413180,140124,380427,555261,725622,683071,386069,279221,437364,537833,604496,651957,728073,45149,427588,146345,332709,319225,509288,17667,487874,313711,707193,349304,263398,551860,319130,699759,244672,681631,712127,344168,541601,562320,223964,74391,214547,391120,404265,668818,728752,189388,628900,569771,542859,197600,477498,426721,278147,735845,116256,365823,507404,38755,333230,640552,622494,367538,134438,15165,483007,122428,307696,272042,597553,230324,477504,112018,729461,234674,137658,699185,122738,268223,734221,508553,598813,497984,144195,297291,62914,198999,458708,226919,280814,565111,184897,622816,435940,24683,398385,157019,72351,307822,298808,490494,27667,189665,477091,24285,629816,448378,139049,362718,58465,201837,534951,624232,631413,366323,86989,46924,593997,212209,631743,15121,578986,499197,296545,115094,118981,102084,515061,612062,468652,654095,655616,136113,265657,399781,664221,384173,192434,117373,392454,476993,3467,631164,524080,526764,570293,443095,386025,375200,76852,526682,447548,173385,599833,82706,190351,622817,14849,99902,683497,160586,619432,243711,582813,680206,620068,62838,498832,640312,676837,9722,274691,633647,419585,26167,713629,452584,716546,440283,420631,459019,503636,80931,23942,556953,453096,404006,613799,416337,73480,442328,433744,190145,368405,2636,349310,685976,265893,555240,721161,578034,296965,204314,7878,409602,538639,354410,84148,496673,708308,480836,82549,683629,609930,226406,277164,316376,641360,267507,687448,473262,685458,155855,667691,489345,204890,24911,236167,349488,197159,383817,432787,618806,637360,681703,622096,598969,425797,81863,537903,619366,19039,42045,294839,384646,82261,306472,328007,689622,724430,535182,673303,312258,609186,173685,347584,529976,199355,218355,462767,35908,360401,303549,655011,534223,469584,430775,718029,439337,640977,80821,632530,392954,56578,11636,154650,95737,536013,217876,150362,132776,188738,69518,337967,277590,90893,244290,73854,732428,548972,653569,227901,384093,702069,735382,439205,191633,473847,599077,659391,95424,364197,267321,121307,490867,1577,229674,655403,617495,464192,127967,641731,346318,577019,81350,534253,370631,475502,424017,546347,95944,369334,305308,186066,133864,630512,69599,144522,472081,329254,533217,150555,700404,697666,537340,289117,433040,251247,498461,561501,49985,401634,425896,418871,611774,91495,372172,381551,583379,484463,431724,708972,305911,630138,516780,29294,8657,469758,151760,535077,650998,524354,163666,536431,411997,626102,607351,205182,192266,81685,289439,501442,141492,144400,235513,737189,401760,452662,311812,409117,540937,737245,413656,241240,57902,608869,211671,96153,97754,543178,54713,142086,691886,678739,519087,308715,277855,568490,270738,425872,203121,281080,621617,286564,522665,647481,303872,302322,499687,400635,108354,477752,375352,214467,163474,284993,715569,443392,659768,596813,705082,111519,728785,301724,162003,393814,660570,556529,573678,214233,640395,378491,354651,345995,192427,115886,603202,693052,715779,488002,235576,13291,716871,719974,536533,223013,188349,197535,569016,698453,177892,503990,682760,109352,479104,241252,165777,36935,683891,138957,27197,511127,513649,206787,427888,631377,42698,328229,104826,465585,423880,727896,112875,384883,553910,438631,69699,60439,621171,86495,152636,299861,187552,344207,339234,546737,284117,213504,169557,102634,421245,694776,239399,404102,2237,264551,164835,47479,606569,671018,353488,520244,449169,307080,141186,711352,74210,492075,47539,408663,23191,502745,734264,96384,146825,224023,297576,228782,255265,614718,506233,632608,725501,25412,131942,432876,5757,696322,251836,202278,628632,618166,290754,464808,258823,527932,502432,562448,145829,117770,582114,110415,388938,572701,217342,142251,516285,556097,376583,159989,597938,312109,682860,25269,628194,735774,522477,186241,171039,522779,566372,31466,364726,169044,98984,172510,413958,621371,655610,450816,551624,163671,642819,50811,577100,625186,728744,608992,27148,500718,514323,244638,253105,366524,235013,420323,393591,191895,2874,399868,156073,292697,666905,427702,65236,60303,381629,178645,453297,552030,249917,215931,53166,550740,81210,504513,161905,372996,661918,632231,224112,421808,287744,562679,194900,535896,87696,197111,689598,508680,204488,466144,226650,13019,237787,166993,400574,727351,313079,678264,734161,706459,509359,348727,667456,650076,223169,116162,135203,72347,517624,735213,87327,13399,213184,733535,362827,608249,290617,646357,275754,543481,13753,77732,81664,284978,396405,52388,69493,543308,608958,335903,155115,405168,123360,84376,334455,163496,605644,158544,80327,961,98818,31921,461381,478763,63488,320933,134835,204825,116429};

static const __m256i V_B4Q_B4Q_B4Q_B4Q = {BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q};
static const __m256i V_B8Q_B8Q_B8Q_B8Q = {BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q};
static const __m256i V_B16Q_B16Q_B16Q_B16Q = {BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q};
static const __m256i V_B32Q_B32Q_B32Q_B32Q = {BARRETT_FACTOR_32Q, BARRETT_FACTOR_32Q, BARRETT_FACTOR_32Q, BARRETT_FACTOR_32Q};
static const __m256i V_Q_Q_Q_Q = {Q, Q, Q, Q};
static const __m256i V_Q2_Q2_Q2_Q2 = {Q2, Q2, Q2, Q2};
static const __m256i V_MM_MM_MM_MM = {MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK};
static const __m256i V_MF_MF_MF_MF = {MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint64_t *a, uint32_t n, const uint64_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	__m256i u, v, t, t1, o, u1, v1, r1, r2;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			j_omega = 0;

			for (j = j1; j < j2; j += 4)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = _mm256_loadu_si256((__m256i *)(a + j));
				v = _mm256_loadu_si256((__m256i *)(a + j + d));
				
				t = _mm256_add_epi64(u, v);
				t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
				t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				r1 = _mm256_sub_epi64(t, t1);
				
				t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
				t = _mm256_sub_epi64(t, v);
				o = _mm256_set_epi64x(omega[j_omega + num_of_problems * 3], omega[j_omega + num_of_problems * 2], omega[j_omega + num_of_problems], omega[j_omega]);
				t = _mm256_mul_epu32(t, o);
				t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
				t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				t1 = _mm256_add_epi64(t, t1);
				r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);

				_mm256_storeu_si256((__m256i *)(a + j), r1);
				_mm256_storeu_si256((__m256i *)(a + j + d), r2);

				j_omega += num_of_problems * 4;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k += 2)
	{
		j = k << 2;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);
		
		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		o = _mm256_set_epi64x(omega[num_of_problems], omega[0], omega[num_of_problems], omega[0]);
		t = _mm256_mul_epu32(t, o);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
		
		u = _mm256_permute2f128_si256(r1, r2, 0x20);
		v = _mm256_permute2f128_si256(r1, r2, 0x31);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
	
	for (k = 0; k < (n >> 1); k += 4)
	{
		j = k << 1;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u1 = _mm256_permute4x64_epi64(u1, 0xD8);
		v1 = _mm256_permute4x64_epi64(v1, 0xD8);
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);

		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r2 = _mm256_sub_epi64(t, t1);

		u1 = _mm256_permute2f128_si256(r1, r2, 0x20);
		v1 = _mm256_permute2f128_si256(r1, r2, 0x31);
		u = _mm256_permute4x64_epi64(u1, 0xD8);
		v = _mm256_permute4x64_epi64(v1, 0xD8);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint64_t *a, uint32_t N1, uint32_t N2, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t))
{
	uint32_t n1, n2;
	__m256i u, v, t, t1;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint64_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), uint64_t inv_n)
{
	uint32_t i, n1, n2;
	__m256i u, v, t, t1;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i += 4)
	{
		u = _mm256_loadu_si256((__m256i *)(a + i));
		v = _mm256_set1_epi64x(inv_n);
		
		t = _mm256_mul_epu32(u, v);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
		_mm256_storeu_si256((__m256i *)(a + i), u);
	}
}

/* 256 * 6 --> 256 * 10 */
static void ntt_butterfly_1536_2560(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, c1, d1, e1, f1, g1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));	
	c = _mm256_loadu_si256((__m256i *)(a + N2_2560 + n2));	
	d = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 2 + n2));	
	e = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 3 + n2));	
	f = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 4 + n2));	
	g = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 5 + n2));	

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_10[0][0]);
	d1 = _mm256_mul_epu32(d, w_10[0][1]);
	e1 = _mm256_mul_epu32(e, w_10[0][2]);
	f1 = _mm256_mul_epu32(f, w_10[0][3]);
	g1 = _mm256_mul_epu32(g, w_10[0][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 + n2), t);
	a[N2_2560 + n2] %= Q;
	a[N2_2560 + n2 + 1] %= Q;
	a[N2_2560 + n2 + 2] %= Q;
	a[N2_2560 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_10[1][0]);
	d1 = _mm256_mul_epu32(d, w_10[1][1]);
	e1 = _mm256_mul_epu32(e, w_10[1][2]);
	f1 = _mm256_mul_epu32(f, w_10[1][3]);
	g1 = _mm256_mul_epu32(g, w_10[1][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 2 + n2), t);
	a[N2_2560 * 2 + n2] %= Q;
	a[N2_2560 * 2 + n2 + 1] %= Q;
	a[N2_2560 * 2 + n2 + 2] %= Q;
	a[N2_2560 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[2][0]);
	d1 = _mm256_mul_epu32(d, w_10[2][1]);
	e1 = _mm256_mul_epu32(e, w_10[2][2]);
	f1 = _mm256_mul_epu32(f, w_10[2][3]);
	g1 = _mm256_mul_epu32(g, w_10[2][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 3 + n2), t);
	a[N2_2560 * 3 + n2] %= Q;
	a[N2_2560 * 3 + n2 + 1] %= Q;
	a[N2_2560 * 3 + n2 + 2] %= Q;
	a[N2_2560 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[3][0]);
	d1 = _mm256_mul_epu32(d, w_10[3][1]);
	e1 = _mm256_mul_epu32(e, w_10[3][2]);
	f1 = _mm256_mul_epu32(f, w_10[3][3]);
	g1 = _mm256_mul_epu32(g, w_10[3][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 4 + n2), t);
	a[N2_2560 * 4 + n2] %= Q;
	a[N2_2560 * 4 + n2 + 1] %= Q;
	a[N2_2560 * 4 + n2 + 2] %= Q;
	a[N2_2560 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[4][0]);
	d1 = _mm256_mul_epu32(d, w_10[4][1]);
	e1 = _mm256_mul_epu32(e, w_10[4][2]);
	f1 = _mm256_mul_epu32(f, w_10[4][3]);
	g1 = _mm256_mul_epu32(g, w_10[4][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 5 + n2), t);
	a[N2_2560 * 5 + n2] %= Q;
	a[N2_2560 * 5 + n2 + 1] %= Q;
	a[N2_2560 * 5 + n2 + 2] %= Q;
	a[N2_2560 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[5][0]);
	d1 = _mm256_mul_epu32(d, w_10[5][1]);
	e1 = _mm256_mul_epu32(e, w_10[5][2]);
	f1 = _mm256_mul_epu32(f, w_10[5][3]);
	g1 = _mm256_mul_epu32(g, w_10[5][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 6 + n2), t);
	a[N2_2560 * 6 + n2] %= Q;
	a[N2_2560 * 6 + n2 + 1] %= Q;
	a[N2_2560 * 6 + n2 + 2] %= Q;
	a[N2_2560 * 6 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[6][0]);
	d1 = _mm256_mul_epu32(d, w_10[6][1]);
	e1 = _mm256_mul_epu32(e, w_10[6][2]);
	f1 = _mm256_mul_epu32(f, w_10[6][3]);
	g1 = _mm256_mul_epu32(g, w_10[6][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 7 + n2), t);
	a[N2_2560 * 7 + n2] %= Q;
	a[N2_2560 * 7 + n2 + 1] %= Q;
	a[N2_2560 * 7 + n2 + 2] %= Q;
	a[N2_2560 * 7 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[7][0]);
	d1 = _mm256_mul_epu32(d, w_10[7][1]);
	e1 = _mm256_mul_epu32(e, w_10[7][2]);
	f1 = _mm256_mul_epu32(f, w_10[7][3]);
	g1 = _mm256_mul_epu32(g, w_10[7][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 8 + n2), t);
	a[N2_2560 * 8 + n2] %= Q;
	a[N2_2560 * 8 + n2 + 1] %= Q;
	a[N2_2560 * 8 + n2 + 2] %= Q;
	a[N2_2560 * 8 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[8][0]);
	d1 = _mm256_mul_epu32(d, w_10[8][1]);
	e1 = _mm256_mul_epu32(e, w_10[8][2]);
	f1 = _mm256_mul_epu32(f, w_10[8][3]);
	g1 = _mm256_mul_epu32(g, w_10[8][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 9 + n2), t);
	a[N2_2560 * 9 + n2] %= Q;
	a[N2_2560 * 9 + n2 + 1] %= Q;
	a[N2_2560 * 9 + n2 + 2] %= Q;
	a[N2_2560 * 9 + n2 + 3] %= Q;
}

/* 256 * 10 --> 256 * 4 */
static void ntt_butterfly_2560_1024(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, i, j, k, c1, d1, e1, f1, g1, h1, i1, j1, k1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));	
	c = _mm256_loadu_si256((__m256i *)(a + N2_2560 + n2));	
	d = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 2 + n2));	
	e = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 3 + n2));	
	f = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 4 + n2));	
	g = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 5 + n2));	
	h = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 6 + n2));	
	i = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 7 + n2));	
	j = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 8 + n2));	
	k = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 9 + n2));	
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);
	t = _mm256_add_epi64(t, i);
	t = _mm256_add_epi64(t, j);
	t = _mm256_add_epi64(t, k);
	t1 = _mm256_mul_epu32(t, V_B32Q_B32Q_B32Q_B32Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_32Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_10[0][0]);
	d1 = _mm256_mul_epu32(d, w_10[0][1]);
	e1 = _mm256_mul_epu32(e, w_10[0][2]);
	f1 = _mm256_mul_epu32(f, w_10[0][3]);
	g1 = _mm256_mul_epu32(g, w_10[0][4]);
	h1 = _mm256_mul_epu32(h, w_10[0][5]);
	i1 = _mm256_mul_epu32(i, w_10[0][6]);
	j1 = _mm256_mul_epu32(j, w_10[0][7]);
	k1 = _mm256_mul_epu32(k, w_10[0][8]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	t = _mm256_add_epi64(t, k1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 + n2), t);
	a[N2_2560 + n2] %= Q;
	a[N2_2560 + n2 + 1] %= Q;
	a[N2_2560 + n2 + 2] %= Q;
	a[N2_2560 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_10[1][0]);
	d1 = _mm256_mul_epu32(d, w_10[1][1]);
	e1 = _mm256_mul_epu32(e, w_10[1][2]);
	f1 = _mm256_mul_epu32(f, w_10[1][3]);
	g1 = _mm256_mul_epu32(g, w_10[1][4]);
	h1 = _mm256_mul_epu32(h, w_10[1][5]);
	i1 = _mm256_mul_epu32(i, w_10[1][6]);
	j1 = _mm256_mul_epu32(j, w_10[1][7]);
	k1 = _mm256_mul_epu32(k, w_10[1][8]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	t = _mm256_add_epi64(t, k1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 2 + n2), t);
	a[N2_2560 * 2 + n2] %= Q;
	a[N2_2560 * 2 + n2 + 1] %= Q;
	a[N2_2560 * 2 + n2 + 2] %= Q;
	a[N2_2560 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[2][0]);
	d1 = _mm256_mul_epu32(d, w_10[2][1]);
	e1 = _mm256_mul_epu32(e, w_10[2][2]);
	f1 = _mm256_mul_epu32(f, w_10[2][3]);
	g1 = _mm256_mul_epu32(g, w_10[2][4]);
	h1 = _mm256_mul_epu32(h, w_10[2][5]);
	i1 = _mm256_mul_epu32(i, w_10[2][6]);
	j1 = _mm256_mul_epu32(j, w_10[2][7]);
	k1 = _mm256_mul_epu32(k, w_10[2][8]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	t = _mm256_add_epi64(t, k1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 3 + n2), t);
	a[N2_2560 * 3 + n2] %= Q;
	a[N2_2560 * 3 + n2 + 1] %= Q;
	a[N2_2560 * 3 + n2 + 2] %= Q;
	a[N2_2560 * 3 + n2 + 3] %= Q;
}

/* 256 * 3 --> 256 * 9 */
static void ntt_butterfly_768_2304(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_2304 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 2 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_9[0][0]);
	d1 = _mm256_mul_epu32(d, w_9[0][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 + n2), t);
	a[N2_2304 + n2] %= Q;
	a[N2_2304 + n2 + 1] %= Q;
	a[N2_2304 + n2 + 2] %= Q;
	a[N2_2304 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[1][0]);
	d1 = _mm256_mul_epu32(d, w_9[1][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 2 + n2), t);
	a[N2_2304 * 2 + n2] %= Q;
	a[N2_2304 * 2 + n2 + 1] %= Q;
	a[N2_2304 * 2 + n2 + 2] %= Q;
	a[N2_2304 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[2][0]);
	d1 = _mm256_mul_epu32(d, w_9[2][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 3 + n2), t);
	a[N2_2304 * 3 + n2] %= Q;
	a[N2_2304 * 3 + n2 + 1] %= Q;
	a[N2_2304 * 3 + n2 + 2] %= Q;
	a[N2_2304 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[3][0]);
	d1 = _mm256_mul_epu32(d, w_9[3][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 4 + n2), t);
	a[N2_2304 * 4 + n2] %= Q;
	a[N2_2304 * 4 + n2 + 1] %= Q;
	a[N2_2304 * 4 + n2 + 2] %= Q;
	a[N2_2304 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[4][0]);
	d1 = _mm256_mul_epu32(d, w_9[4][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 5 + n2), t);
	a[N2_2304 * 5 + n2] %= Q;
	a[N2_2304 * 5 + n2 + 1] %= Q;
	a[N2_2304 * 5 + n2 + 2] %= Q;
	a[N2_2304 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[5][0]);
	d1 = _mm256_mul_epu32(d, w_9[5][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 6 + n2), t);
	a[N2_2304 * 6 + n2] %= Q;
	a[N2_2304 * 6 + n2 + 1] %= Q;
	a[N2_2304 * 6 + n2 + 2] %= Q;
	a[N2_2304 * 6 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[6][0]);
	d1 = _mm256_mul_epu32(d, w_9[6][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 7 + n2), t);
	a[N2_2304 * 7 + n2] %= Q;
	a[N2_2304 * 7 + n2 + 1] %= Q;
	a[N2_2304 * 7 + n2 + 2] %= Q;
	a[N2_2304 * 7 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[7][0]);
	d1 = _mm256_mul_epu32(d, w_9[7][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 8 + n2), t);
	a[N2_2304 * 8 + n2] %= Q;
	a[N2_2304 * 8 + n2 + 1] %= Q;
	a[N2_2304 * 8 + n2 + 2] %= Q;
	a[N2_2304 * 8 + n2 + 3] %= Q;
}

/* 256 * 6 --> 256 * 9 */
static void ntt_butterfly_1536_2304(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, c1, d1, e1, f1, g1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_2304 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 5 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_9[0][0]);
	d1 = _mm256_mul_epu32(d, w_9[0][1]);
	e1 = _mm256_mul_epu32(e, w_9[0][2]);
	f1 = _mm256_mul_epu32(f, w_9[0][3]);
	g1 = _mm256_mul_epu32(g, w_9[0][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 + n2), t);
	a[N2_2304 + n2] %= Q;
	a[N2_2304 + n2 + 1] %= Q;
	a[N2_2304 + n2 + 2] %= Q;
	a[N2_2304 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_9[1][0]);
	d1 = _mm256_mul_epu32(d, w_9[1][1]);
	e1 = _mm256_mul_epu32(e, w_9[1][2]);
	f1 = _mm256_mul_epu32(f, w_9[1][3]);
	g1 = _mm256_mul_epu32(g, w_9[1][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 2 + n2), t);
	a[N2_2304 * 2 + n2] %= Q;
	a[N2_2304 * 2 + n2 + 1] %= Q;
	a[N2_2304 * 2 + n2 + 2] %= Q;
	a[N2_2304 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[2][0]);
	d1 = _mm256_mul_epu32(d, w_9[2][1]);
	e1 = _mm256_mul_epu32(e, w_9[2][2]);
	f1 = _mm256_mul_epu32(f, w_9[2][3]);
	g1 = _mm256_mul_epu32(g, w_9[2][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 3 + n2), t);
	a[N2_2304 * 3 + n2] %= Q;
	a[N2_2304 * 3 + n2 + 1] %= Q;
	a[N2_2304 * 3 + n2 + 2] %= Q;
	a[N2_2304 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[3][0]);
	d1 = _mm256_mul_epu32(d, w_9[3][1]);
	e1 = _mm256_mul_epu32(e, w_9[3][2]);
	f1 = _mm256_mul_epu32(f, w_9[3][3]);
	g1 = _mm256_mul_epu32(g, w_9[3][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 4 + n2), t);
	a[N2_2304 * 4 + n2] %= Q;
	a[N2_2304 * 4 + n2 + 1] %= Q;
	a[N2_2304 * 4 + n2 + 2] %= Q;
	a[N2_2304 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[4][0]);
	d1 = _mm256_mul_epu32(d, w_9[4][1]);
	e1 = _mm256_mul_epu32(e, w_9[4][2]);
	f1 = _mm256_mul_epu32(f, w_9[4][3]);
	g1 = _mm256_mul_epu32(g, w_9[4][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 5 + n2), t);
	a[N2_2304 * 5 + n2] %= Q;
	a[N2_2304 * 5 + n2 + 1] %= Q;
	a[N2_2304 * 5 + n2 + 2] %= Q;
	a[N2_2304 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[5][0]);
	d1 = _mm256_mul_epu32(d, w_9[5][1]);
	e1 = _mm256_mul_epu32(e, w_9[5][2]);
	f1 = _mm256_mul_epu32(f, w_9[5][3]);
	g1 = _mm256_mul_epu32(g, w_9[5][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 6 + n2), t);
	a[N2_2304 * 6 + n2] %= Q;
	a[N2_2304 * 6 + n2 + 1] %= Q;
	a[N2_2304 * 6 + n2 + 2] %= Q;
	a[N2_2304 * 6 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[6][0]);
	d1 = _mm256_mul_epu32(d, w_9[6][1]);
	e1 = _mm256_mul_epu32(e, w_9[6][2]);
	f1 = _mm256_mul_epu32(f, w_9[6][3]);
	g1 = _mm256_mul_epu32(g, w_9[6][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 7 + n2), t);
	a[N2_2304 * 7 + n2] %= Q;
	a[N2_2304 * 7 + n2 + 1] %= Q;
	a[N2_2304 * 7 + n2 + 2] %= Q;
	a[N2_2304 * 7 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9[7][0]);
	d1 = _mm256_mul_epu32(d, w_9[7][1]);
	e1 = _mm256_mul_epu32(e, w_9[7][2]);
	f1 = _mm256_mul_epu32(f, w_9[7][3]);
	g1 = _mm256_mul_epu32(g, w_9[7][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 8 + n2), t);
	a[N2_2304 * 8 + n2] %= Q;
	a[N2_2304 * 8 + n2 + 1] %= Q;
	a[N2_2304 * 8 + n2 + 2] %= Q;
	a[N2_2304 * 8 + n2 + 3] %= Q;
}

/* 256 * 9 --> 256 * 9 */
static void ntt_butterfly_2304_2304_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, i, j, c1, d1, e1, f1, g1, h1, i1, j1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_2304 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 5 + n2));
	h = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 6 + n2));
	i = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 7 + n2));
	j = _mm256_loadu_si256((__m256i *)(a + N2_2304 * 8 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);
	t = _mm256_add_epi64(t, i);
	t = _mm256_add_epi64(t, j);
	t1 = _mm256_mul_epu32(t, V_B32Q_B32Q_B32Q_B32Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_32Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_9_inv[0][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[0][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[0][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[0][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[0][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[0][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[0][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[0][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 + n2), t);
	a[N2_2304 + n2] %= Q;
	a[N2_2304 + n2 + 1] %= Q;
	a[N2_2304 + n2 + 2] %= Q;
	a[N2_2304 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_9_inv[1][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[1][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[1][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[1][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[1][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[1][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[1][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[1][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 2 + n2), t);
	a[N2_2304 * 2 + n2] %= Q;
	a[N2_2304 * 2 + n2 + 1] %= Q;
	a[N2_2304 * 2 + n2 + 2] %= Q;
	a[N2_2304 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9_inv[2][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[2][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[2][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[2][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[2][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[2][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[2][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[2][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 3 + n2), t);
	a[N2_2304 * 3 + n2] %= Q;
	a[N2_2304 * 3 + n2 + 1] %= Q;
	a[N2_2304 * 3 + n2 + 2] %= Q;
	a[N2_2304 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9_inv[3][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[3][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[3][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[3][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[3][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[3][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[3][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[3][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 4 + n2), t);
	a[N2_2304 * 4 + n2] %= Q;
	a[N2_2304 * 4 + n2 + 1] %= Q;
	a[N2_2304 * 4 + n2 + 2] %= Q;
	a[N2_2304 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9_inv[4][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[4][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[4][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[4][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[4][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[4][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[4][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[4][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 5 + n2), t);
	a[N2_2304 * 5 + n2] %= Q;
	a[N2_2304 * 5 + n2 + 1] %= Q;
	a[N2_2304 * 5 + n2 + 2] %= Q;
	a[N2_2304 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9_inv[5][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[5][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[5][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[5][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[5][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[5][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[5][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[5][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 6 + n2), t);
	a[N2_2304 * 6 + n2] %= Q;
	a[N2_2304 * 6 + n2 + 1] %= Q;
	a[N2_2304 * 6 + n2 + 2] %= Q;
	a[N2_2304 * 6 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9_inv[6][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[6][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[6][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[6][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[6][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[6][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[6][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[6][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 7 + n2), t);
	a[N2_2304 * 7 + n2] %= Q;
	a[N2_2304 * 7 + n2 + 1] %= Q;
	a[N2_2304 * 7 + n2 + 2] %= Q;
	a[N2_2304 * 7 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_9_inv[7][0]);
	d1 = _mm256_mul_epu32(d, w_9_inv[7][1]);
	e1 = _mm256_mul_epu32(e, w_9_inv[7][2]);
	f1 = _mm256_mul_epu32(f, w_9_inv[7][3]);
	g1 = _mm256_mul_epu32(g, w_9_inv[7][4]);
	h1 = _mm256_mul_epu32(h, w_9_inv[7][5]);
	i1 = _mm256_mul_epu32(i, w_9_inv[7][6]);
	j1 = _mm256_mul_epu32(j, w_9_inv[7][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2304 * 8 + n2), t);
	a[N2_2304 * 8 + n2] %= Q;
	a[N2_2304 * 8 + n2 + 1] %= Q;
	a[N2_2304 * 8 + n2 + 2] %= Q;
	a[N2_2304 * 8 + n2 + 3] %= Q;
}

/* 256 * 4 --> 256 * 4 */
static void ntt_butterfly_1024_1024_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 3 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_4_inv[0][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[0][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	a[N2_1024 + n2] %= Q;
	a[N2_1024 + n2 + 1] %= Q;
	a[N2_1024 + n2 + 2] %= Q;
	a[N2_1024 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_4_inv[1][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[1][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	a[N2_1024 * 2 + n2] %= Q;
	a[N2_1024 * 2 + n2 + 1] %= Q;
	a[N2_1024 * 2 + n2 + 2] %= Q;
	a[N2_1024 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4_inv[2][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[2][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
	a[N2_1024 * 3 + n2] %= Q;
	a[N2_1024 * 3 + n2 + 1] %= Q;
	a[N2_1024 * 3 + n2 + 2] %= Q;
	a[N2_1024 * 3 + n2 + 3] %= Q;
}

/* 256 * 3 --> 256 * 4 */
static void ntt_butterfly_768_1024(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_4[0][0]);
	d1 = _mm256_mul_epu32(d, w_4[0][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	a[N2_1024 + n2] %= Q;
	a[N2_1024 + n2 + 1] %= Q;
	a[N2_1024 + n2 + 2] %= Q;
	a[N2_1024 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_4[1][0]);
	d1 = _mm256_mul_epu32(d, w_4[1][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	a[N2_1024 * 2 + n2] %= Q;
	a[N2_1024 * 2 + n2 + 1] %= Q;
	a[N2_1024 * 2 + n2 + 2] %= Q;
	a[N2_1024 * 2 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_4[2][0]);
	d1 = _mm256_mul_epu32(d, w_4[2][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
	a[N2_1024 * 3 + n2] %= Q;
	a[N2_1024 * 3 + n2 + 1] %= Q;
	a[N2_1024 * 3 + n2 + 2] %= Q;
	a[N2_1024 * 3 + n2 + 3] %= Q;
}

/* 256 * 4 --> 256 * 1 */
static void ntt_butterfly_1024_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 3 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

/* 256 * 9 --> 256 * 10 */
static void ntt_butterfly_2304_2560(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, i, j, c1, d1, e1, f1, g1, h1, i1, j1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));	
	c = _mm256_loadu_si256((__m256i *)(a + N2_2560 + n2));	
	d = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 2 + n2));	
	e = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 3 + n2));	
	f = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 4 + n2));	
	g = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 5 + n2));	
	h = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 6 + n2));	
	i = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 7 + n2));	
	j = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 8 + n2));	
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);
	t = _mm256_add_epi64(t, i);
	t = _mm256_add_epi64(t, j);
	t1 = _mm256_mul_epu32(t, V_B32Q_B32Q_B32Q_B32Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_32Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_10[0][0]);
	d1 = _mm256_mul_epu32(d, w_10[0][1]);
	e1 = _mm256_mul_epu32(e, w_10[0][2]);
	f1 = _mm256_mul_epu32(f, w_10[0][3]);
	g1 = _mm256_mul_epu32(g, w_10[0][4]);
	h1 = _mm256_mul_epu32(h, w_10[0][5]);
	i1 = _mm256_mul_epu32(i, w_10[0][6]);
	j1 = _mm256_mul_epu32(j, w_10[0][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 + n2), t);
	a[N2_2560 + n2] %= Q;
	a[N2_2560 + n2 + 1] %= Q;
	a[N2_2560 + n2 + 2] %= Q;
	a[N2_2560 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[1][0]);
	d1 = _mm256_mul_epu32(d, w_10[1][1]);
	e1 = _mm256_mul_epu32(e, w_10[1][2]);
	f1 = _mm256_mul_epu32(f, w_10[1][3]);
	g1 = _mm256_mul_epu32(g, w_10[1][4]);
	h1 = _mm256_mul_epu32(h, w_10[1][5]);
	i1 = _mm256_mul_epu32(i, w_10[1][6]);
	j1 = _mm256_mul_epu32(j, w_10[1][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 2 + n2), t);
	a[N2_2560 * 2 + n2] %= Q;
	a[N2_2560 * 2 + n2 + 1] %= Q;
	a[N2_2560 * 2 + n2 + 2] %= Q;
	a[N2_2560 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[2][0]);
	d1 = _mm256_mul_epu32(d, w_10[2][1]);
	e1 = _mm256_mul_epu32(e, w_10[2][2]);
	f1 = _mm256_mul_epu32(f, w_10[2][3]);
	g1 = _mm256_mul_epu32(g, w_10[2][4]);
	h1 = _mm256_mul_epu32(h, w_10[2][5]);
	i1 = _mm256_mul_epu32(i, w_10[2][6]);
	j1 = _mm256_mul_epu32(j, w_10[2][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 3 + n2), t);
	a[N2_2560 * 3 + n2] %= Q;
	a[N2_2560 * 3 + n2 + 1] %= Q;
	a[N2_2560 * 3 + n2 + 2] %= Q;
	a[N2_2560 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[3][0]);
	d1 = _mm256_mul_epu32(d, w_10[3][1]);
	e1 = _mm256_mul_epu32(e, w_10[3][2]);
	f1 = _mm256_mul_epu32(f, w_10[3][3]);
	g1 = _mm256_mul_epu32(g, w_10[3][4]);
	h1 = _mm256_mul_epu32(h, w_10[3][5]);
	i1 = _mm256_mul_epu32(i, w_10[3][6]);
	j1 = _mm256_mul_epu32(j, w_10[3][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 4 + n2), t);
	a[N2_2560 * 4 + n2] %= Q;
	a[N2_2560 * 4 + n2 + 1] %= Q;
	a[N2_2560 * 4 + n2 + 2] %= Q;
	a[N2_2560 * 4 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_10[4][0]);
	d1 = _mm256_mul_epu32(d, w_10[4][1]);
	e1 = _mm256_mul_epu32(e, w_10[4][2]);
	f1 = _mm256_mul_epu32(f, w_10[4][3]);
	g1 = _mm256_mul_epu32(g, w_10[4][4]);
	h1 = _mm256_mul_epu32(h, w_10[4][5]);
	i1 = _mm256_mul_epu32(i, w_10[4][6]);
	j1 = _mm256_mul_epu32(j, w_10[4][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 5 + n2), t);
	a[N2_2560 * 5 + n2] %= Q;
	a[N2_2560 * 5 + n2 + 1] %= Q;
	a[N2_2560 * 5 + n2 + 2] %= Q;
	a[N2_2560 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[5][0]);
	d1 = _mm256_mul_epu32(d, w_10[5][1]);
	e1 = _mm256_mul_epu32(e, w_10[5][2]);
	f1 = _mm256_mul_epu32(f, w_10[5][3]);
	g1 = _mm256_mul_epu32(g, w_10[5][4]);
	h1 = _mm256_mul_epu32(h, w_10[5][5]);
	i1 = _mm256_mul_epu32(i, w_10[5][6]);
	j1 = _mm256_mul_epu32(j, w_10[5][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 6 + n2), t);
	a[N2_2560 * 6 + n2] %= Q;
	a[N2_2560 * 6 + n2 + 1] %= Q;
	a[N2_2560 * 6 + n2 + 2] %= Q;
	a[N2_2560 * 6 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_10[6][0]);
	d1 = _mm256_mul_epu32(d, w_10[6][1]);
	e1 = _mm256_mul_epu32(e, w_10[6][2]);
	f1 = _mm256_mul_epu32(f, w_10[6][3]);
	g1 = _mm256_mul_epu32(g, w_10[6][4]);
	h1 = _mm256_mul_epu32(h, w_10[6][5]);
	i1 = _mm256_mul_epu32(i, w_10[6][6]);
	j1 = _mm256_mul_epu32(j, w_10[6][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 7 + n2), t);
	a[N2_2560 * 7 + n2] %= Q;
	a[N2_2560 * 7 + n2 + 1] %= Q;
	a[N2_2560 * 7 + n2 + 2] %= Q;
	a[N2_2560 * 7 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_10[7][0]);
	d1 = _mm256_mul_epu32(d, w_10[7][1]);
	e1 = _mm256_mul_epu32(e, w_10[7][2]);
	f1 = _mm256_mul_epu32(f, w_10[7][3]);
	g1 = _mm256_mul_epu32(g, w_10[7][4]);
	h1 = _mm256_mul_epu32(h, w_10[7][5]);
	i1 = _mm256_mul_epu32(i, w_10[7][6]);
	j1 = _mm256_mul_epu32(j, w_10[7][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 8 + n2), t);
	a[N2_2560 * 8 + n2] %= Q;
	a[N2_2560 * 8 + n2 + 1] %= Q;
	a[N2_2560 * 8 + n2 + 2] %= Q;
	a[N2_2560 * 8 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_10[8][0]);
	d1 = _mm256_mul_epu32(d, w_10[8][1]);
	e1 = _mm256_mul_epu32(e, w_10[8][2]);
	f1 = _mm256_mul_epu32(f, w_10[8][3]);
	g1 = _mm256_mul_epu32(g, w_10[8][4]);
	h1 = _mm256_mul_epu32(h, w_10[8][5]);
	i1 = _mm256_mul_epu32(i, w_10[8][6]);
	j1 = _mm256_mul_epu32(j, w_10[8][7]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	t = _mm256_add_epi64(t, i1);
	t = _mm256_add_epi64(t, j1);
	_mm256_storeu_si256((__m256i *)(a + N2_2560 * 9 + n2), t);
	a[N2_2560 * 9 + n2] %= Q;
	a[N2_2560 * 9 + n2 + 1] %= Q;
	a[N2_2560 * 9 + n2 + 2] %= Q;
	a[N2_2560 * 9 + n2 + 3] %= Q;
}

/* 256 * 10 --> 256 * 1 */
static void ntt_butterfly_2560_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, i, j, k, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));	
	c = _mm256_loadu_si256((__m256i *)(a + N2_2560 + n2));	
	d = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 2 + n2));	
	e = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 3 + n2));	
	f = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 4 + n2));	
	g = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 5 + n2));	
	h = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 6 + n2));	
	i = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 7 + n2));	
	j = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 8 + n2));	
	k = _mm256_loadu_si256((__m256i *)(a + N2_2560 * 9 + n2));	
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);
	t = _mm256_add_epi64(t, i);
	t = _mm256_add_epi64(t, j);
	t = _mm256_add_epi64(t, k);
	t1 = _mm256_mul_epu32(t, V_B32Q_B32Q_B32Q_B32Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_32Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

void ntt_1536_2560(uint64_t *a)
{
	ntt_core(a, N1_2560, N2_2560, omega_256, omega_2560, ntt_butterfly_1536_2560);
}

void intt_2560_1024(uint64_t *a)
{
	intt_core(a, N1_2560, N2_2560, 1024, omega_256, omega_2560, ntt_butterfly_2560_1024, INV_2560);
}

void ntt_768_2304(uint64_t *a)
{
	ntt_core(a, N1_2304, N2_2304, omega_256, omega_2304, ntt_butterfly_768_2304);
}

void ntt_1536_2304(uint64_t *a)
{
	ntt_core(a, N1_2304, N2_2304, omega_256, omega_2304, ntt_butterfly_1536_2304);
}

void intt_2304_2304_inv(uint64_t *a)
{
	intt_core(a, N1_2304, N2_2304, 2304, omega_256_inv, omega_2304_inv, ntt_butterfly_2304_2304_inv, INV_2304);
}

void ntt_1024_1024_inv(uint64_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256_inv, omega_1024_inv, ntt_butterfly_1024_1024_inv);
}

void ntt_768_1024(uint64_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_768_1024);
}

void intt_1024_256(uint64_t *a)
{
	intt_core(a, N1_1024, N2_1024, 256, omega_256, omega_1024, ntt_butterfly_1024_256, INV_1024);
}

void ntt_2304_2560(uint64_t *a)
{
	ntt_core(a, N1_2560, N2_2560, omega_256, omega_2560, ntt_butterfly_2304_2560);
}

void intt_2560_256(uint64_t *a)
{
	intt_core(a, N1_2560, N2_2560, 256, omega_256, omega_2560, ntt_butterfly_2560_256, INV_2560);
}
