/* ****************************** *
 * Titanium_CPA_lite              *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>

/* 768=3*256 */
#define N1_768 3
#define N2_768 256

/* 1280=5*256 */
#define N1_1280 5
#define N2_1280 256

/* 1536=6*256 */
#define N1_1536 6
#define N2_1536 256

/* multiplication inverses of 768, 1280, 1536 */
#define INV_768 84371
#define INV_1280 84415
#define INV_1536 84426

/* omega_n: n-th root of unity mod Q */
static const uint32_t w_3[2]={7706,76774};

static const uint32_t w_5[4][4]={{42831,74127,53076,83408},
{74127,83408,42831,53076},
{53076,42831,83408,74127},
{83408,53076,74127,42831}};

static const uint32_t w_6[5][5]={{7707,7706,84480,76774,76775},
{7706,76774,1,7706,76774},
{84480,1,84480,1,84480},
{76774,7706,1,76774,7706},
{76775,76774,84480,7706,7707}};

/* omega_256,768,1280,1536, respectively */
static const uint32_t omega_256[128]={1,301,6120,68019,29317,38393,66877,23499,61276,27218,82442,62109,24508,27061,35185,30560,74612,70747,5635,6515,17952,81249,40940,73195,66635,35138,16413,40415,84132,63913,60626,530,75049,33322,61164,77987,72850,47271,35763,35576,63770,17583,54661,63647,65041,62230,60929,7252,70827,29715,73710,52688,61141,71064,16571,3492,37320,81828,46257,68473,81490,29000,27457,69900,4131,60697,21901,2683,47254,30646,16017,5700,26080,77828,24991,3482,34310,20628,41915,28746,35484,36078,45910,48507,69875,81087,76659,11046,30087,16720,48341,19909,78939,21478,44322,77405,66630,33633,70294,38244,22028,40910,64165,51997,22112,66194,71359,20885,34791,80928,28800,51738,28634,1772,26486,31072,59762,78390,25191,63682,75576,22987,76126,19575,62886,4942,51365,842};
static const uint32_t omega_768[768]={1,32904,49201,301,19827,25326,6120,54257,19836,68019,26524,56966,29317,42510,81604,38393,38879,63314,66877,44201,49289,23499,40984,51814,61276,1958,51510,27218,82472,44487,82442,71139,42589,62109,39146,62658,24508,40087,20795,27061,69885,7701,35185,84097,37014,30560,53378,74203,74612,15388,32119,70747,69814,36985,5635,62726,65474,6515,41263,23601,17952,1456,7497,81249,15851,60091,40940,40215,8457,73195,23932,11127,66635,22647,54468,35138,58267,5554,16413,50800,66615,40415,84220,29118,84132,5920,62975,63913,7819,31731,60626,72532,4678,530,36034,56382,75049,32666,74782,33322,32670,37436,61164,33874,32263,77987,58354,80329,72850,76987,17463,47271,25293,18541,35763,9903,5095,35576,23968,12937,63770,33483,7911,17583,25144,15743,54661,49535,7707,63647,41379,38820,65041,36372,26442,62230,49923,17828,60929,73686,43925,7252,45464,42389,70827,83223,2458,29715,43747,64010,73710,73292,5342,52688,11351,2803,61141,37411,83374,71064,24738,4717,16571,11810,68121,3492,6608,60019,37320,45945,71266,81828,59042,77373,46257,30632,56998,68473,11803,6755,81490,4501,5711,29000,3105,29391,27457,5314,60667,69900,78856,12871,4131,80976,72526,60697,43248,34228,21901,7574,80427,2683,83268,46961,47254,57292,26934,30646,10768,81439,16017,30890,13649,5700,4980,53261,26080,62803,64652,77828,64440,29622,24991,50291,45717,3482,15492,74895,34310,16637,71449,20628,23358,47975,41915,18835,78705,28746,9108,35525,35484,38116,48419,36078,67981,43387,45910,17879,49413,48507,59276,4657,69875,16585,50061,81087,7706,30743,76659,38519,45214,11046,20322,7973,30087,34290,34405,16720,14608,49223,48341,3996,31948,19909,20062,69995,78939,40511,32726,21478,28547,50730,44322,60066,63150,77405,932,84406,66630,27089,61906,33633,43613,47886,70294,32958,51916,38244,36081,82212,22028,46813,77360,40910,66867,53085,64165,20489,11676,51997,76,50755,22112,22876,70675,66194,42715,68444,71359,16103,72761,20885,31586,20482,34791,45514,82450,80928,13792,64517,28800,11823,73468,51738,10521,64327,28634,41024,16278,1772,13998,84261,26486,73829,18261,31072,4026,5296,59762,29092,73438,78390,55149,55297,25191,41573,1640,63682,10285,71235,75576,54469,68042,22987,5855,36240,76126,72735,10191,19575,12656,26175,62886,7811,21942,4942,70124,15024,51365,71555,44731,842,79881,31552,84480,51577,35280,84180,64654,59155,78361,30224,64645,16462,57957,27515,55164,41971,2877,46088,45602,21167,17604,40280,35192,60982,43497,32667,23205,82523,32971,57263,2009,39994,2039,13342,41892,22372,45335,21823,59973,44394,63686,57420,14596,76780,49296,384,47467,53921,31103,10278,9869,69093,52362,13734,14667,47496,78846,21755,19007,77966,43218,60880,66529,83025,76984,3232,68630,24390,43541,44266,76024,11286,60549,73354,17846,61834,30013,49343,26214,78927,68068,33681,17866,44066,261,55363,349,78561,21506,20568,76662,52750,23855,11949,79803,83951,48447,28099,9432,51815,9699,51159,51811,47045,23317,50607,52218,6494,26127,4152,11631,7494,67018,37210,59188,65940,48718,74578,79386,48905,60513,71544,20711,50998,76570,66898,59337,68738,29820,34946,76774,20834,43102,45661,19440,48109,58039,22251,34558,66653,23552,10795,40556,77229,39017,42092,13654,1258,82023,54766,40734,20471,10771,11189,79139,31793,73130,81678,23340,47070,1107,13417,59743,79764,67910,72671,16360,80989,77873,24462,47161,38536,13215,2653,25439,7108,38224,53849,27483,16008,72678,77726,2991,79980,78770,55481,81376,55090,57024,79167,23814,14581,5625,71610,80350,3505,11955,23784,41233,50253,62580,76907,4054,81798,1213,37520,37227,27189,57547,53835,73713,3042,68464,53591,70832,78781,79501,31220,58401,21678,19829,6653,20041,54859,59490,34190,38764,80999,68989,9586,50171,67844,13032,63853,61123,36506,42566,65646,5776,55735,75373,48956,48997,46365,36062,48403,16500,41094,38571,66602,35068,35974,25205,79824,14606,67896,34420,3394,76775,53738,7822,45962,39267,73435,64159,76508,54394,50191,50076,67761,69873,35258,36140,80485,52533,64572,64419,14486,5542,43970,51755,63003,55934,33751,40159,24415,21331,7076,83549,75,17851,57392,22575,50848,40868,36595,14187,51523,32565,46237,48400,2269,62453,37668,7121,43571,17614,31396,20316,63992,72805,32484,84405,33726,62369,61605,13806,18287,41766,16037,13122,68378,11720,63596,52895,63999,49690,38967,2031,3553,70689,19964,55681,72658,11013,32743,73960,20154,55847,43457,68203,82709,70483,220,57995,10652,66220,53409,80455,79185,24719,55389,11043,6091,29332,29184,59290,42908,82841,20799,74196,13246,8905,30012,16439,61494,78626,48241,8355,11746,74290,64906,71825,58306,21595,76670,62539,79539,14357,69457,33116,12926,39750,83639,4600,52929};
static const uint32_t omega_1280[1280]={1,68911,48911,51945,37444,301,44366,22517,6460,34671,6120,6168,19137,1397,44808,68019,82467,15529,82573,54729,29317,69634,27774,17059,84115,38393,8546,80836,65899,58796,66877,37916,1108,67045,41067,23499,7781,80065,74067,26941,61276,61094,22480,75664,83546,27218,56917,8000,49475,56489,82442,66855,42532,23319,22508,62109,16877,45501,7096,16428,24508,11117,9879,23871,44930,27061,51458,16744,4286,6970,35185,28835,55565,22871,70426,30560,62273,82308,41210,77976,74612,73872,21775,69984,69539,70747,16969,49238,29415,64432,5635,38809,36463,67891,47883,6515,23131,77314,75270,51013,17952,34989,39239,15362,63852,81249,56045,68080,61988,42265,40940,57826,47678,72568,49615,73195,2540,73789,46870,65459,66635,4211,76467,84024,19086,35138,296,37735,31405,178,16413,4615,37781,75514,53578,40415,37419,51627,4325,75588,84132,27146,79704,34610,26599,63913,60770,82781,26447,65085,60626,43874,79667,19333,75474,530,27038,71644,74525,76766,75049,28262,22189,44560,43253,33322,58762,4890,64562,9079,61164,30833,35713,2532,29387,77987,72304,20526,1803,59463,72850,51887,11213,35817,72872,47271,73483,80354,51830,53893,35763,68842,24988,56326,1441,35576,23597,2579,57926,11336,63770,6293,15950,32640,32896,17583,35611,70014,24844,17419,54661,74305,38445,43716,5297,63647,62821,82529,63961,73739,65041,69858,3815,75074,61417,62230,75970,50062,40847,69659,60929,57100,31044,45202,16071,7252,37457,51334,4361,21954,70827,38584,75992,45446,18636,29715,39887,63722,77805,33690,73710,9685,3135,18068,2970,52688,42831,14344,31684,49160,61141,51019,9013,75012,12985,71064,65658,9521,22185,22359,16571,78985,77948,3686,56060,3492,35324,61111,11233,62341,37320,72399,62034,1893,9859,81828,80482,1933,62907,10724,46257,63516,74947,11263,17646,68473,25610,2620,10923,73624,81490,20839,28291,77545,26802,29000,20945,67491,24289,41707,27457,52851,39351,45623,50619,69900,25723,17311,46601,29739,4131,54852,57270,3055,80934,60697,36657,4146,74745,30606,21901,51227,65212,26299,3977,2683,43785,29220,59266,14343,47254,249,9196,13575,8712,30646,74949,64604,30987,3401,16017,3222,15174,34177,9929,5700,40531,5400,65076,31794,26080,34567,20261,72765,23641,77828,13504,15929,21686,19537,24991,9616,63693,22449,51448,3482,22062,78887,83150,25825,34310,51144,5826,21774,1073,20628,18802,64006,48937,69530,41915,83656,4138,30343,61723,28746,5118,62804,9295,77284,35484,19860,64741,9922,30209,36078,64190,56411,29687,53442,45910,59522,83511,65282,34652,48507,6150,45954,50290,39089,69875,77049,61751,15191,22930,81087,43955,1231,10517,58969,76659,51419,32607,39820,8659,11046,17096,14911,73999,71929,30087,77036,10718,55196,23493,16720,40042,15840,55720,59470,48341,56340,36904,44482,74979,19909,62140,41093,41084,12252,78939,33839,34767,32058,55169,21478,47819,73704,18624,47593,44322,31749,50882,30078,48204,77405,10096,24421,14011,63153,66630,82061,874,77742,828,33633,31909,9631,83586,80266,70294,58256,26577,68529,82981,38244,47489,58463,13865,55386,22028,16900,25315,33796,28429,40910,18040,16525,34876,24548,64165,23256,74127,22032,39101,51997,72614,9243,42114,26542,22112,60716,78751,4164,47928,66194,27620,49371,70630,64558,71359,34482,76496,54899,1328,20885,72400,46464,50804,61804,34791,80783,46299,943,17184,80928,69636,81115,30400,19043,28800,9148,606,26452,71716,51738,50156,13444,20838,43861,28634,59338,76037,20644,23125,1772,35247,77267,46731,33183,26486,49222,25092,42185,19325,31072,31647,33883,25535,72117,59762,63875,61063,82745,80081,78390,49188,47586,68831,27296,25191,21413,46097,20286,21439,63682,24757,20313,23454,32583,75576,17529,31581,47731,7687,22987,38407,44009,5261,32800,76126,71091,67673,62903,73004,19575,24698,9652,10059,9144,62886,84251,32898,70924,48952,4942,15251,18021,58912,34858,51365,28577,17537,75983,16614,842,69096,40815,61013,16435,84480,15570,35570,32536,47037,84180,40115,61964,78021,49810,78361,78313,65344,83084,39673,16462,2014,68952,1908,29752,55164,14847,56707,67422,366,46088,75935,3645,18582,25685,17604,46565,83373,17436,43414,60982,76700,4416,10414,57540,23205,23387,62001,8817,935,57263,27564,76481,35006,27992,2039,17626,41949,61162,61973,22372,67604,38980,77385,68053,59973,73364,74602,60610,39551,57420,33023,67737,80195,77511,49296,55646,28916,61610,14055,53921,22208,2173,43271,6505,9869,10609,62706,14497,14942,13734,67512,35243,55066,20049,78846,45672,48018,16590,36598,77966,61350,7167,9211,33468,66529,49492,45242,69119,20629,3232,28436,16401,22493,42216,43541,26655,36803,11913,34866,11286,81941,10692,37611,19022,17846,80270,8014,457,65395,49343,84185,46746,53076,84303,68068,79866,46700,8967,30903,44066,47062,32854,80156,8893,349,57335,4777,49871,57882,20568,23711,1700,58034,19396,23855,40607,4814,65148,9007,83951,57443,12837,9956,7715,9432,56219,62292,39921,41228,51159,25719,79591,19919,75402,23317,53648,48768,81949,55094,6494,12177,63955,82678,25018,11631,32594,73268,48664,11609,37210,10998,4127,32651,30588,48718,15639,59493,28155,83040,48905,60884,81902,26555,73145,20711,78188,68531,51841,51585,66898,48870,14467,59637,67062,29820,10176,46036,40765,79184,20834,21660,1952,20520,10742,19440,14623,80666,9407,23064,22251,8511,34419,43634,14822,23552,27381,53437,39279,68410,77229,47024,33147,80120,62527,13654,45897,8489,39035,65845,54766,44594,20759,6676,50791,10771,74796,81346,66413,81511,31793,41650,70137,52797,35321,23340,33462,75468,9469,71496,13417,18823,74960,62296,62122,67910,5496,6533,80795,28421,80989,49157,23370,73248,22140,47161,12082,22447,82588,74622,2653,3999,82548,21574,73757,38224,20965,9534,73218,66835,16008,58871,81861,73558,10857,2991,63642,56190,6936,57679,55481,63536,16990,60192,42774,57024,31630,45130,38858,33862,14581,58758,67170,37880,54742,80350,29629,27211,81426,3547,23784,47824,80335,9736,53875,62580,33254,19269,58182,80504,81798,40696,55261,25215,70138,37227,84232,75285,70906,75769,53835,9532,19877,53494,81080,68464,81259,69307,50304,74552,78781,43950,79081,19405,52687,58401,49914,64220,11716,60840,6653,70977,68552,62795,64944,59490,74865,20788,62032,33033,80999,62419,5594,1331,58656,50171,33337,78655,62707,83408,63853,65679,20475,35544,14951,42566,825,80343,54138,22758,55735,79363,21677,75186,7197,48997,64621,19740,74559,54272,48403,20291,28070,54794,31039,38571,24959,970,19199,49829,35974,78331,38527,34191,45392,14606,7432,22730,69290,61551,3394,40526,83250,73964,25512,7822,33062,51874,44661,75822,73435,67385,69570,10482,12552,54394,7445,73763,29285,60988,67761,44439,68641,28761,25011,36140,28141,47577,39999,9502,64572,22341,43388,43397,72229,5542,50642,49714,52423,29312,63003,36662,10777,65857,36888,40159,52732,33599,54403,36277,7076,74385,60060,70470,21328,17851,2420,83607,6739,83653,50848,52572,74850,895,4215,14187,26225,57904,15952,1500,46237,36992,26018,70616,29095,62453,67581,59166,50685,56052,43571,66441,67956,49605,59933,20316,61225,10354,62449,45380,32484,11867,75238,42367,57939,62369,23765,5730,80317,36553,18287,56861,35110,13851,19923,13122,49999,7985,29582,83153,63596,12081,38017,33677,22677,49690,3698,38182,83538,67297,3553,14845,3366,54081,65438,55681,75333,83875,58029,12765,32743,34325,71037,63643,40620,55847,25143,8444,63837,61356,82709,49234,7214,37750,51298,57995,35259,59389,42296,65156,53409,52834,50598,58946,12364,24719,20606,23418,1736,4400,6091,35293,36895,15650,57185,59290,63068,38384,64195,63042,20799,59724,64168,61027,51898,8905,66952,52900,36750,76794,61494,46074,40472,79220,51681,8355,13390,16808,21578,11477,64906,59783,74829,74422,75337,21595,230,51583,13557,35529,79539,69230,66460,25569,49623,33116,55904,66944,8498,67867,83639,15385,43666,23468,68046};
static const uint32_t omega_1536[1536]={1,5170,32904,53427,49201,81360,301,35512,19827,30137,25326,74351,6120,44506,54257,31770,19836,76667,68019,48308,26524,16417,56966,13454,29317,9976,42510,41619,81604,79047,38393,45941,38879,24131,63314,53986,66877,57838,44201,82546,49289,29434,23499,6152,40984,8932,51814,73610,61276,77651,1958,69621,51510,22588,27218,56195,82472,4633,44487,40508,82442,18495,71139,42837,42589,27644,62109,75730,39146,52825,62658,41706,24508,69341,40087,17897,20795,50318,27061,4834,69885,64694,7701,23619,35185,18857,84097,42264,37014,12915,30560,15730,53378,49314,74203,1289,74612,3794,15388,59339,32119,50065,70747,43741,69814,35548,36985,31947,5635,71486,62726,55342,65474,69694,6515,59112,41263,15185,23601,26606,17952,51702,1456,8711,7497,67192,81249,17798,15851,3100,60091,33833,40940,34895,40215,3809,8457,46013,73195,27751,23932,48256,11127,79510,66635,73913,22647,78805,54468,24387,35138,29310,58267,65625,5554,75121,16413,36286,50800,69052,66615,54994,40415,24037,84220,2326,29118,79399,84132,54252,5920,24278,62975,75457,63913,25019,7819,42312,31731,71649,60626,11910,72532,63762,4678,23694,530,36708,36034,15175,56382,35490,75049,66578,32666,5701,74782,37884,33322,17981,32670,26381,37436,82630,61164,5497,33874,83948,32263,34216,77987,49458,58354,8529,80329,76815,72850,18202,76987,32799,17463,58002,47271,72018,25293,72703,18541,55516,35763,50282,9903,3024,5095,67559,35576,12783,23968,65414,12937,59819,63770,46038,33483,5541,7911,11066,17583,2554,25144,62702,15743,36107,54661,8425,49535,34039,7707,54639,63647,1495,41379,23538,38820,57025,65041,27590,36372,73015,26442,14882,62230,25452,49923,12455,17828,1989,60929,57762,73686,31791,43925,7322,7252,67757,45464,22738,42389,7416,70827,34936,83223,1177,2458,35710,29715,40092,43747,16353,64010,19623,73710,71390,73292,22355,5342,77334,52688,30216,11351,54856,2803,45259,61141,55549,37411,37861,83374,21518,71064,77492,24738,75707,4717,56362,16571,8336,11810,62418,68121,68762,3492,59187,6608,33036,60019,83998,37320,74277,45945,59559,71266,23579,81828,54393,59042,17287,77373,875,46257,67460,30632,50046,56998,9932,68473,30020,11803,26228,6755,32697,81490,81034,4501,37895,5711,42001,29000,60706,3105,1460,29391,54632,27457,24610,5314,17055,60667,54918,69900,57763,78856,64695,12871,56523,4131,68058,80976,42565,72526,32742,60697,41056,43248,55434,34228,55546,21901,23630,7574,42877,80427,76589,2683,16226,83268,64865,46961,74457,47254,68609,57292,9254,26934,24092,30646,37945,10768,82062,81439,70807,16017,16510,30890,32210,13649,23695,5700,69612,4980,64376,53261,35791,26080,1924,62803,31027,64652,44004,77828,72238,64440,46217,29622,66168,24991,32021,50291,56433,45717,63533,3482,7487,15492,5652,74895,30727,34310,57081,16637,11632,71449,40398,20628,31738,23358,37511,47975,79015,41915,6785,18835,54838,78705,44354,28746,14741,9108,32443,35525,2556,35484,44029,38116,50028,48419,9027,36078,73693,67981,20810,43387,13735,45910,47571,17879,12216,49413,79147,48507,41582,59276,44333,4657,84086,69875,12994,16585,80716,50061,50067,81087,25068,7706,49469,30743,32549,76659,26659,38519,21513,45214,81934,11046,83145,20322,54857,7973,78163,30087,20269,34290,38162,34405,41345,16720,18337,14608,81827,49223,26138,48341,28172,3996,45956,31948,10805,19909,31672,20062,62353,69995,42027,78939,71400,40511,13471,32726,62458,21478,33226,28547,84164,50730,45076,44322,32268,60066,73545,63150,50916,77405,81834,932,3023,84406,34655,66630,48063,27089,65113,61906,39992,33633,20712,43613,83902,47886,41290,70294,67199,32958,79164,51916,9583,38244,35940,36081,4722,82212,12129,22028,4372,46813,69626,77360,18146,40910,48757,66867,6138,53085,55162,64165,60644,20489,73437,11676,45486,51997,5948,76,54996,50755,5364,22112,16247,22876,80001,70675,9425,66194,74930,42715,3216,68444,49052,71359,81984,16103,38725,72761,64958,20885,8732,31586,82328,20482,37247,34791,9421,45514,27795,82450,59855,80928,47848,13792,2676,64517,21902,28800,40478,11823,45147,73468,2984,51738,18614,10521,72287,64327,53374,28634,27068,41024,46770,16278,14184,1772,37292,13998,53924,84261,45334,26486,73400,73829,10772,18261,44093,31072,43859,4026,32094,5296,8476,59762,22523,29092,29460,73438,16846,78390,20943,55149,81436,55297,1786,25191,52249,41573,12746,1640,30700,63682,13483,10285,34901,71235,32271,75576,3295,54469,29557,68042,82737,22987,62504,5855,26152,36240,66423,76126,58922,72735,15019,10191,55807,19575,78993,12656,43226,26175,70669,62886,37732,7811,952,21942,66638,4942,36878,70124,33109,15024,36041,51365,33267,71555,81532,44731,34773,842,44609,79881,41642,31552,75510,84480,79311,51577,31054,35280,3121,84180,48969,64654,54344,59155,10130,78361,39975,30224,52711,64645,7814,16462,36173,57957,68064,27515,71027,55164,74505,41971,42862,2877,5434,46088,38540,45602,60350,21167,30495,17604,26643,40280,1935,35192,55047,60982,78329,43497,75549,32667,10871,23205,6830,82523,14860,32971,61893,57263,28286,2009,79848,39994,43973,2039,65986,13342,41644,41892,56837,22372,8751,45335,31656,21823,42775,59973,15140,44394,66584,63686,34163,57420,79647,14596,19787,76780,60862,49296,65624,384,42217,47467,71566,53921,68751,31103,35167,10278,83192,9869,80687,69093,25142,52362,34416,13734,40740,14667,48933,47496,52534,78846,12995,21755,29139,19007,14787,77966,25369,43218,69296,60880,57875,66529,32779,83025,75770,76984,17289,3232,66683,68630,81381,24390,50648,43541,49586,44266,80672,76024,38468,11286,56730,60549,36225,73354,4971,17846,10568,61834,5676,30013,60094,49343,55171,26214,18856,78927,9360,68068,48195,33681,15429,17866,29487,44066,60444,261,82155,55363,5082,349,30229,78561,60203,21506,9024,20568,59462,76662,42169,52750,12832,23855,72571,11949,20719,79803,60787,83951,47773,48447,69306,28099,48991,9432,17903,51815,78780,9699,46597,51159,66500,51811,58100,47045,1851,23317,78984,50607,533,52218,50265,6494,35023,26127,75952,4152,7666,11631,66279,7494,51682,67018,26479,37210,12463,59188,11778,65940,28965,48718,34199,74578,81457,79386,16922,48905,71698,60513,19067,71544,24662,20711,38443,50998,78940,76570,73415,66898,81927,59337,21779,68738,48374,29820,76056,34946,50442,76774,29842,20834,82986,43102,60943,45661,27456,19440,56891,48109,11466,58039,69599,22251,59029,34558,72026,66653,82492,23552,26719,10795,52690,40556,77159,77229,16724,39017,61743,42092,77065,13654,49545,1258,83304,82023,48771,54766,44389,40734,68128,20471,64858,10771,13091,11189,62126,79139,7147,31793,54265,73130,29625,81678,39222,23340,28932,47070,46620,1107,62963,13417,6989,59743,8774,79764,28119,67910,76145,72671,22063,16360,15719,80989,25294,77873,51445,24462,483,47161,10204,38536,24922,13215,60902,2653,30088,25439,67194,7108,83606,38224,17021,53849,34435,27483,74549,16008,54461,72678,58253,77726,51784,2991,3447,79980,46586,78770,42480,55481,23775,81376,83021,55090,29849,57024,59871,79167,67426,23814,29563,14581,26718,5625,19786,71610,27958,80350,16423,3505,41916,11955,51739,23784,43425,41233,29047,50253,28935,62580,60851,76907,41604,4054,7892,81798,68255,1213,19616,37520,10024,37227,15872,27189,75227,57547,60389,53835,46536,73713,2419,3042,13674,68464,67971,53591,52271,70832,60786,78781,14869,79501,20105,31220,48690,58401,82557,21678,53454,19829,40477,6653,12243,20041,38264,54859,18313,59490,52460,34190,28048,38764,20948,80999,76994,68989,78829,9586,53754,50171,27400,67844,72849,13032,44083,63853,52743,61123,46970,36506,5466,42566,77696,65646,29643,5776,40127,55735,69740,75373,52038,48956,81925,48997,40452,46365,34453,36062,75454,48403,10788,16500,63671,41094,70746,38571,36910,66602,72265,35068,5334,35974,42899,25205,40148,79824,395,14606,71487,67896,3765,34420,34414,3394,59413,76775,35012,53738,51932,7822,57822,45962,62968,39267,2547,73435,1336,64159,29624,76508,6318,54394,64212,50191,46319,50076,43136,67761,66144,69873,2654,35258,58343,36140,56309,80485,38525,52533,73676,64572,52809,64419,22128,14486,42454,5542,13081,43970,71010,51755,22023,63003,51255,55934,317,33751,39405,40159,52213,24415,10936,21331,33565,7076,2647,83549,81458,75,49826,17851,36418,57392,19368,22575,44489,50848,63769,40868,579,36595,43191,14187,17282,51523,5317,32565,74898,46237,48541,48400,79759,2269,72352,62453,80109,37668,14855,7121,66335,43571,35724,17614,78343,31396,29319,20316,23837,63992,11044,72805,38995,32484,78533,84405,29485,33726,79117,62369,68234,61605,4480,13806,75056,18287,9551,41766,81265,16037,35429,13122,2497,68378,45756,11720,19523,63596,75749,52895,2153,63999,47234,49690,75060,38967,56686,2031,24626,3553,36633,70689,81805,19964,62579,55681,44003,72658,39334,11013,81497,32743,65867,73960,12194,20154,31107,55847,57413,43457,37711,68203,70297,82709,47189,70483,30557,220,39147,57995,11081,10652,73709,66220,40388,53409,40622,80455,52387,79185,76005,24719,61958,55389,55021,11043,67635,6091,63538,29332,3045,29184,82695,59290,32232,42908,71735,82841,53781,20799,70998,74196,49580,13246,52210,8905,81186,30012,54924,16439,1744,61494,21977,78626,58329,48241,18058,8355,25559,11746,69462,74290,28674,64906,5488,71825,41255,58306,13812,21595,46749,76670,83529,62539,17843,79539,47603,14357,51372,69457,48440,33116,51214,12926,2949,39750,49708,83639,39872,4600,42839,52929,8971};

/* multiplication inverses of omega */
static const uint32_t w_3_inv[2]={76774,7706};

static const uint32_t w_5_inv[4][4]={{83408,53076,74127,42831},
{53076,42831,83408,74127},
{74127,83408,42831,53076},
{42831,74127,53076,83408}};

static const uint32_t omega_256_inv[128]={1,83639,33116,79539,21595,64906,8355,61494,8905,20799,59290,6091,24719,53409,57995,82709,55847,32743,55681,3553,49690,63596,13122,18287,62369,32484,20316,43571,62453,46237,14187,50848,17851,7076,40159,63003,5542,64572,36140,67761,54394,73435,7822,3394,14606,35974,38571,48403,48997,55735,42566,63853,50171,80999,59490,6653,58401,78781,68464,53835,37227,81798,62580,23784,80350,14581,57024,55481,2991,16008,38224,2653,47161,80989,67910,13417,23340,31793,10771,54766,13654,77229,23552,22251,19440,20834,29820,66898,20711,48905,48718,37210,11631,6494,23317,51159,9432,83951,23855,20568,349,44066,68068,49343,17846,11286,43541,3232,66529,77966,78846,13734,9869,53921,49296,57420,59973,22372,2039,57263,23205,60982,17604,46088,55164,16462,78361,84180};
static const uint32_t omega_768_inv[768]={1,52929,4600,83639,39750,12926,33116,69457,14357,79539,62539,76670,21595,58306,71825,64906,74290,11746,8355,48241,78626,61494,16439,30012,8905,13246,74196,20799,82841,42908,59290,29184,29332,6091,11043,55389,24719,79185,80455,53409,66220,10652,57995,220,70483,82709,68203,43457,55847,20154,73960,32743,11013,72658,55681,19964,70689,3553,2031,38967,49690,63999,52895,63596,11720,68378,13122,16037,41766,18287,13806,61605,62369,33726,84405,32484,72805,63992,20316,31396,17614,43571,7121,37668,62453,2269,48400,46237,32565,51523,14187,36595,40868,50848,22575,57392,17851,75,83549,7076,21331,24415,40159,33751,55934,63003,51755,43970,5542,14486,64419,64572,52533,80485,36140,35258,69873,67761,50076,50191,54394,76508,64159,73435,39267,45962,7822,53738,76775,3394,34420,67896,14606,79824,25205,35974,35068,66602,38571,41094,16500,48403,36062,46365,48997,48956,75373,55735,5776,65646,42566,36506,61123,63853,13032,67844,50171,9586,68989,80999,38764,34190,59490,54859,20041,6653,19829,21678,58401,31220,79501,78781,70832,53591,68464,3042,73713,53835,57547,27189,37227,37520,1213,81798,4054,76907,62580,50253,41233,23784,11955,3505,80350,71610,5625,14581,23814,79167,57024,55090,81376,55481,78770,79980,2991,77726,72678,16008,27483,53849,38224,7108,25439,2653,13215,38536,47161,24462,77873,80989,16360,72671,67910,79764,59743,13417,1107,47070,23340,81678,73130,31793,79139,11189,10771,20471,40734,54766,82023,1258,13654,42092,39017,77229,40556,10795,23552,66653,34558,22251,58039,48109,19440,45661,43102,20834,76774,34946,29820,68738,59337,66898,76570,50998,20711,71544,60513,48905,79386,74578,48718,65940,59188,37210,67018,7494,11631,4152,26127,6494,52218,50607,23317,47045,51811,51159,9699,51815,9432,28099,48447,83951,79803,11949,23855,52750,76662,20568,21506,78561,349,55363,261,44066,17866,33681,68068,78927,26214,49343,30013,61834,17846,73354,60549,11286,76024,44266,43541,24390,68630,3232,76984,83025,66529,60880,43218,77966,19007,21755,78846,47496,14667,13734,52362,69093,9869,10278,31103,53921,47467,384,49296,76780,14596,57420,63686,44394,59973,21823,45335,22372,41892,13342,2039,39994,2009,57263,32971,82523,23205,32667,43497,60982,35192,40280,17604,21167,45602,46088,2877,41971,55164,27515,57957,16462,64645,30224,78361,59155,64654,84180,35280,51577,84480,31552,79881,842,44731,71555,51365,15024,70124,4942,21942,7811,62886,26175,12656,19575,10191,72735,76126,36240,5855,22987,68042,54469,75576,71235,10285,63682,1640,41573,25191,55297,55149,78390,73438,29092,59762,5296,4026,31072,18261,73829,26486,84261,13998,1772,16278,41024,28634,64327,10521,51738,73468,11823,28800,64517,13792,80928,82450,45514,34791,20482,31586,20885,72761,16103,71359,68444,42715,66194,70675,22876,22112,50755,76,51997,11676,20489,64165,53085,66867,40910,77360,46813,22028,82212,36081,38244,51916,32958,70294,47886,43613,33633,61906,27089,66630,84406,932,77405,63150,60066,44322,50730,28547,21478,32726,40511,78939,69995,20062,19909,31948,3996,48341,49223,14608,16720,34405,34290,30087,7973,20322,11046,45214,38519,76659,30743,7706,81087,50061,16585,69875,4657,59276,48507,49413,17879,45910,43387,67981,36078,48419,38116,35484,35525,9108,28746,78705,18835,41915,47975,23358,20628,71449,16637,34310,74895,15492,3482,45717,50291,24991,29622,64440,77828,64652,62803,26080,53261,4980,5700,13649,30890,16017,81439,10768,30646,26934,57292,47254,46961,83268,2683,80427,7574,21901,34228,43248,60697,72526,80976,4131,12871,78856,69900,60667,5314,27457,29391,3105,29000,5711,4501,81490,6755,11803,68473,56998,30632,46257,77373,59042,81828,71266,45945,37320,60019,6608,3492,68121,11810,16571,4717,24738,71064,83374,37411,61141,2803,11351,52688,5342,73292,73710,64010,43747,29715,2458,83223,70827,42389,45464,7252,43925,73686,60929,17828,49923,62230,26442,36372,65041,38820,41379,63647,7707,49535,54661,15743,25144,17583,7911,33483,63770,12937,23968,35576,5095,9903,35763,18541,25293,47271,17463,76987,72850,80329,58354,77987,32263,33874,61164,37436,32670,33322,74782,32666,75049,56382,36034,530,4678,72532,60626,31731,7819,63913,62975,5920,84132,29118,84220,40415,66615,50800,16413,5554,58267,35138,54468,22647,66635,11127,23932,73195,8457,40215,40940,60091,15851,81249,7497,1456,17952,23601,41263,6515,65474,62726,5635,36985,69814,70747,32119,15388,74612,74203,53378,30560,37014,84097,35185,7701,69885,27061,20795,40087,24508,62658,39146,62109,42589,71139,82442,44487,82472,27218,51510,1958,61276,51814,40984,23499,49289,44201,66877,63314,38879,38393,81604,42510,29317,56966,26524,68019,19836,54257,6120,25326,19827,301,49201,32904};
static const uint32_t omega_1280_inv[1280]={1,68046,23468,43666,15385,83639,67867,8498,66944,55904,33116,49623,25569,66460,69230,79539,35529,13557,51583,230,21595,75337,74422,74829,59783,64906,11477,21578,16808,13390,8355,51681,79220,40472,46074,61494,76794,36750,52900,66952,8905,51898,61027,64168,59724,20799,63042,64195,38384,63068,59290,57185,15650,36895,35293,6091,4400,1736,23418,20606,24719,12364,58946,50598,52834,53409,65156,42296,59389,35259,57995,51298,37750,7214,49234,82709,61356,63837,8444,25143,55847,40620,63643,71037,34325,32743,12765,58029,83875,75333,55681,65438,54081,3366,14845,3553,67297,83538,38182,3698,49690,22677,33677,38017,12081,63596,83153,29582,7985,49999,13122,19923,13851,35110,56861,18287,36553,80317,5730,23765,62369,57939,42367,75238,11867,32484,45380,62449,10354,61225,20316,59933,49605,67956,66441,43571,56052,50685,59166,67581,62453,29095,70616,26018,36992,46237,1500,15952,57904,26225,14187,4215,895,74850,52572,50848,83653,6739,83607,2420,17851,21328,70470,60060,74385,7076,36277,54403,33599,52732,40159,36888,65857,10777,36662,63003,29312,52423,49714,50642,5542,72229,43397,43388,22341,64572,9502,39999,47577,28141,36140,25011,28761,68641,44439,67761,60988,29285,73763,7445,54394,12552,10482,69570,67385,73435,75822,44661,51874,33062,7822,25512,73964,83250,40526,3394,61551,69290,22730,7432,14606,45392,34191,38527,78331,35974,49829,19199,970,24959,38571,31039,54794,28070,20291,48403,54272,74559,19740,64621,48997,7197,75186,21677,79363,55735,22758,54138,80343,825,42566,14951,35544,20475,65679,63853,83408,62707,78655,33337,50171,58656,1331,5594,62419,80999,33033,62032,20788,74865,59490,64944,62795,68552,70977,6653,60840,11716,64220,49914,58401,52687,19405,79081,43950,78781,74552,50304,69307,81259,68464,81080,53494,19877,9532,53835,75769,70906,75285,84232,37227,70138,25215,55261,40696,81798,80504,58182,19269,33254,62580,53875,9736,80335,47824,23784,3547,81426,27211,29629,80350,54742,37880,67170,58758,14581,33862,38858,45130,31630,57024,42774,60192,16990,63536,55481,57679,6936,56190,63642,2991,10857,73558,81861,58871,16008,66835,73218,9534,20965,38224,73757,21574,82548,3999,2653,74622,82588,22447,12082,47161,22140,73248,23370,49157,80989,28421,80795,6533,5496,67910,62122,62296,74960,18823,13417,71496,9469,75468,33462,23340,35321,52797,70137,41650,31793,81511,66413,81346,74796,10771,50791,6676,20759,44594,54766,65845,39035,8489,45897,13654,62527,80120,33147,47024,77229,68410,39279,53437,27381,23552,14822,43634,34419,8511,22251,23064,9407,80666,14623,19440,10742,20520,1952,21660,20834,79184,40765,46036,10176,29820,67062,59637,14467,48870,66898,51585,51841,68531,78188,20711,73145,26555,81902,60884,48905,83040,28155,59493,15639,48718,30588,32651,4127,10998,37210,11609,48664,73268,32594,11631,25018,82678,63955,12177,6494,55094,81949,48768,53648,23317,75402,19919,79591,25719,51159,41228,39921,62292,56219,9432,7715,9956,12837,57443,83951,9007,65148,4814,40607,23855,19396,58034,1700,23711,20568,57882,49871,4777,57335,349,8893,80156,32854,47062,44066,30903,8967,46700,79866,68068,84303,53076,46746,84185,49343,65395,457,8014,80270,17846,19022,37611,10692,81941,11286,34866,11913,36803,26655,43541,42216,22493,16401,28436,3232,20629,69119,45242,49492,66529,33468,9211,7167,61350,77966,36598,16590,48018,45672,78846,20049,55066,35243,67512,13734,14942,14497,62706,10609,9869,6505,43271,2173,22208,53921,14055,61610,28916,55646,49296,77511,80195,67737,33023,57420,39551,60610,74602,73364,59973,68053,77385,38980,67604,22372,61973,61162,41949,17626,2039,27992,35006,76481,27564,57263,935,8817,62001,23387,23205,57540,10414,4416,76700,60982,43414,17436,83373,46565,17604,25685,18582,3645,75935,46088,366,67422,56707,14847,55164,29752,1908,68952,2014,16462,39673,83084,65344,78313,78361,49810,78021,61964,40115,84180,47037,32536,35570,15570,84480,16435,61013,40815,69096,842,16614,75983,17537,28577,51365,34858,58912,18021,15251,4942,48952,70924,32898,84251,62886,9144,10059,9652,24698,19575,73004,62903,67673,71091,76126,32800,5261,44009,38407,22987,7687,47731,31581,17529,75576,32583,23454,20313,24757,63682,21439,20286,46097,21413,25191,27296,68831,47586,49188,78390,80081,82745,61063,63875,59762,72117,25535,33883,31647,31072,19325,42185,25092,49222,26486,33183,46731,77267,35247,1772,23125,20644,76037,59338,28634,43861,20838,13444,50156,51738,71716,26452,606,9148,28800,19043,30400,81115,69636,80928,17184,943,46299,80783,34791,61804,50804,46464,72400,20885,1328,54899,76496,34482,71359,64558,70630,49371,27620,66194,47928,4164,78751,60716,22112,26542,42114,9243,72614,51997,39101,22032,74127,23256,64165,24548,34876,16525,18040,40910,28429,33796,25315,16900,22028,55386,13865,58463,47489,38244,82981,68529,26577,58256,70294,80266,83586,9631,31909,33633,828,77742,874,82061,66630,63153,14011,24421,10096,77405,48204,30078,50882,31749,44322,47593,18624,73704,47819,21478,55169,32058,34767,33839,78939,12252,41084,41093,62140,19909,74979,44482,36904,56340,48341,59470,55720,15840,40042,16720,23493,55196,10718,77036,30087,71929,73999,14911,17096,11046,8659,39820,32607,51419,76659,58969,10517,1231,43955,81087,22930,15191,61751,77049,69875,39089,50290,45954,6150,48507,34652,65282,83511,59522,45910,53442,29687,56411,64190,36078,30209,9922,64741,19860,35484,77284,9295,62804,5118,28746,61723,30343,4138,83656,41915,69530,48937,64006,18802,20628,1073,21774,5826,51144,34310,25825,83150,78887,22062,3482,51448,22449,63693,9616,24991,19537,21686,15929,13504,77828,23641,72765,20261,34567,26080,31794,65076,5400,40531,5700,9929,34177,15174,3222,16017,3401,30987,64604,74949,30646,8712,13575,9196,249,47254,14343,59266,29220,43785,2683,3977,26299,65212,51227,21901,30606,74745,4146,36657,60697,80934,3055,57270,54852,4131,29739,46601,17311,25723,69900,50619,45623,39351,52851,27457,41707,24289,67491,20945,29000,26802,77545,28291,20839,81490,73624,10923,2620,25610,68473,17646,11263,74947,63516,46257,10724,62907,1933,80482,81828,9859,1893,62034,72399,37320,62341,11233,61111,35324,3492,56060,3686,77948,78985,16571,22359,22185,9521,65658,71064,12985,75012,9013,51019,61141,49160,31684,14344,42831,52688,2970,18068,3135,9685,73710,33690,77805,63722,39887,29715,18636,45446,75992,38584,70827,21954,4361,51334,37457,7252,16071,45202,31044,57100,60929,69659,40847,50062,75970,62230,61417,75074,3815,69858,65041,73739,63961,82529,62821,63647,5297,43716,38445,74305,54661,17419,24844,70014,35611,17583,32896,32640,15950,6293,63770,11336,57926,2579,23597,35576,1441,56326,24988,68842,35763,53893,51830,80354,73483,47271,72872,35817,11213,51887,72850,59463,1803,20526,72304,77987,29387,2532,35713,30833,61164,9079,64562,4890,58762,33322,43253,44560,22189,28262,75049,76766,74525,71644,27038,530,75474,19333,79667,43874,60626,65085,26447,82781,60770,63913,26599,34610,79704,27146,84132,75588,4325,51627,37419,40415,53578,75514,37781,4615,16413,178,31405,37735,296,35138,19086,84024,76467,4211,66635,65459,46870,73789,2540,73195,49615,72568,47678,57826,40940,42265,61988,68080,56045,81249,63852,15362,39239,34989,17952,51013,75270,77314,23131,6515,47883,67891,36463,38809,5635,64432,29415,49238,16969,70747,69539,69984,21775,73872,74612,77976,41210,82308,62273,30560,70426,22871,55565,28835,35185,6970,4286,16744,51458,27061,44930,23871,9879,11117,24508,16428,7096,45501,16877,62109,22508,23319,42532,66855,82442,56489,49475,8000,56917,27218,83546,75664,22480,61094,61276,26941,74067,80065,7781,23499,41067,67045,1108,37916,66877,58796,65899,80836,8546,38393,84115,17059,27774,69634,29317,54729,82573,15529,82467,68019,44808,1397,19137,6168,6120,34671,6460,22517,44366,301,37444,51945,48911,68911};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint32_t *a)
{
uint32_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint32_t *a, uint32_t n, const uint32_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	uint64_t u, v;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			u = a[j1];
			v = a[j1 + d];
			
			a[j1] = barrett_4q(u + v);
			a[j1 + d] = barrett_4q(Q2 + u - v);

			j_omega = num_of_problems;
			
			for (j = j1 + 1; j < j2; j++)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = a[j];
				v = a[j + d];
				
				a[j] = barrett_4q(u + v);
				a[j + d] = barrett_4q2((Q2 + u - v) * omega[j_omega]);
				
				j_omega += num_of_problems;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k++)
	{
		j = k << 2;
		
		u = a[j];
		v = a[j + 2];
			
		a[j] = barrett_4q(u + v);
		a[j + 2] = barrett_4q(Q2 + u - v);
		
		u = a[j + 1];
		v = a[j + 3];

		a[j + 1] = barrett_4q(u + v);
		a[j + 3] = barrett_4q2((Q2 + u - v) * omega[num_of_problems]);
	}
	
	for (k = 0; k < (n >> 1); k++)
	{
		j = k << 1;
		
		u = a[j];
		v = a[j + 1];
		
		a[j] = barrett_4q(u + v);				
		a[j + 1] = barrett_4q(Q2 + u - v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint32_t *a, uint32_t N1, uint32_t N2, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t))
{
	uint32_t n1, n2;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint32_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t), uint32_t inv_n)
{
	uint32_t i, n1, n2;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i++)
	{
		a[i] = barrett_2q2((uint64_t)a[i] * (uint64_t)inv_n);
	}
}

/* 256 * 4 --> 256 * 6 */
static void ntt_butterfly_1024_1536(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1536 + n2];
	d = a[N2_1536 * 2 + n2];
	e = a[N2_1536 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1536 + n2] = (b + c * w_6[0][0] + d * w_6[0][1] + e * w_6[0][2]) % Q;
	a[N2_1536 * 2 + n2] = (b + c * w_6[1][0] + d * w_6[1][1] + e * w_6[1][2]) % Q;
	a[N2_1536 * 3 + n2] = (b + c * w_6[2][0] + d * w_6[2][1] + e * w_6[2][2]) % Q;
	a[N2_1536 * 4 + n2] = (b + c * w_6[3][0] + d * w_6[3][1] + e * w_6[3][2]) % Q;
	a[N2_1536 * 5 + n2] = (b + c * w_6[4][0] + d * w_6[4][1] + e * w_6[4][2]) % Q;
}

/* 256 * 6 --> 256 * 3 */
static void ntt_butterfly_1536_768(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f, g;
	
	b = a[n2];
	c = a[N2_1536 + n2];
	d = a[N2_1536 * 2 + n2];
	e = a[N2_1536 * 3 + n2];
	f = a[N2_1536 * 4 + n2];
	g = a[N2_1536 * 5 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f + g);
	a[N2_1536 + n2] = (b + c * w_6[0][0] + d * w_6[0][1] + e * w_6[0][2] + f * w_6[0][3] + g * w_6[0][4]) % Q;
	a[N2_1536 * 2 + n2] = (b + c * w_6[1][0] + d * w_6[1][1] + e * w_6[1][2] + f * w_6[1][3] + g * w_6[1][4]) % Q;
}

/* 256 * 2 --> 256 * 5 */
static void ntt_butterfly_512_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	
	a[n2] = barrett_4q(b + c);
	a[N2_1280 + n2] = (b + c * w_5[0][0]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0]) % Q;
}

/* 256 * 4 --> 256 * 5 */
static void ntt_butterfly_1024_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1] + e * w_5[0][2]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0] + d * w_5[1][1] + e * w_5[1][2]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0] + d * w_5[2][1] + e * w_5[2][2]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0] + d * w_5[3][1] + e * w_5[3][2]) % Q;
}

/* 256 * 5 --> 256 * 5 */
static void ntt_butterfly_1280_1280_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	f = a[N2_1280 * 4 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f);
	a[N2_1280 + n2] = (b + c * w_5_inv[0][0] + d * w_5_inv[0][1] + e * w_5_inv[0][2] + f * w_5_inv[0][3]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5_inv[1][0] + d * w_5_inv[1][1] + e * w_5_inv[1][2] + f * w_5_inv[1][3]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5_inv[2][0] + d * w_5_inv[2][1] + e * w_5_inv[2][2] + f * w_5_inv[2][3]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5_inv[3][0] + d * w_5_inv[3][1] + e * w_5_inv[3][2] + f * w_5_inv[3][3]) % Q;
}

/* 256 * 3 --> 256 * 3 */
static void ntt_butterfly_768_768_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d;
	
	b = a[n2];
	c = a[N2_768 + n2];
	d = a[N2_768 * 2 + n2];
	
	a[n2] = barrett_8q(b + c + d);
	a[N2_768 + n2] = (b + c * w_3_inv[0] + d * w_3_inv[1]) % Q;
	a[N2_768 * 2 + n2] = (b + c * w_3_inv[1] + d * w_3_inv[0]) % Q;
}

/* 256 * 2 --> 256 * 3 */
static void ntt_butterfly_512_768(uint32_t *a, uint32_t n2)
{
	uint64_t b, c;
	
	b = a[n2];
	c = a[N2_768 + n2];
	
	a[n2] = barrett_4q(b + c);
	a[N2_768 + n2] = (b + c * w_3[0]) % Q;
	a[N2_768 * 2 + n2] = (b + c * w_3[1]) % Q;
}

/* 256 * 3 --> 256 * 1 */
static void ntt_butterfly_768_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_8q(a[n2] + a[N2_768 + n2] + a[N2_768 * 2 + n2]);
}

/* 256 * 5 --> 256 * 6 */
static void ntt_butterfly_1280_1536(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f;
	
	b = a[n2];
	c = a[N2_1536 + n2];
	d = a[N2_1536 * 2 + n2];
	e = a[N2_1536 * 3 + n2];
	f = a[N2_1536 * 4 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f);
	a[N2_1536 + n2] = (b + c * w_6[0][0] + d * w_6[0][1] + e * w_6[0][2] + f * w_6[0][3]) % Q;
	a[N2_1536 * 2 + n2] = (b + c * w_6[1][0] + d * w_6[1][1] + e * w_6[1][2] + f * w_6[1][3]) % Q;
	a[N2_1536 * 3 + n2] = (b + c * w_6[2][0] + d * w_6[2][1] + e * w_6[2][2] + f * w_6[2][3]) % Q;
	a[N2_1536 * 4 + n2] = (b + c * w_6[3][0] + d * w_6[3][1] + e * w_6[3][2] + f * w_6[3][3]) % Q;
	a[N2_1536 * 5 + n2] = (b + c * w_6[4][0] + d * w_6[4][1] + e * w_6[4][2] + f * w_6[4][3]) % Q;
}

/* 256 * 6 --> 256 * 1 */
static void ntt_butterfly_1536_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_16q(a[n2] + a[N2_1536 + n2] + a[N2_1536 * 2 + n2] + a[N2_1536 * 3 + n2] + a[N2_1536 * 4 + n2] + a[N2_1536 * 5 + n2]);	
}

void ntt_1024_1536(uint32_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_256, omega_1536, ntt_butterfly_1024_1536);
}

void intt_1536_768(uint32_t *a)
{
	intt_core(a, N1_1536, N2_1536, 768, omega_256, omega_1536, ntt_butterfly_1536_768, INV_1536);
}

void ntt_512_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_512_1280);
}

void ntt_1024_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_1024_1280);
}

void intt_1280_1280_inv(uint32_t *a)
{
	intt_core(a, N1_1280, N2_1280, 1280, omega_256_inv, omega_1280_inv, ntt_butterfly_1280_1280_inv, INV_1280);
}

void ntt_768_768_inv(uint32_t *a)
{
	ntt_core(a, N1_768, N2_768, omega_256_inv, omega_768_inv, ntt_butterfly_768_768_inv);
}

void ntt_512_768(uint32_t *a)
{
	ntt_core(a, N1_768, N2_768, omega_256, omega_768, ntt_butterfly_512_768);
}

void intt_768_256(uint32_t *a)
{
	intt_core(a, N1_768, N2_768, 256, omega_256, omega_768, ntt_butterfly_768_256, INV_768);
}

void ntt_1280_1536(uint32_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_256, omega_1536, ntt_butterfly_1280_1536);
}

void intt_1536_256(uint32_t *a)
{
	intt_core(a, N1_1536, N2_1536, 256, omega_256, omega_1536, ntt_butterfly_1536_256, INV_1536);
}
